<html><head/><body>





<style type="text/css">body{margin:1em;background-color:transparent!important;}#sbo-rt-content *{text-indent:0pt!important;}#sbo-rt-content .bq{margin-right:1em!important;}</style>
<div><div><h1 id="_idParaDest-258"><em class="italic"> <a id="_idTextAnchor435"/>第六章</em>:亚马逊SageMaker中的自动机器学习</h1>
			<p><strong class="bold">自动化机器学习</strong> ( <strong class="bold"> AutoML </strong>)是<a id="_idIndexMarker1161"/>自动化机器学习管道不同方面的过程，以帮助在短时间内构建和部署高质量的模型。这是通过自动化机器学习过程的不同阶段来实现的，例如特征工程、架构搜索和超参数优化。最初，AutoML的工具更多地关注于通过寻找模型的最佳超参数集来自动化耗时的超参数优化任务。然而，在过去的几年中，AutoML已经扩展到包括管道其他部分的自动化，包括数据清理、特征选择、模型选择等等:</p>
			<div><div><img src="img/B16850_06_01.jpg" alt="Figure 6.1 – Different phases and types of tasks that are automated through AutoML &#13;&#10;" width="1499" height="379"/>
				</div>
			</div>
			<p class="figure-caption">图6.1–通过AutoML自动化的不同阶段和类型的任务</p>
			<p>上图显示了一个简化的图表，显示了可以使用AutoML自动化的不同阶段和不同类型的任务。通过提供一个数据集和一些配置参数，我们将能够构建和部署一个高质量的模型，而无需编写任何代码。在本章中，我们将通过使用<strong class="bold"> SageMaker自动驾驶仪</strong>来详细了解如何在SageMaker中使用AutoML。这种能力允许机器学习实践者容易地训练和调整模型，即使具有有限的机器学习经验或专业知识。虽然初学者很容易使用，<strong class="bold"> SageMaker Autopilot </strong>允许过程透明和可重复。这使得专家能够理解、修改和替换自动化机器学习过程的不同部分。</p>
			<p>我们将从介绍<strong class="bold"> SageMaker工作室</strong>开始，在这里我们将创建和管理我们的第一个<strong class="bold"> SageMaker自动驾驶</strong>实验。我们还将快速浏览一下自动驾驶仪实验快结束时生成的模型可解释性报告。稍后，在本章末尾，我们将了解如何使用和配置<strong class="bold"> Amazon SageMaker </strong>的<strong class="bold">自动模型调整</strong>功能，它允许我们为我们的模型搜索一组最佳的超参数值。</p>
			<p>我们将在本章中介绍以下配方:</p>
			<ul>
				<li>入职<strong class="bold"> SageMaker工作室</strong></li>
				<li>使用包含随机值的附加列生成合成数据集</li>
				<li>在<strong class="bold"> SageMaker工作室</strong>(控制台)中创建并监控<strong class="bold"> SageMaker自动驾驶仪</strong>实验</li>
				<li>使用<strong class="bold"> SageMaker Python SDK </strong>创建和监控<strong class="bold"> SageMaker自动驾驶仪</strong>实验</li>
				<li>检查<strong class="bold"> SageMaker自动驾驶仪</strong>实验的结果和工件</li>
				<li>使用SageMaker <strong class="bold"> XGBoost </strong>内置算法执行<strong class="bold">自动模型调整</strong></li>
				<li>分析<strong class="bold">自动模式调谐</strong>工作结果</li>
			</ul>
			<p>一旦我们完成了本章中的配方，我们将更好地理解如何配置、管理和监控<strong class="bold"> Amazon SageMaker </strong>的自动机器学习和自动模型调整功能。请注意，我们将快速浏览自动驾驶实验期间生成的模型可解释性报告，但我们将在<a href="B16850_07_Final_ASB_ePub.xhtml#_idTextAnchor602"> <em class="italic">第7章</em></a><em class="italic">使用SageMaker特征库、SageMaker Clarify和SageMaker模型监视器</em>的<em class="italic">启用ML可解释性</em>中详细讨论这一点。</p>
			<p>现在，让我们继续本章的食谱吧！</p>
			<h1 id="_idParaDest-259"><a id="_idTextAnchor436"/>技术要求</h1>
			<p>要执行本章中的配方，请确保您具备以下条件:</p>
			<ul>
				<li>一个亚马逊S3桶。</li>
				<li>管理<strong class="bold">亚马逊SageMaker </strong>和<strong class="bold">亚马逊S3 </strong>资源的权限，如果你使用的是带有自定义URL的<strong class="bold"> AWS IAM </strong>用户。如果您使用的是root帐户，那么您应该能够继续本章中的食谱。但是，建议您以AWS IAM用户的身份登录，而不是在大多数情况下使用root帐户。有关更多信息，请随意查看https://docs . AWS . Amazon . com/IAM/latest/user guide/best-practices . html。</li>
			</ul>
			<p>如果您还没有准备好这些先决条件，请随时查看<em class="italic">准备亚马逊S3桶和线性回归实验的训练数据集</em><a href="B16850_01_Final_ASB_ePub.xhtml#_idTextAnchor020"><em class="italic">第1章</em> </a>，<em class="italic">使用亚马逊SageMaker </em>开始机器学习。</p>
			<p>由于本章中的食谱涉及到一些代码，我们在本书的GitHub资源库中提供了这些笔记本:<a href="https://github.com/PacktPublishing/Machine-Learning-with-Amazon-SageMaker-Cookbook/tree/master/Chapter06">https://GitHub . com/packt publishing/Machine-Learning-with-Amazon-sage maker-Cookbook/tree/master/chapter 06</a>。在开始本章的每个食谱之前，确保my-experiments/chapter06目录已经准备好。如果它还没有被创建，请现在就创建，因为这样可以在我们浏览本书中的每一个食谱时保持事物的有序性。</p>
			<p>请点击以下链接查看动作视频中的相关代码:</p>
			<p><a href="https://bit.ly/3tslmcy">https://bit.ly/3tslmcy</a></p>
			<h1 id="_idParaDest-260"><a id="_idTextAnchor437"/>入职SageMaker工作室</h1>
			<p><strong class="bold">亚马逊SageMaker Studio </strong>是<a id="_idIndexMarker1162"/>一个完全集成的机器学习环境。有了SageMaker Studio，我们可以在这个环境中轻松使用SageMaker的其他特性和功能，例如<strong class="bold"> SageMaker自动驾驶</strong>、<strong class="bold"> SageMaker调试器</strong>和<strong class="bold"> SageMaker实验</strong>，使用其直观的用户界面。在这个菜谱中，我们将设置SageMaker Studio，这样我们就可以在后续的菜谱中使用它的不同特性和集成。我们假设这是您第一次使用SageMaker Studio，因此我们将在这个菜谱中设置执行角色和其他先决条件。</p>
			<p>在<em class="italic">在SageMaker Studio(控制台)</em>配方中创建和监控SageMaker自动驾驶实验中，我们将看到使用<strong class="bold"> SageMaker Studio </strong>创建自动驾驶实验是多么简单，而无需编写任何代码。现在，我们将专注于设置我们的环境，以便我们可以在后续的食谱中使用它。</p>
			<p class="callout-heading">注意</p>
			<p class="callout">使用<strong class="bold"> SageMaker Studio </strong>免费！通常，我们只根据计算和存储资源的使用情况为其付费。这意味着我们将为使用<strong class="bold"> SageMaker Studio </strong>中不同选项和功能时启动的<strong class="bold"> SageMaker加工</strong>和<a id="_idIndexMarker1163"/>培训工作支付费用。有关更多信息，请参考亚马逊<a id="_idIndexMarker1164"/> SageMaker Studio定价页面上的注释(<a href="https://docs.aws.amazon.com/sagemaker/latest/dg/studio-pricing.html">https://docs . AWS . Amazon . com/sage maker/latest/DG/Studio-pricing . html</a>)，以及定价页面上的<a id="_idIndexMarker1165"/>详情(<a href="https://aws.amazon.com/sagemaker/pricing/">https://aws.amazon.com/sagemaker/pricing/</a>)。</p>
			<h2 id="_idParaDest-261">正在准备中</h2>
			<p>对于这个食谱，如果你使用一个拥有自定义UR的AWS IAM用户，你需要必要的权限来管理亚马逊SageMaker和T42亚马逊S3资源</p>
			<h2 id="_idParaDest-262">怎么做<a id="_idTextAnchor441"/> <a id="_idTextAnchor442"/>它…</h2>
			<p>这个食谱中的步骤集中在<a id="_idIndexMarker1166"/>设置<strong class="bold"> SageMaker工作室</strong>上。让我们开始吧:</p>
			<ol>
				<li>In the search bar, type sagemaker and choose <strong class="bold">Amazon SageMaker</strong> from the search results:<div><img src="img/B16850_06_02.jpg" alt="Figure 6.2 – Navigating to the SageMaker console&#13;&#10;" width="777" height="382"/></div><p class="figure-caption">图6.2–导航至SageMaker控制台</p><p>从搜索结果列表中点击<strong class="bold"> Amazon SageMaker </strong>选项，应该会将我们导向<a id="_idIndexMarker1167"/>sage maker控制台。</p></li>
				<li>In the SageMaker console, locate and click the <strong class="bold">Amazon SageMaker Studio</strong> link at the top left, as shown her<a id="_idTextAnchor443"/>e: <div><img src="img/B16850_06_03.jpg" alt="Figure 6.3 – Locating Amazon SageMaker Studio in the navigation pane&#13;&#10;" width="770" height="439"/></div><p class="figure-caption">图6.3–在导航页面<a id="_idTextAnchor444"/> <a id="_idTextAnchor445"/>中找到Amazon SageMaker Studio</p><p>侧边栏帮助我们导航到SageMaker控制台的不同部分。点击<strong class="bold">亚马逊SageMaker Studio </strong>应该会将我们重定向到显示<strong class="bold">亚马逊SageMaker Studio </strong>仪表盘的页面。</p></li>
				<li>If this is your first time using <strong class="bold">SageMaker Studio</strong> in a specific region, you should see a screen similar to the following. Select <strong class="bold">Standard Setup</strong> and then choose <strong class="bold">AWS Identity and Access Management (IAM)</strong> as your <strong class="bold">Authentication metho<a id="_idTextAnchor446"/>d<a id="_idTextAnchor447"/></strong>:<div><img src="img/B16850_06_04.jpg" alt="Figure 6.4 – Quick start versus Standard setup&#13;&#10;" width="1558" height="833"/></div><p class="figure-caption">图6.4–快速入门与标准设置</p><p>正如我们<a id="_idIndexMarker1168"/>所看到的，我们有两个选项—<strong class="bold">快速启动</strong>和<strong class="bold">标准设置</strong>。选择<strong class="bold">标准设置</strong>给了我们更多的灵活性和对配置<a id="_idTextAnchor448"/>的控制。</p></li>
				<li>Under <strong class="bold">Permission</strong>, select <strong class="bold">Create a new role</strong>. This should open the <strong class="bold">Create an IAM role</strong> dialog box, which allows us to create an IAM role without having to leave the page:<div><img src="img/B16850_06_05.jpg" alt="Figure 6.5 – Create an IAM role&#13;&#10;" width="1226" height="859"/></div><p class="figure-caption">图6.5–创建IAM角色</p><p>正如我们所看到的，我们<a id="_idIndexMarker1169"/>将使用指定的默认配置。然后，点击<strong class="bold">创建角色</strong>按钮。我们应该会看到一条表明成功的消息！您创建了一个IAM角色。</p><p class="callout-heading">注意</p><p class="callout">我们也可能决定使用现有的角色，而不是创建新的角色。</p></li>
				<li>Under <strong class="bold">Network and storage</strong>, select the existing default VPC and choose <strong class="bold">Public internet Only<a id="_idTextAnchor449"/></strong>:<a id="_idTextAnchor450"/> <div><img src="img/B16850_06_06.jpg" alt="Figure 6.6 – Network and storage configuration&#13;&#10;" width="1211" height="850"/></div><p class="figure-caption">图6.6–网络和存储配置</p><p>在这里，我们有<a id="_idIndexMarker1170"/>两个网络访问选项——<strong class="bold">仅公共互联网</strong>和<strong class="bold">仅VPC</strong>。选择<strong class="bold">仅VPC</strong>选项将为我们提供一个更安全的网络配置，但是选择<strong class="bold">仅公共互联网</strong>选项现在应该可以了，因为我们将处理样本数据集和实验<a id="_idTextAnchor451"/></p></li>
				<li>Leave the other default configuration as-is and click the <strong class="bold">Submit</strong> button. We should see a <strong class="bold">Preparing SageMaker Studio</strong> notification, similar to what is shown in the following screenshot:<div><img src="img/B16850_06_07.jpg" alt="Figure 6.7 – Preparing SageMaker Studio notification message&#13;&#10;" width="657" height="46"/></div><p class="figure-caption">图6.7–准备SageMaker Studio通知消息</p><p>在SageMaker准备和配置资源时，我们会看到这个通知消息大约3-5分钟。过一会儿，我们应该会看到一条消息，说明<strong class="bold"> SageMaker Studio正在读取<a id="_idTextAnchor452"/> y </strong>。</p></li>
				<li>In <strong class="bold">SageMaker Studio Control Panel</strong>, click <strong class="bold">Add user<a id="_idTextAnchor453"/></strong>:<div><img src="img/B16850_06_08.jpg" alt="Figure 6.8 – Locating the Add user button within SageMaker Studio Control Panel&#13;&#10;" width="721" height="227"/></div><p class="figure-caption">图6.8–在SageMaker Studio控制面板中定位添加用户按钮</p><p>正如我们所见，<strong class="bold">添加用户</strong>按钮位于面板的右上角。</p></li>
				<li>Clicking <strong class="bold">Add user</strong> will open the <strong class="bold">Add user</strong> form, as shown in the following screenshot. Specify <a id="_idIndexMarker1171"/>the preferred username. Then, under <strong class="bold">Execution role</strong>, choose <strong class="bold">Create a new role</strong>:<div><img src="img/B16850_06_09.jpg" alt="Figure 6.9 – Add user form&#13;&#10;" width="1045" height="456"/></div><p class="figure-caption">图6.9–添加用户表单</p><p>在这里，我们可以看到<strong class="bold">添加用户</strong>表单，它允许我们创建一个新用户来访问SageMaker Studio。<a id="_idTextAnchor454"/></p></li>
				<li>When prompted to create an IAM role, select <strong class="bold">Any S3 bucket</strong>:<a id="_idTextAnchor455"/><div><img src="img/B16850_06_10.jpg" alt="Figure 6.10 – Creating an IAM role for the user&#13;&#10;" width="777" height="514"/></div><p class="figure-caption">图6.10–为用户创建IAM角色</p><p>这里，<a id="_idIndexMarker1172"/>有<strong class="bold">创建IAM角色</strong>对话框，类似于我们为SageMaker Studio执行角色创建IAM角色时的对话框。</p></li>
				<li>完成上一步后，我们应该会看到一条成功消息。点击<strong class="bold">提交</strong>按钮后<a id="_idTextAnchor456"/>d .<a id="_idTextAnchor457"/>T25】</li>
				<li>Once the user has been created, click <strong class="bold">Open Studio</strong> under <strong class="bold">SageMaker Studio Control Panel</strong>:<div><img src="img/B16850_06_11.jpg" alt="Figure 6.11 – Open Studio button&#13;&#10;" width="721" height="207"/></div><p class="figure-caption">图6.11–打开工作室按钮<a id="_idTextAnchor459"/></p><p>在这里，我们可以看到屏幕右侧的<strong class="bold">打开工作室</strong>按钮。点击此按钮后，将打开一个新标签。等待几分钟，等待<strong class="bold"> SageMaker Studio </strong>界面加载:</p><p class="figure-caption"><a id="_idTextAnchor460"/></p><div><img src="img/B16850_06_12.jpg" alt="Figure 6.12 – SageMaker Studio&#13;&#10;" width="1650" height="657"/></div><p class="figure-caption">图6.12–sage maker工作室</p><p>在这里，我们可以看到SageMaker工作室。我们将在<em class="italic">工作原理……</em>部分讨论<strong class="bold"> SageMaker工作室</strong>的不同部分。</p></li>
				<li>From the<a id="_idIndexMarker1173"/> left sidebar, select the second icon, which will open the different options to manage GitHub repositories. Click the <strong class="bold">Clone a Repository</strong> button:<div><img src="img/B16850_06_13.jpg" alt="Figure 6.13 – Different options for managing GitHub repositories&#13;&#10;" width="346" height="322"/></div><p class="figure-caption">图6.13–管理GitHub存储库的不同选项</p><p>在这里，我们可以看到有三个按钮:</p><ul><li><strong class="bold">打开文件浏览器</strong>，它只是将我们导航回文件浏览器。</li><li><strong class="bold">初始化一个库</strong>，使当前目录成为GitHub库，</li><li><strong class="bold">克隆一个库</strong>，将一个库克隆到当前目录。</li></ul></li>
				<li>In the <strong class="bold">Clone a repo</strong> dialog box, specify the Clone URI as <a href="https://github.com/PacktPublishing/Machine-Learning-with-Amazon-SageMaker-Cookbook.git">https://github.com/PacktPublishing/Machine-Learning-with-Amazon-SageMaker-Cookbook.git</a> in<a id="_idIndexMarker1174"/> the text box. Click the <strong class="bold">CLONE</strong> button afterward:<div><img src="img/B16850_06_14.jpg" alt="Figure 6.14 – Clone a repo&#13;&#10;" width="523" height="334"/></div><p class="figure-caption">图6.14–克隆一个回购</p><p>这里，我们有<strong class="bold">克隆一个回购</strong>对话框。在这一步，我们将克隆包含这本书的笔记本、源代码和文件的存储库。</p></li>
				<li>Right-click on the empty space below the <strong class="bold">Machine-Learning-with-Amazon-SageMaker-Cookbook</strong> directory and choose <strong class="bold">New Folder</strong> from the context menu:<div><img src="img/B16850_06_15.jpg" alt="Figure 6.15 – Context menu&#13;&#10;" width="826" height="419"/></div><p class="figure-caption">图6.15–上下文菜单</p><p>这里，我们有右键单击后弹出的上下文菜单。</p></li>
				<li>将新目录重命名为my-experiments:</li>
			</ol>
			<div><div><img src="img/B16850_06_16.jpg" alt="Figure 6.16 – File browser&#13;&#10;" width="816" height="266"/>
				</div>
			</div>
			<p class="figure-caption">图6.16–文件浏览器</p>
			<p>在这里，我们<a id="_idIndexMarker1175"/>可以看到有两个目录:</p>
			<ul>
				<li>Amazon-SageMaker-Cookbook目录，其中包含从本书的GitHub存储库中克隆的存储库笔记本和文件。</li>
				<li>我们创建的my-experiments目录。</li>
			</ul>
			<p>这样，我们就可以在SageMaker Studio中制作下一组食谱了。现在，让我们看看这是如何工作的！</p>
			<h2 id="_idParaDest-263">它是如何工作的…</h2>
			<p>在这个食谱中，我们<a id="_idIndexMarker1176"/>建立我们的<strong class="bold"> SageMaker工作室</strong>环境。这个食谱由三部分组成:</p>
			<ul>
				<li>使用<strong class="bold">SageMaker Studio</strong>on boarding的标准设置</li>
				<li>创建用户</li>
				<li>克隆<strong class="bold">Amazon-sage maker-Cookbook</strong>GitHub存储库文件:</li>
			</ul>
			<div><div><img src="img/B16850_06_17.jpg" alt="Figure 6.17 – Parts of SageMaker Studio&#13;&#10;" width="1650" height="502"/>
				</div>
			</div>
			<p class="figure-caption">图6.17-sage maker工作室的组成部分</p>
			<p>我们来讨论一下<strong class="bold"> SageMaker Studio </strong>界面的不同部分。如前面的截图所示，<strong class="bold">左侧栏</strong>提供了不同的选项和工具来帮助我们管理我们的资源——文件、终端、内核、GitHub存储库、SageMaker Jumpstart和<a id="_idIndexMarker1177"/> SageMaker组件和注册表。<strong class="bold">主要工作区域</strong>集中在我们将用来管理实验的笔记本和终端上。我们可以在主工作区中有多个选项卡。屏幕右侧还有<strong class="bold">设置</strong>面板(未在<em class="italic">图6.17 </em>中显示)。在这里，我们可以在处理不同的资源(例如，试用组件)时调整表格和图表的属性。</p>
			<p>让我们看看<a id="_idIndexMarker1178"/>在使用<strong class="bold"> SageMaker Studio </strong>和<strong class="bold"> SageMaker笔记本实例</strong>时的一些区别:</p>
			<ul>
				<li>在<strong class="bold"> SageMaker Studio </strong>中，我们不再需要在运行笔记本之前手动启动实例，因为这些实例是在后台自动管理和创建的。</li>
				<li>在<strong class="bold"> SageMaker工作室</strong>内的笔记本即使关闭实例也可以查看。</li>
				<li>在<a id="_idIndexMarker1179"/> SageMaker Studio内的笔记本可以与其他用户共享。关于这个话题的更多信息，请查看<a href="https://docs.aws.amazon.com/sagemaker/latest/dg/notebooks-sharing.html">https://docs . AWS . Amazon . com/sage maker/latest/DG/notebooks-sharing . html</a>。</li>
				<li><strong class="bold"> SageMaker Studio </strong>内的笔记本<a id="_idIndexMarker1180"/>不支持<strong class="bold">本地模式</strong>。另一方面，我们可以在运行于<strong class="bold"> SageMaker笔记本实例</strong>的笔记本内部使用<strong class="bold">本地模式</strong>。</li>
			</ul>
			<p>除了这些<a id="_idIndexMarker1181"/>之外，SageMaker的几个<a id="_idIndexMarker1182"/>功能<a id="_idIndexMarker1183"/>和特性可以在SageMaker Studio <a id="_idIndexMarker1185"/>中使用和管理<a id="_idIndexMarker1184"/>，而无需我们编写一行<a id="_idIndexMarker1186"/>代码。这些功能和特性<a id="_idIndexMarker1187"/>包括<strong class="bold"> SageMaker自动驾驶仪</strong>、<strong class="bold"> SageMaker实验</strong>、<strong class="bold"> SageMaker特性存储</strong>、<strong class="bold"> SageMaker管道</strong>、<strong class="bold"> SageMaker澄清</strong>、<strong class="bold"> SageMaker调试器</strong>、<strong class="bold"> SageMaker模型监视器</strong>等等。</p>
			<h2 id="_idParaDest-264">还有更多…</h2>
			<p><strong class="bold">亚马逊SageMaker </strong>的另一个功能叫做<strong class="bold"> SageMaker JumpStart </strong>，可以通过点击<strong class="bold">文件</strong>菜单内选项列表下的<strong class="bold">新启动器</strong>选项，然后点击<strong class="bold">转到SageMaker JumpStart </strong>进入<a id="_idIndexMarker1188"/>，如下图所示。我们还可以使用左侧边栏中的JumpStart图标(倒数第二个图标)来浏览JumpStart页面:</p>
			<div><div><img src="img/B16850_06_18.jpg" alt="Figure 6.18 – Accessing SageMaker JumpStart&#13;&#10;" width="892" height="479"/>
				</div>
			</div>
			<p class="figure-caption">图6.18-访问SageMaker JumpStart</p>
			<p>我们将被重定向到包含不同解决方案、型号、笔记本电脑和其他参考资料的页面，如以下屏幕截图所示:</p>
			<div><div><img src="img/B16850_06_19.jpg" alt="Figure 6.19 – SageMaker JumpStart&#13;&#10;" width="1029" height="522"/>
				</div>
			</div>
			<p class="figure-caption">图6.19–SageMaker jump start</p>
			<p><strong class="bold"> SageMaker JumpStart </strong>通过向<strong class="bold"> SageMaker Studio </strong>内的用户提供不同解决方案、模型、样本笔记本和资源的目录，加快了<a id="_idIndexMarker1189"/>我们准备机器学习实验和工作流程的速度。有关<strong class="bold"> SageMaker JumpStart </strong>的更多信息，请随意查看https://docs . AWS . Amazon . com/SageMaker/latest/DG/studio-jump start . html。</p>
			<p>除了<strong class="bold"> SageMaker JumpStart </strong>，我们还有<strong class="bold"> SageMaker Data Wrangler </strong>，在这里我们可以导入、处理、转换和<a id="_idIndexMarker1191"/>分析我们的数据。这个特性允许我们执行数据准备和特性工程，而无需编写一行代码。</p>
			<p class="callout-heading">注意</p>
			<p class="callout">一旦您稍微使用过<strong class="bold"> SageMaker Data Wrangler </strong>，您可能会意识到它也支持自定义转换和公式。这些允许我们在<strong class="bold"> SageMaker Data Wrangler </strong>中使用PySpark、pandas和PySpark SQL代码，以获得更大的灵活性。</p>
			<p>下图是<strong class="bold"> SageMaker Data Wrangler </strong>的<strong class="bold">导出数据流</strong>页签。在这里，我们可以将准备好的<a id="_idIndexMarker1192"/>流程和转换导出到笔记本和代码中，这允许我们定制这些流程和转换，并将其与任何现有的管道集成:</p>
			<div><div><img src="img/B16850_06_20.jpg" alt="Figure 6.20 – SageMaker Data Wrangler &#13;&#10;" width="1054" height="680"/>
				</div>
			</div>
			<p class="figure-caption">图6.20–sage maker数据辩论者</p>
			<p>概括地说，我们可以利用此服务完成以下任务:</p>
			<ul>
				<li>从亚马逊S3和其他数据源导入数据</li>
				<li>创建和管理执行不同步骤和转换的数据流</li>
				<li>转换数据</li>
				<li>使用各种分析和可视化工具分析数据</li>
				<li>Export existing flows into notebooks or code files<p class="callout-heading">注意</p><p class="callout">关于这个话题的更多信息，请<a id="_idIndexMarker1193"/>查看以下链接:<a href="https://docs.aws.amazon.com/sagemaker/latest/dg/data-wrangler.html">https://docs . AWS . Amazon . com/sage maker/latest/DG/data-wrangler . html</a>。</p></li>
			</ul>
			<h1 id="_idParaDest-265"><a id="_idTextAnchor464"/>使用包含随机值的附加列生成合成数据集</h1>
			<p>在这个<a id="_idIndexMarker1194"/>配方中，我们将使用scikit-learn生成<a id="_idIndexMarker1195"/>一个合成数据集。该数据集将作为本章实验的虚拟数据集:</p>
			<div><div><img src="img/B16850_06_21.jpg" alt="Figure 6.21 – Scatterplot of the synthetic dataset for classification problems&#13;&#10;" width="528" height="259"/>
				</div>
			</div>
			<p class="figure-caption">图6.21–分类问题综合数据集的散点图</p>
			<p>只需查看前面的散点图，我们就可以推断出我们正在为一个<strong class="bold">二元分类问题</strong>生成一个合成数据集<a id="_idIndexMarker1196"/>。除了由scikit-learn的make_blobs()函数生成的主要预测器列a和b之外，数据集还将包括两列c和d，它们包含随机值，这些值向我们显示了使用这些附加列生成的模型可解释性报告的外观。该模型可解释性报告将在SageMaker Studio(控制台)配方中的<em class="italic">创建和监控SageMaker自动驾驶仪实验中生成。</em></p>
			<p class="callout-heading">小费</p>
			<p class="callout">由于我们将在这个配方中展示如何生成合成数据集的步骤，我们将有机会在以后调整这个配方，使其符合我们的需要。我们可以决定让这个数据集有(明显)更多的记录或更多的列，以查看这些调整如何影响自动机器学习和自动超参数优化作业的结果和配置。</p>
			<h2 id="_idParaDest-266">准备就绪</h2>
			<p>这个食谱从<em class="italic">入职延续到SageMaker <a id="_idTextAnchor467"/>工作室</em>食谱。<a id="_idTextAnchor468"/></p>
			<h2 id="_idParaDest-267"><a id="_idTextAnchor469"/>怎么做……</h2>
			<p>我们将在运行于<strong class="bold"> SageMaker Studio </strong>的笔记本电脑中运行以下步骤。在生成合成数据集之前，前几个步骤将着重于设置一些先决条件。让我们开始吧:</p>
			<ol>
				<li value="1">Navigate <a id="_idIndexMarker1197"/>to<a id="_idIndexMarker1198"/> the my-experiments/chapter06 directory inside <strong class="bold">SageMaker Studio</strong>. Feel free to create this directory if it does not exist yet:<div><img src="img/B16850_06_22.jpg" alt="Figure 6.22 – The my-experiments/chapter06 directory&#13;&#10;" width="333" height="139"/></div><p class="figure-caption">图6.22–我的实验/第6章目录</p><p>在这里，我们有我的实验/第六章目录。继续之前，双击chapter06目录。</p></li>
				<li>Create a <a id="_idIndexMarker1199"/>new notebook <a id="_idIndexMarker1200"/>using the Python 3 (Data Science) kernel inside the my-experiments/chapter06 directory and rename it with the name of this recipe (that is, Generating a synthetic dataset with additional columns containing random values):<div><img src="img/B16850_06_23.jpg" alt="Figure 6.23 – Creating a new notebook&#13;&#10;" width="565" height="277"/></div><p class="figure-caption">图6.23–创建新笔记本</p><p>在这里，我们可以看到如何从<strong class="bold">文件</strong>菜单创建一个新的<strong class="bold">笔记本</strong>。当提示使用内核时，选择Python 3(数据科学)。</p><p class="callout-heading">注意</p><p class="callout">如果这是我们在<strong class="bold"> SageMaker Studio </strong>中的第一台笔记本，内核启动可能需要3-5分钟<a id="_idIndexMarker1201"/>。我们需要等待笔记本运行的实例准备就绪。在完成本章的食谱后，可以在<strong class="bold"> SageMaker Studio </strong>左侧栏的<strong class="bold">运行终端和内核</strong>窗格中随意关闭运行实例。这将有助于降低和管理运行笔记本电脑时产生的成本。如需了解更多信息，请随时查看以下链接:<a href="https://docs.aws.amazon.com/sagemaker/latest/dg/notebooks-usage-metering.html">https://docs . AWS . Amazon . com/sage maker/latest/DG/notebooks-usage-metering . html</a>。</p></li>
				<li>使用scikit-learn中的make_blobs()函数生成合成数据集。注意，我们在下面几行代码中将样本数设置为5,000】</li>
				<li>验证合成数据集中的样本数量。我们将在下一步中使用n_samples变量为另外两列生成随机值:<pre><a id="_idTextAnchor472"/>n_samples = len(X)</pre></li>
				<li>为我们将包含在数据集中的另外两列生成随机值。在<a id="_idIndexMarker1203"/>下面的代码块中，我们使用来自<strong class="bold"> NumPy </strong>的random.randint()函数<a id="_idIndexMarker1204"/>来生成长度等于n_samples: <pre>import numpy as np r1 = <strong class="bold">np.random.randint</strong>(low=-100, high=100,                         size=(n_samples,)).astype(int) r2 = <strong class="bold">np.random.randint</strong>(low=-100, high=100,                         size=(n_sa<a id="_idTextAnchor473"/>mples,)).astype(int)</pre>的随机值</li>
				<li>Prepare a DataFrame called all_dataset. It will contain the target column named label and four predictor columns named a, b, c, and d:<pre>import pandas as pd
all_dataset = pd.DataFrame(
    dict(<strong class="bold">label</strong>=y, <strong class="bold">a</strong>=X[:,0], <strong class="bold">b</strong>=X[:,1], <strong class="bold">c</strong>=r1, <strong class="bold">d</strong>=r2))
print(all_dataset)</pre><p>这应该<a id="_idIndexMarker1205"/>给我们一个数值的数据框架，类似于f <a id="_idTextAnchor474"/> ol <a id="_idTextAnchor475"/> lowing <a id="_idIndexMarker1206"/>截图中显示的内容:</p><div><img src="img/B16850_06_24.jpg" alt="Figure 6.24 – The all_dataset DataFrame&#13;&#10;" width="329" height="243"/></div><p class="figure-caption">图6.24–all _ dataset数据框架</p><p>在这里，我们可以看到all_dataset，它包含五列——l<a id="_idTextAnchor476"/>Abel、a、b、c和d。</p></li>
				<li>Generate<a id="_idIndexMarker1207"/> a<a id="_idIndexMarker1208"/> plot using the following lines of code. Here, we grouped the points by their label values using the groupby() function:<pre>from matplotlib import pyplot
colors = {0:'red', 1:'blue'}
fig, ax = pyplot.subplots()
<strong class="bold">grouped</strong> = <strong class="bold">all_dataset.groupby('label')</strong>
     
for key, group in <strong class="bold">grouped</strong>:
    group.<strong class="bold">plot</strong>(ax=ax, kind='scatter', 
               x='a', y='b', label=key, color=colors[k<a id="_idTextAnchor477"/>ey])
    
pyplot.show()</pre><p>这里，我们可以看到使用Matplotlib生成的散点图:</p><div><img src="img/B16850_06_25.jpg" alt="Figure 6.25 – Scatterplot of the synthetic dataset for classification problems&#13;&#10;" width="518" height="259"/></div><p class="figure-caption">图6.25–分类问题综合数据集的散点图</p><p>这是<a id="_idIndexMarker1209"/>all _ dataset的<a id="_idIndexMarker1210"/>散点图，显示了使用<a id="_idTextAnchor479"/>标签列值分组的点。</p><p>现在我们已经生成了数据集，我们需要将其分为训练集、验证集和测试集，然后再将它们上传到S3存储区:</p></li>
				<li>使用train_test_split()函数两次来获取训练、验证和测试数据集:<pre>from sklearn.model_selection import <strong class="bold">train_test_split</strong> train_val, test = <strong class="bold">train_test_split</strong>(     all_dataset,      test_size=0.2,      random_state=0) training, validation = <strong class="bold">train_test_split</strong>(     train_val,      test_size=0.<a id="_idTextAnchor480"/>25,      random_state=0)</pre></li>
				<li>如果<a id="_idTextAnchor481"/>不存在，使用mkdir Bash命令生成tmp目录:<pre>!mkdir -p <strong class="bold">tmp</strong></pre></li>
				<li>指定将存储数据的S3存储桶的名称和前缀。请确保您用我们在<em class="italic">准备亚马逊S3桶和线性回归实验的训练数据集</em>第一章 、<em class="italic">使用亚马逊SageMaker开始机器学习</em> : <pre>s3_bucket_name = "<strong class="bold">&lt;insert bucket name here&gt;</strong>" <a id="_idTextAnchor482"/>prefix = "chapter06/input"</pre>中创建的桶的名称<a id="_idIndexMarker1212"/>替换了<insert bucket="" name="" here="">的值</insert></li>
				<li>使用to_csv()函数将训练、验证和测试数据帧的内容保存到csv文件中。注意，对于这一步，我们已经将header的值设置为True:<pre>training.<strong class="bold">to_csv</strong>('tmp/<strong class="bold">training_data.csv</strong>', header=True, index=False) validation.<strong class="bold">to_csv</strong>('tmp/<strong class="bold">validation_data.csv</strong>', header=True, index=False) test.<strong class="bold">to_csv</strong>('tmp/<strong class="bold">test_data.csv</strong>',<a id="_idTextAnchor483"/> header=True, index=False)</pre></li>
				<li>使用aws s3 cp命令将CSV文件复制到s3目的地。执行此步骤后，您可以使用AWS控制台S3用户界面验证文件是否成功上传到目标S3存储桶和路径:<pre>!<strong class="bold">aws s3 cp</strong> tmp/<strong class="bold">training_data.csv</strong> s3://{s3_bucket_name}/{prefix}/<strong class="bold">training_data.csv</strong> !<strong class="bold">aws s3 cp</strong> tmp/<strong class="bold">validation_data.csv</strong> s3://{s3_bucket_name}/{prefix}/<strong class="bold">validation_data.csv</strong> !<strong class="bold">aws s3 cp</strong> tmp/<strong class="bold">test_data.csv</strong> s3://{s3_bucket_na<a id="_idTextAnchor484"/>me}/{prefix}/<strong class="bold">test_data.csv</strong></pre></li>
				<li>再次使用to_csv()函数从训练、验证和测试数据帧生成3个csv文件。这一次，注意文件名是不同的，并且头参数<a id="_idIndexMarker1213"/>值<a id="_idIndexMarker1214"/>被设置为假:<pre>training.<strong class="bold">to_csv</strong>('tmp/<strong class="bold">training_data_no_header.csv</strong>', header=False, index=False) validation.<strong class="bold">to_csv</strong>('tmp/<strong class="bold">validation_data_no_header.csv</strong>', header=False, index=False) test.<strong class="bold">to_csv</strong>('tmp/<strong class="bold">test_data_no_header.csv</strong>'<a id="_idTextAnchor485"/>, header=False, index=False)</pre></li>
				<li>最后，使用aws s3 cp命令将CSV文件复制到s3目的地:<pre>!<strong class="bold">aws s3 cp</strong> tmp/<strong class="bold">training_data_no_header.csv</strong> s3://{s3_bucket_name}/{prefix}/<strong class="bold">training_data_no_header.csv</strong> !<strong class="bold">aws s3 cp</strong> tmp/<strong class="bold">validation_data_no_header.csv</strong> s3://{s3_bucket_name}/{prefix}/<strong class="bold">validation_data_no_header.csv</strong> !<strong class="bold">aws s3 cp</strong> tmp/<strong class="bold">test_data_no_header.csv</strong> s3://{s3_bucket_name}/{prefix}/<strong class="bold">test_data_no_header.csv</strong></pre></li>
				<li>Use the %store magic to store the values of s3_bucket_name and prefix:<pre>%store <strong class="bold">s3_bucket_name</strong>
%store <strong class="bold">prefix</strong></pre><p>我们将在随后的菜谱中使用这些值，以便我们可以轻松地指定并提供我们在该菜谱中上传的CSV文件的S3路径。</p></li>
				<li>Finally, print the S3 path of the CSV file containing the training data:<pre>f"s3://{<strong class="bold">s3_bucket_name</strong>}/{<strong class="bold">prefix</strong>}/<strong class="bold">training_data.csv</strong>"</pre><p>将运行此单元格后的输出(不带引号)复制到剪贴板；我们将在<em class="italic">中使用它，在SageMaker Studio(控制台)</em>配方中创建和监控SageMaker自动驾驶实验。</p></li>
			</ol>
			<p>不<a id="_idTextAnchor486"/> w，让我们看看这是怎么回事！</p>
			<h2 id="_idParaDest-268">它是如何工作的…</h2>
			<p>在这个配方中，我们<a id="_idIndexMarker1215"/>已经<a id="_idIndexMarker1216"/>生成了一个可以用于分类问题的合成数据集。该配方包括三个主要步骤——使用scikit-learn和NumPy生成合成数据，使用Matplotlib进行数据可视化，以及将包含数据集的CSV文件上传到S3。</p>
			<p>让我们更详细地看看这些步骤:</p>
			<ul>
				<li><strong class="bold">合成数据生成</strong>:我们使用make_blobs()函数生成一个数据集，它有三列，包括一个目标列。然后，我们生成包含随机值的两列，并将它们与合成数据集合并。在本章的后面，我们将看到<strong class="bold"> SageMaker Autopilot </strong>仍然会提出一个利用前两列值的模型，主要是预测目标列值。</li>
				<li><strong class="bold">Data Visualization</strong>: Given that columns c and d only contain random values, we simply used the values of the a and b columns, along with the target label column, in the scatterplot chart. What are our initial findings after looking at the chart? When the value of a is near 5 and the value of b is near 0, the target value (label) is most likely 1. This, of course, is an oversimplification and is just one of the remarks we can make for now.<p class="callout-heading">注意</p><p class="callout">在现实生活的数据集和例子中，a和b可以很容易地映射到一个或多个预测变量。例如，使用乳房肿块图像的属性(例如，周长平均值、面积平均值和凹度最差值)来检测肿瘤是良性还是恶性。除此之外，c和d可以很容易地映射到一个或多个预测变量，这些预测变量可能不一定对目标变量有显著贡献。</p></li>
				<li><strong class="bold">上传CSV文件</strong>:最后，我们上传了两个版本的CSV文件:一个版本不带头文件，另一个版本带头文件。当我们稍后运行自动驾驶实验时，我们将使用包含头文件的训练CSV文件。在本章的其他一些食谱中，我们将使用不包含标题的测试数据集。</li>
			</ul>
			<h2 id="_idParaDest-269"><a id="_idTextAnchor488"/>还有更多……</h2>
			<p>让我们看看<a id="_idIndexMarker1217"/>可以对这个食谱进行的一些调整，以产生这个数据集的变体:</p>
			<ul>
				<li>我们可以(显著地)生成更多的记录和更多的预测列，然后测试这些调整如何影响我们将在自动化机器学习实验中执行的步骤的配置。</li>
				<li>我们还可以通过在调用make_blobs()函数时修改centers和cluster_std的参数值，将机器学习问题类型更改为<strong class="bold">多类分类</strong>问题。</li>
				<li>我们还可以通过替换目标列和用于生成目标列的步骤，将机器学习问题类型更改为<strong class="bold">回归</strong>问题。</li>
			</ul>
			<p>在运行AutoML作业时，我们很可能会看到使用不同的型号系列。除此之外，一旦我们做出这些调整并重新运行实验，我们可能会在自动驾驶仪<a id="_idIndexMarker1219"/>实验生成的笔记本中看到一些差异。记住这些<a id="_idIndexMarker1220"/>，让我们利用这个合成数据集！</p>
			<h1 id="_idParaDest-270"><a id="_idTextAnchor489"/>在SageMaker Studio(控制台)中创建和监控SageMaker自动驾驶仪实验</h1>
			<p>在这个<a id="_idIndexMarker1221"/>配方中，我们<a id="_idIndexMarker1222"/>将使用<strong class="bold">亚马逊SageMaker自动驾驶仪</strong>使用<a id="_idIndexMarker1223"/>我们之前生成的合成数据集来执行<strong class="bold"> AutoML </strong>。我们将简单地传递训练数据集CSV文件，以及一些配置参数值。这些应该足以让我们的自动驾驶实验运行起来。</p>
			<p>使用<strong class="bold"> SageMaker自动驾驶仪</strong>，机器学习过程的<a id="_idIndexMarker1224"/>不同步骤将自动执行。这些包括预处理、特征工程和模型调整。最酷的是，即使这个过程是完全自动化的，我们仍然可以选择使用生成的笔记本来查看幕后发生的事情。这允许经验丰富的专业人员在需要时修改生成的<a id="_idTextAnchor490"/> d机器学习代码。</p>
			<h2 id="_idParaDest-271">做好准备</h2>
			<p>该配方延续自<em class="italic">生成合成数据集后的任何配方，该数据集具有包含随机值的附加co <a id="_idTextAnchor492"/>列</em>配方。</p>
			<h2 id="_idParaDest-272"><a id="_idTextAnchor493"/>怎么做……</h2>
			<p>本配方中的步骤集中在使用SageMaker Studio控制台(UI)创建和监控一个<strong class="bold">sage maker Au<a id="_idTextAnchor494"/>topilot</strong>实验。让我们开始吧:</p>
			<ol>
				<li value="1">Create a new Autopilot experiment by clicking the <strong class="bold">File</strong> menu and choos<a id="_idTextAnchor495"/><a id="_idTextAnchor496"/>ing <strong class="bold">Experiment</strong> under the <strong class="bold">New</strong> submenu:<div><img src="img/B16850_06_26.jpg" alt="Figure 6.26 – Creating a new experiment from the File menu&#13;&#10;" width="705" height="306"/></div><p class="figure-caption">图6.26–从文件菜单创建新实验</p><p>这里我们可以看到<a id="_idTextAnchor497"/> <a id="_idTextAnchor498"/> <strong class="bold">新建</strong>子菜单在<strong class="bold">文件</strong>菜单下。</p></li>
				<li>Specify<a id="_idIndexMarker1225"/> the <strong class="bold">Experiment name</strong> value. Feel <a id="_idIndexMarker1226"/>free to specify your preferred experiment name. You can set the experiment name so that it follows the conventi<a id="_idTextAnchor499"/>on of sagemaker-cookbook-autopilot:  <div><img src="img/B16850_06_27.jpg" alt="Figure 6.27 – AUTOPILOT EXPERIMENT SETTINGS&#13;&#10;" width="556" height="417"/></div><p class="figure-caption">图<a id="_idTextAnchor500"/>e 6.27–自动驾驶仪实验设置</p><p>这里，我们有<strong class="bold">自动驾驶实验设置</strong>表单，在这里我们可以指定新实验的配置。</p></li>
				<li>Under <strong class="bold">Connect your Data</strong>, select <strong class="bold">Enter S3 bucket location</strong> and then set the S3 bucket address to the location of the training data. Make sure that you replace the value of &lt;S3 bucket name&gt; with the name of the bucket we created in the <em class="italic">Preparing the Amazon S3 bucket and the training dataset for the linear regression experiment</em> recipe of <a href="B16850_01_Final_ASB_ePub.xhtml#_idTextAnchor020"><em class="italic">Chapter 1</em></a><em class="italic">, Getting Started with Machine Learning Using Amazon SageMaker</em>:<pre>s3<strong class="bold">://&lt;S3 bucket name&gt;</strong>/chapter06/input/training_data.csv</pre><p>注意<a id="_idIndexMarker1227"/>此处指定的<a id="_idIndexMarker1228"/>S3存储桶名称必须与本章<em class="italic">生成包含随机值的附加列的合成数据集</em>配方中指定的存储桶名称相同。</p></li>
				<li>Under <strong class="bold">Output data location (S3 bucket)</strong>, select <strong class="bold">Enter S3 bucket location</strong>:<pre>s3://<strong class="bold">&lt;s3 bucket name&gt;</strong>/chapter06/output</pre><p>确保将<s3 bucket="" name="">的值替换为我们在上一步中使用的t <a id="_idTextAnchor501"/>和<a id="_idTextAnchor502"/>铲斗的名称:</s3></p><div><img src="img/B16850_06_28.jpg" alt="Figure 6.28 – CONNECT YOUR DATA&#13;&#10;" width="459" height="304"/></div><p class="figure-caption">图6.28–连接您的数据</p><p>这里，我们有<strong class="bold">连接您的数据</strong>表单，其中的字段用首选值更新。</p></li>
				<li>Create <a id="_idIndexMarker1229"/>and <a id="_idIndexMarker1230"/>specify label in the <strong class="bold">Target</strong> field. Make sure that you click <strong class="bold">Create "label"</strong> after typing label, as shown in the following screenshot:<div><img src="img/B16850_06_29.jpg" alt="Figure 6.29 – Specifying the Target field value&#13;&#10;" width="630" height="142"/></div><p class="figure-caption">图6.29–指定目标字段值</p><p>这个目标列应该与我们在<em class="italic">中生成的数据集中的标签列相匹配，生成一个带有包含随机值</em>配方的额外<a id="_idTextAnchor503"/>列的合成数据集。</p></li>
				<li>当出现自动部署模型的选项时，只需将设置保留为上的<strong class="bold">。</strong></li>
				<li>在<strong class="bold">高级设置</strong>下，为以下字段指定以下值:<ul><li><strong class="bold">最大试用运行时间(秒)</strong> : 3600</li><li><strong class="bold">以秒为单位的最大作业运行时间</strong> : 600</li><li><strong class="bold">最大候选数</strong> : 12(如下截图所示):</li></ul></li>
			</ol>
			<div><div><img src="img/B16850_06_30.jpg" alt="Figure 6.30 – Create Experiment button&#13;&#10;" width="414" height="217"/>
				</div>
			</div>
			<p class="figure-caption">图6.30–创建实验按钮</p>
			<p>这个<a id="_idIndexMarker1231"/>将<a id="_idIndexMarker1232"/>确保自动驾驶实验只需要大约一个小时就能完成。</p>
			<ol>
				<li value="8">F<a id="_idTextAnchor504"/>inally, click the <strong class="bold">Create Experiment</strong> button. Clicking this butto<a id="_idTextAnchor505"/>n will start the Autopilot experiment:<div><img src="img/B16850_06_31.jpg" alt="Figure 6.31 – Autopilot experiment has started&#13;&#10;" width="1018" height="372"/></div><p class="figure-caption">图6.31-自动驾驶仪实验已经开始</p><p>前面的截图显示了我们的屏幕在启动自动驾驶实验后的最初几分钟应该是什么样子。在等待的同时，让我们继续下去，以便我们可以检查一些已经启动的处理作业和由自动驾驶实验生成的笔记本。</p><p class="callout-heading">重要说明</p><p class="callout">确保删除实验完成后生成的推断端点。您将为推理端点的运行时间付费。</p></li>
				<li>In the <a id="_idIndexMarker1233"/>AWS<a id="_idIndexMarker1234"/> Console, navigate to the <strong class="bold">SageMaker Processing Jobs</strong> page to see the processing jobs that were automatically started by the Autopilot experiment:<div><img src="img/B16850_06_32.jpg" alt="Figure 6.32 – Navigating to the Processing jobs page&#13;&#10;" width="758" height="313"/></div><p class="figure-caption">图6.32–导航至处理作业页面</p><p>这应该会将我们重定向到<strong class="bold">处理作业</strong>页面，在这里我们可以看到由Autopilot实验启动的具有b <a id="_idTextAnchor506"/> ee <a id="_idTextAnchor507"/> n的处理作业:</p><div><img src="img/B16850_06_33.jpg" alt="Figure 6.33 – Processing jobs&#13;&#10;" width="946" height="317"/></div><p class="figure-caption">图6.33–处理作业</p><p>在这里，我们<a id="_idIndexMarker1235"/>可以<a id="_idIndexMarker1236"/>看到<strong class="bold"> SageMaker正在处理</strong>已经由自动驾驶实验启动的作业。请随意查看已经执行的作业，以及这些作业中使用的处理图像。一旦实验完成，我们将看到各种各样的<strong class="bold"> SageMaker处理</strong>作业，包括数据分离器、管道推荐器和模型可解释性报告生成器作业。</p></li>
				<li>After about 10 to 15 minutes, the Data Exploration and Candidate Generation Notebooks should have been generated. Once the two buttons shown in the following screenshot appear in the <strong class="bold">Autopilot experiment</strong> tab, click the <strong class="bold">Open data exploration notebook</strong> button:<div><img src="img/B16850_06_34.jpg" alt="Figure 6.34 – Open data exploration notebook button&#13;&#10;" width="777" height="109"/></div><p class="figure-caption">图6.34–打开数据探索笔记本按钮</p><p>这应该会打开<strong class="bold">亚马逊SageMaker自动驾驶数据探索</strong>笔记本，类似于下面的截图所示:</p><div><img src="img/B16850_06_35.jpg" alt="Figure 6.35 – Autopilot Data Exploration Notebook&#13;&#10;" width="731" height="391"/></div><p class="figure-caption">图6.35-自动驾驶仪数据探索笔记本</p><p>我们<a id="_idIndexMarker1237"/>将<a id="_idIndexMarker1238"/>在<em class="italic">检查SageMaker自动驾驶仪实验结果和神器</em>配方中仔细看看这个笔记本。</p></li>
				<li>In the <strong class="bold">Autopilot experiment</strong> tab, click the <strong class="bold">Open candidate generation notebook</strong> button:<div><img src="img/B16850_06_36.jpg" alt="Figure 6.36 – Open candidate generation notebook button&#13;&#10;" width="761" height="97"/></div><p class="figure-caption">图6.36–打开候选人生成笔记本按钮</p><p>这应该会打开<strong class="bold">亚马逊SageMaker自动驾驶候选人定义笔记本</strong>页面，如下所示:</p><div><img src="img/B16850_06_37.jpg" alt="Figure 6.37 – Autopilot Candidate Definition Notebook&#13;&#10;" width="722" height="315"/></div><p class="figure-caption">图6.37-自动驾驶候选人定义笔记本</p><p>我们<a id="_idIndexMarker1239"/>将在<em class="italic">检查SageMaker自动驾驶仪实验结果和工件</em>配方中<a id="_idIndexMarker1240"/>仔细看看这个笔记本。</p></li>
				<li>After a few more minutes, the best model will be deployed. This should be reflected in the quick progress report, as shown in the following screenshot:<div><img src="img/B16850_06_38.jpg" alt="Figure 6.38 – Model has been deployed&#13;&#10;" width="1024" height="427"/></div><p class="figure-caption">图6.38–模型已经部署</p><p>此时，可解释性报告正在生成。稍后我们将看到这是什么样子以及它提供了什么信息。我们还应该看到一个正在SageMaker控制台中运行的<strong class="bold"> SageMaker处理</strong>作业，它正在生成这个报告。</p></li>
				<li>After a few more minutes, the Autopilot experiment should be completed and we will be able to inspect the results. Right-click on the row of the "best" tuning job <a id="_idIndexMarker1241"/>trial <a id="_idIndexMarker1242"/>and choose <strong class="bold">Open in model details</strong> from the list of options in the context menu, as shown here:<div><img src="img/B16850_06_39.jpg" alt="Figure 6.39 – Inspecting the results of the best tuning job trial&#13;&#10;" width="740" height="346"/></div><p class="figure-caption">图6.39–检查最佳调优作业试验的结果</p><p>这里，我们可以看到，对于自动驾驶仪实验产生的最佳模型，目标客观指标(F1得分)值约为0.86234。此客观指标值对应于培训作业运行时自动计算的验证:f1指标值。我们应该看到模型的细节，包括模型可解释性报告的摘录，如下面的截图所示:</p><div><img src="img/B16850_06_40.jpg" alt="Figure 6.40 – Model explainability report&#13;&#10;" width="648" height="573"/></div><p class="figure-caption">图6.40–模型可解释性报告</p><p>在这里，我们<a id="_idIndexMarker1243"/>可以<a id="_idIndexMarker1244"/>看到，列a和b被认为比列c和d更重要。这是意料之中的，因为列c和d只包含随机值，而这些随机值不会对预测的标签值产生影响。我们还可以看到<strong class="bold"> XGBoost </strong>是用来产生最佳模型的算法。此外，SageMaker Autopilot自动检测到我们正在处理一个<strong class="bold">二元分类问题</strong>，而无需我们在启动Autopilot实验时指定它。</p><p class="callout-heading">注意</p><p class="callout">我们将在第七章<em class="italic">使用SageMaker特征库</em> <em class="italic">、SageMaker Clarify和SageMaker模型监视器</em>的<em class="italic">启用ML可解释性</em>中详细了解模型可解释性和特征重要性。</p></li>
				<li>最后，向下滚动到页面底部，查看最佳模型的<strong class="bold">指标</strong>和<a id="_idTextAnchor508"/>参数<strong class="bold">属性:</strong></li>
			</ol>
			<div><div><img src="img/B16850_06_41.jpg" alt="Figure 6.41 – Metrics&#13;&#10;" width="703" height="207"/>
				</div>
			</div>
			<p class="figure-caption">图6.41-指标</p>
			<p>请随意查看<strong class="bold">车型详情</strong>页面上的其他详情。这个<a id="_idIndexMarker1245"/>包括<a id="_idIndexMarker1246"/>实验中使用和产生的输入和输出工件，以及网络配置设置。</p>
			<p class="callout-heading">重要说明</p>
			<p class="callout">确保在运行该实验后删除端点。导航到SageMaker控制台中的<strong class="bold">端点</strong>页面，删除在<a id="_idTextAnchor509"/>g实验中创建的端点。</p>
			<p>让我们看看这是如何工作的！</p>
			<h2 id="_idParaDest-273">它是如何工作的…</h2>
			<p>在这个食谱中，我们使用<strong class="bold"> SageMaker Autopilot </strong>来<a id="_idIndexMarker1247"/>处理<a id="_idIndexMarker1248"/>我们之前生成的数据集，然后自动执行机器学习过程的不同阶段，以得出最佳模型。</p>
			<p><strong class="bold"> SageMaker Autopilot </strong>为我们自动化了以下阶段:</p>
			<ul>
				<li><strong class="bold">数据分析</strong>:计算并收集不同的<a id="_idIndexMarker1249"/>统计数据，帮助机器学习从业者更好地理解数据。</li>
				<li><strong class="bold">问题定义</strong>:根据提供的数据集CSV文件中的目标列确定问题类型(如线性回归、二元分类或多类分类)。</li>
				<li><strong class="bold">数据集模式检测</strong>:确定所提供的数据集CSV文件中每个列/变量的数据类型。</li>
				<li><strong class="bold">候选定义生成</strong>:生成多个候选管道定义。每个候选管道由一个数据处理作业和一个训练作业组成。</li>
				<li><strong class="bold">数据预处理和特征工程</strong>:在训练步骤之前对数据进行处理和准备。</li>
				<li><strong class="bold">算法选择</strong>:根据问题类型，选择用于训练和调整的算法。目前，SageMaker Autopilot在训练和调整模型时支持<a id="_idIndexMarker1250"/><strong class="bold">线性学习器</strong><strong class="bold">XGBoost</strong>的<a id="_idIndexMarker1251"/>用法<a id="_idIndexMarker1252"/>和<strong class="bold">多层感知器(MLP) </strong>深度学习算法。注意，自动驾驶仪选择用于训练步骤的算法。</li>
				<li><strong class="bold">模型调谐</strong>:对不同的模型进行训练和调谐。在此阶段，SageMaker的<strong class="bold">自动模型调整</strong>功能用于寻找目标模型的最佳超参数<a id="_idIndexMarker1253"/>，这将导致使用最佳客观指标。</li>
				<li><strong class="bold">部署</strong>:最佳模型被部署到一个推理端点。最佳模型的选择基于客观指标的值(例如，F1分数)。</li>
				<li><strong class="bold">可解释报告生成</strong>:为最佳模型生成模型可解释报告。</li>
			</ul>
			<p>当<a id="_idIndexMarker1254"/>使用<a id="_idIndexMarker1255"/>自动机器学习解决方案和功能时，例如<strong class="bold">自动驾驶</strong>和<strong class="bold">自动模型调整</strong>，需要注意的是<a id="_idIndexMarker1256"/>通常，用于生产模型的训练和调整作业数量越多，我们获得高(更)质量模型的机会就越高。当然，这意味着我们需要等待更长时间，因为我们必须等待每个培训工作完成。也就是说，它是关于在初始化自动驾驶仪实验时找到一组正确的配置参数(<strong class="bold">以秒计的最大试验运行时间</strong>、<strong class="bold">以秒计的最大作业运行时间</strong>和<strong class="bold">最大候选值</strong>)。</p>
			<p class="callout-heading">注意</p>
			<p class="callout">如果这是你第一次使用AutoML解决方案，你可能会想这是否会取代数据科学家，因为我们可以在技术上执行端到端的机器学习实验和部署，而无需了解任何机器学习知识。这个问题的答案是“不会很快”，因为我们应该将AutoML解决方案视为有助于帮助和加快数据科学家和机器学习实践者工作的工具和服务。AutoML允许他们通过修改自动驾驶作业的生成脚本和笔记本，更多地关注项目的复杂和定制需求。</p>
			<p>现在，让我们以编程方式执行一个类似的AutoML实验。</p>
			<h1 id="_idParaDest-274"><a id="_idTextAnchor512"/>使用SageMaker Python SDK创建和监控SageMaker自动驾驶实验</h1>
			<p>在<a id="_idIndexMarker1257"/>之前的<a id="_idIndexMarker1258"/>配方中，我们使用<strong class="bold"> SageMaker Studio </strong>界面创建并监控了一个<strong class="bold"> SageMaker自动驾驶仪</strong>实验。在这个菜谱中，我们将使用<strong class="bold"> SageMaker Python SDK </strong>以编程方式创建和监控一个类似的AutoML实验。使用<strong class="bold"> SageMaker Python SDK </strong>，我们将能够获得<strong class="bold">自动驾驶</strong>实验的属性，比如自动驾驶作业的主要和次要状态。一旦实验的某些阶段已经完成，我们还将获得存储不同工件和文件的S3路径。在运行超参数优化作业后，我们还将使用best_candidate()函数来检查“最佳偷拍<a id="_idTextAnchor513"/> ate”的属性。</p>
			<h2 id="_idParaDest-275">准备就绪</h2>
			<p>该配方延续自<em class="italic">生成合成数据集<a id="_idTextAnchor515"/>后的任何配方，并增加了包含随机值</em>配方的<a id="_idTextAnchor516"/> l列。</p>
			<h2 id="_idParaDest-276"><a id="_idTextAnchor517"/>怎么做……</h2>
			<p>这个配方中的步骤主要是使用<strong class="bold"> SageMaker Python SDK </strong>来创建和管理<a id="_idTextAnchor518"/>一个<strong class="bold"> SageMaker Autopilot </strong>实验。让我们开始吧:</p>
			<ol>
				<li value="1">Navigate to the my-experiments/chapter06 directory inside <strong class="bold">SageMaker Studio</strong>. Feel free to create this directory if it does not exist yet:<div><img src="img/B16850_06_42.jpg" alt="Figure 6.42 – The my-experiments/chapter06 directory&#13;&#10;" width="333" height="139"/></div><p class="figure-caption">图6.42–我的实验/第6章目录</p><p>在这里，我们有我的实验/第六章目录。继续之前，双击chapter06目录。</p></li>
				<li>Create<a id="_idIndexMarker1259"/> a <a id="_idIndexMarker1260"/>new notebook using the Python 3 (Data Science) kernel inside the my-experiments/chapter06 directory and rename it with the name of this recipe (that is, Creating and monitoring a SageMaker Autopilot experiment using the SageMaker Python SDK):<div><img src="img/B16850_06_43.jpg" alt="Figure 6.43 – Creating a new notebook&#13;&#10;" width="565" height="277"/></div><p class="figure-caption">图6.43–创建新笔记本</p><p>在这里，我们可以看到如何从<strong class="bold">文件</strong>菜单创建一个新的<strong class="bold">笔记本</strong>。当提示使用内核时，选择<strong class="bold"> Python 3(数据科学)</strong>。</p></li>
				<li>Use the %store magic to load the values of s3_bucket_name and prefix:<pre>%store -r <strong class="bold">s3_bucket_name</strong>
%store -r <strong class="bold">prefix</strong></pre><p>请记住，我们使用%store magic将这些变量值保存在<em class="italic">中，生成一个合成数据集<a id="_idTextAnchor519"/>，其中包含随机值</em>配方的附加列。</p></li>
				<li>指定输入路径、输出路径和最大候选数:<pre><strong class="bold">s3_data_source</strong> = \ f"s3://{s3_bucket_name}/{prefix}/<strong class="bold">training_data.csv</strong>" <strong class="bold">output_target</strong> = f"s3<a id="_idTextAnchor520"/>://{s3_bucket_name}/{prefix}<strong class="bold">/output</strong>" <strong class="bold">max_candidates</strong> = 25</pre></li>
				<li>初始化<a id="_idIndexMarker1261"/>一<a id="_idIndexMarker1262"/>几个先决条件，比如会话和角色:<pre>import sagemaker <strong class="bold">session</strong> =<a id="_idTextAnchor521"/> sagemaker.Session() <strong class="bold">role</strong> = sagemaker.get_execution_role()</pre></li>
				<li>Initialize the Autopilot experiment by running the following block of code:<pre>from sagemaker.automl.automl import AutoML
experiment = <strong class="bold">AutoML</strong>(
    role=role,
    sagemaker_session=session,
    <strong class="bold">target_attribute_name="label"</strong>,
    output_path=output_target,
    <strong class="bold">max_candidates=25</strong>,
    <strong class="bold">max_runtime_per_training_job_in_seconds=1000</strong>,
    <strong class="bold">total_job_runtime_in_seconds=6000</strong>
)</pre><p>注意total_job_runtime_in_seconds、max_candidates和max _ runtime _ per _ training _ job _ in _ seconds的参数值决定了<strong class="bold">自动驾驶仪</strong>实验将持续多长时间。一旦达到这些值中的一个，自动驾驶实验也将结束。</p></li>
				<li>Use the fit() function to start the Autopilot job:<pre>experiment.<strong class="bold">fit</strong>(inputs=s3_data_source, logs=False, <strong class="bold">wait=False</strong>)</pre><p>这里，当<a id="_idIndexMarker1264"/>调用fit() <a id="_idTextAnchor523"/> <a id="_idTextAnchor524"/>函数时，我们<a id="_idIndexMarker1263"/>指定wait=False，以便我们可以继续下一组步骤。</p></li>
				<li>Import the pprint and sleep functions:<pre>from pprint import <strong class="bold">pprint</strong>
from time import <strong class="bold">sleep</strong></pre><p>您可以随意使用pprint()函数来检查响应对象<a id="_idTextAnchor525"/>并查看还有哪些其他可用的属性。</p></li>
				<li>Use the following lines of code to check the status and wait for the experiment to complete:<pre><strong class="bold">%%time</strong>
status = "<strong class="bold">InProgress</strong>"
     
<strong class="bold">while status == "InProgress"</strong>:
    response = <strong class="bold">experiment.describe_auto_ml_job()</strong>
    status = response['<strong class="bold">AutoMLJobStatus</strong>']
    secondary_status = response['<strong class="bold">AutoMLJobSecondaryStatu<a id="_idTextAnchor526"/>s</strong>']
    print(f"{status} - {secondary_status}")
    sleep(15)</pre><p>这将为我们提供一组日志，类似于下面的屏幕截图所示:</p><div><img src="img/B16850_06_44.jpg" alt="Figure 6.44 – Logs showing the primary and secondary statuses of the Autopilot job&#13;&#10;" width="577" height="200"/></div><p class="figure-caption">图6.44-显示自动驾驶作业主要和次要状态的日志</p><p>由于<a id="_idIndexMarker1265"/>此<a id="_idIndexMarker1266"/>可能需要大约40分钟才能完成，请在等待时继续下一步。在这里，我们应该看到主要和次要状态文本按以下顺序更改:InProgress - Starting、InProgress - AnalyzingData、InProgress - FeatureEngineering、InProgress - ModelTuning、in progress-generatingeexplainabilitreport和Completed - Completed。</p></li>
				<li>Navigate to the <strong class="bold">Components and registries</strong> pane by clicking the last icon in the left sidebar, as shown here:<div><img src="img/B16850_06_45.jpg" alt="Figure 6.45 – Locating the Autopilot experiment&#13;&#10;" width="369" height="428"/></div><p class="figure-caption">图6.45-定位自动驾驶仪实验</p><p>从<a id="_idIndexMarker1267"/>下拉菜单的<a id="_idIndexMarker1268"/>选项列表中，选择<strong class="bold">实验和</strong>试验来显示所有的实验。</p></li>
				<li>Right-click on the Autopilot experiment that we initiated using the <strong class="bold">SageMaker Python SDK</strong>:<div><img src="img/B16850_06_46.jpg" alt="Figure 6.46 Describe AutoML Job&#13;&#10;" width="592" height="223"/></div><p class="figure-caption">图6.46描述了AutoML作业</p><p>之后，从上下文菜单的选项列表中选择<strong class="bold">描述AutoML作业</strong>:</p><div><img src="img/B16850_06_47.jpg" alt="Figure 6.47 – AutoML Job screen&#13;&#10;" width="898" height="509"/></div><p class="figure-caption">图6.47–自动工作屏幕</p><p>我们<a id="_idIndexMarker1269"/>应该<a id="_idIndexMarker1270"/>会看到类似于前面截图所示的视图。这个屏幕应该反映出我们之前运行while循环时的状态。</p></li>
				<li>Once the Autopilot job has finished running, we can compute the total by running the following block of code:<pre>delta = response['<strong class="bold">EndTime</strong>'] - response['<strong class="bold">CreationTime</strong>']
total_minutes = int(delta.total_seconds() / 60)
total_minutes</pre><p>这将产生一个接近35的值。</p></li>
				<li>Let's check the S3 location of the generated output a<a id="_idTextAnchor527"/>rtifacts:<pre>artifacts = response['<strong class="bold">AutoMLJobArtifacts</strong>']
artifacts<a id="_idTextAnchor528"/></pre><p>这应该会给我们一个类似如下的字典:</p><div><img src="img/B16850_06_48.jpg" alt="Figure 6.48 – Dictionary containing the locations of the artifacts that were generated&#13;&#10;" width="785" height="175"/></div><p class="figure-caption">图6.48–包含生成的工件位置的字典</p><p>这里，<a id="_idIndexMarker1271"/>有<a id="_idIndexMarker1272"/> <a id="_idTextAnchor529"/>由<strong class="bold"> SageMaker自动驾驶仪</strong>生成的笔记本的S3路径。</p></li>
				<li>接下来，使用下面几行代码复制生成的工件:<pre>for s3_p<a id="_idTextAnchor530"/>ath in list(<strong class="bold">artifacts.values()</strong>):     !<strong class="bold">aws s3 cp</strong> {s3_path} tmp/.</pre></li>
				<li>Get the best candidate using the bes<a id="_idTextAnchor531"/>t_candidate() function:<pre>best = experiment.<strong class="bold">best_candidate()</strong>
best</pre><p>这应该会给我们一个结构类似如下的字典:</p><div><img src="img/B16850_06_49.jpg" alt="Figure 6.49 – Dictionary containing the metadata of the &quot;best candidate&quot;&#13;&#10;" width="760" height="407"/></div><p class="figure-caption">图6.49-包含“最佳候选”元数据的字典</p><p>在这里，我们可以看到best_candidate()函数的结果。</p></li>
				<li>Check the objective metric value of the best candidate:<pre>best['<strong class="bold">FinalAutoMLJobObjectiveMetric</strong>']</pre><p>这个<a id="_idIndexMarker1273"/>应该<a id="_idIndexMarker1274"/>给我们一个类似于{'MetricName': 'validation:f1 '，' Value': 0.87288}的值的字典。</p></li>
				<li>Use the %store magic to save the name of the Autopilot job:<pre>autopilot_job_name = response['<strong class="bold">AutoMLJobName</strong>']
%store <strong class="bold">autopilot_job_name</strong>
autopilot_job_name</pre><p>这应该允许我们稍后检查自动驾驶仪实验的细节。</p><p class="callout-heading">注意</p><p class="callout">如果我们想要部署自动驾驶实验的最佳模型，执行部署就像使用autopilot_job.deploy(...).这个deploy()函数应该与估计器或模型对象的deploy()函数具有相同的参数——端点名称、实例_ <a id="_idTextAnchor534"/>类型和初始实例计数。</p></li>
			</ol>
			<p>现在，让我们看看这是如何工作的！</p>
			<h2 id="_idParaDest-277">它是如何工作的…</h2>
			<p>在这个配方中，我们使用了来自<strong class="bold"> SageMaker Python SDK </strong>的AutoML类来初始化<strong class="bold"> SageMaker Autopilot </strong>实验对象。正如我们所见，使用<strong class="bold"> SageMaker Python SDK </strong>来运行自动驾驶作业非常简单。我们只需传递一组配置参数，类似于我们在SageMaker Studio(控制台)配方中的<em class="italic">创建和监控SageMaker自动驾驶仪实验。</em></p>
			<p>我们在这个配方中使用的完成工作的主要语句包括:</p>
			<ol>
				<li value="1">初始化AutoML对象并指定自动驾驶作业的属性:<pre>experiment = <strong class="bold">AutoML</strong>(...)</pre></li>
				<li>使用fit()函数开始实验:<pre>experiment.<strong class="bold">fit</strong>(..., wait=False)</pre></li>
				<li>使用describe_auto_ml_job()函数检查AutoML作业的进度:<pre>experiment.<strong class="bold">describe_auto_ml_job()</strong></pre></li>
			</ol>
			<p><a id="_idIndexMarker1275"/> AutoML <a id="_idIndexMarker1276"/>作业可能需要一些时间才能完成(例如，&gt; 30分钟)。describe_auto_ml_job()函数可以方便地让我们知道AutoML作业的状态。</p>
			<h2 id="_idParaDest-278">还有更多…</h2>
			<p>注意，我们可以使用来自<strong class="bold"> SageMaker Python SDK </strong>的ExperimentAnalytics类来帮助我们分析自动驾驶实验的<a id="_idIndexMarker1277"/>结果。以下是一个快速示例，说明了如何获得包含加工和培训工作详细信息的数据框架:</p>
			<pre>%store -r <strong class="bold">autopilot_job_name</strong>
experiment_name = f"{<strong class="bold">autopilot_job_name</strong>}-aws-auto-ml-job"
from sagemaker.analytics import <strong class="bold">ExperimentAnalytics</strong>
from sagemaker import Session
     
analytics = <strong class="bold">ExperimentAnalytics</strong>(
    sagemaker_session=Session(),
    experiment_name=experiment_name
)
<strong class="bold">analytics.dataframe()</strong></pre>
			<p>这将为我们提供一个数据框架，其值如下所示:</p>
			<div><div><img src="img/B16850_06_50.jpg" alt="Figure 6.50 – DataFrame containing the experiment analytics data&#13;&#10;" width="942" height="435"/>
				</div>
			</div>
			<p class="figure-caption">图6.50-包含实验分析数据的数据框</p>
			<p>有关这个主题的更多信息，请随意查看第五章 、<em class="italic">的<em class="italic">实验分析与SageMaker实验</em>配方<a href="B16850_05_Final_ASB_ePub.xhtml#_idTextAnchor267">、<em class="italic">有效管理机器学习实验</em>。</a></em></p>
			<h1 id="_idParaDest-279"><a id="_idTextAnchor537"/>检查SageMaker自动驾驶仪实验的结果和工件</h1>
			<p>在<a id="_idIndexMarker1279"/>之前的配方中，我们使用了<strong class="bold"> SageMaker Python SDK </strong>来启动和监控一个<strong class="bold"> Autopilot </strong>作业，以及在AutoML作业完成运行后部署最佳模型。</p>
			<p>在本食谱中，我们将检查由SageMaker自动驾驶仪实验生成的笔记本:</p>
			<ul>
				<li>数据探索笔记本</li>
				<li>候选人定义笔记本</li>
			</ul>
			<p><strong class="bold"> SageMaker Autopilot </strong>已经<a id="_idIndexMarker1280"/>生成了这些笔记本，以帮助我们了解AutoML作业内部正在发生的事情。这些笔记本电脑允许数据科学家和机器学习实践者通过修改和定制这些笔记本电脑中他们认为合适的部分来建立在自动驾驶实验的基础上。</p>
			<p>最后，我们将快速查看一下S3输出路径中存储了什么，现在自动驾驶作业已经执行完毕。</p>
			<h2 id="_idParaDest-280"><a id="_idTextAnchor539"/>做好准备</h2>
			<p>该配方延续了<em class="italic">使用SageMaker Python SDK </em>配方创建和监控<a id="_idTextAnchor540"/> SageMaker Auto <a id="_idTextAnchor541"/> <a id="_idTextAnchor542"/>试点实验。</p>
			<h2 id="_idParaDest-281"><a id="_idTextAnchor543"/>怎么做……</h2>
			<p>接下来的几个步骤假设我们刚刚使用SageMaker Python SDK 方法完成了<em class="italic">创建和监控SageMaker自动驾驶仪实验，并且<a id="_idIndexMarker1281"/>AutoML作业工件已经被复制到tmp目录。让我们开始吧:</em></p>
			<ol>
				<li value="1">Inside the tmp directory, we will find two files called SageMakerAutopilotCa<a id="_idTextAnchor544"/><a id="_idTextAnchor545"/>ndidateDefinitionNotebook and SageMakerAutopilotDataExplorationNotebook. Open the tmp directory. You will see the downlo<a id="_idTextAnchor546"/>aded CSV files and the generated Autopilot notebooks, as shown here:<p class="figure-caption"><a id="_idTextAnchor547"/>T15】</p><div><img src="img/B16850_06_51.jpg" alt="Figure 6.51 – Autopilot generated notebooks inside the tmp directory&#13;&#10;" width="577" height="309"/></div><p class="figure-caption">图6.51-自动驾驶仪在tmp目录中没有生成<a id="_idTextAnchor549"/>tebook</p></li>
				<li>Open the Data Exploration Notebook:<div><img src="img/B16850_06_52.jpg" alt="Figure 6.52 – Generated Data Exploration Notebook&#13;&#10;" width="947" height="537"/></div><p class="figure-caption">图6.52-生成的数据探索笔记本</p><p>在这里，我们<a id="_idIndexMarker1282"/>可以看到数据探索笔记本。请注意，该笔记本中的电池可以像任何普通的第<a id="_idTextAnchor550"/> <a id="_idTextAnchor551"/>号tebook电池一样运行，这允许我们检查<a id="_idTextAnchor552"/>每一步后的结果。</p></li>
				<li>Open the Candidate Definition Notebook:<div><img src="img/B16850_06_53.jpg" alt="Figure 6.53 – Candidate Definition Notebook&#13;&#10;" width="941" height="591"/></div><p class="figure-caption">图6.53–候选人定义笔记本</p><p>这里，我们有候选人定义笔记本。注意，本笔记本中的单元格可以像任何普通的<a id="_idTextAnchor553"/> <a id="_idTextAnchor554"/>电子书单元格一样执行，这允许我们检查每一步后的结果。</p></li>
				<li>S<a id="_idTextAnchor555"/>croll <a id="_idIndexMarker1283"/>down<a id="_idTextAnchor556"/> and read through the sections and steps in the notebook:<div><img src="img/B16850_06_54.jpg" alt="Figure 6.54 – Other steps inside Candidate Definition Notebook&#13;&#10;" width="995" height="597"/></div><p class="figure-caption">图6.54–候选人定义笔记本中的其他步骤</p><p>在这里，我们可以看到候选人定义笔记本中的其他步骤。候选定义笔记本通常比数据探索笔记本长，因为它包含<a id="_idTextAnchor557"/>不同的预处理步骤和机器学习选择步骤。</p></li>
				<li>Scroll further down and check out the algorithms and hyperparameter range configurat<a id="_idTextAnchor558"/>ion. This will be used in the automated hyperparameter tuning jobs:<div><img src="img/B16850_06_55.jpg" alt="Figure 6.55 – Defined hyperparameter ranges inside Candidate Definition Notebook&#13;&#10;" width="950" height="532"/></div><p class="figure-caption">图6.55–候选定义笔记本中定义的超参数范围</p><p>在这里，我们<a id="_idIndexMarker1284"/>可以看到定义的超参数范围在候选定义笔记本内。</p></li>
				<li>In the AWS Console, use the search bar to navigate to the S3 console:<div><img src="img/B16850_06_56.jpg" alt="Figure 6.56 – Navigating to the S3 console&#13;&#10;" width="708" height="328"/></div><p class="figure-caption">图6.56–导航到S3控制台</p><p>在搜索栏中键入s3，然后选择<strong class="bold"> S3(云中的可扩展存储)</strong>。</p></li>
				<li>导航到包含输出工件的S3桶(即<bucket name=""> /chapter06/output/…&gt;):</bucket></li>
			</ol>
			<div><div><img src="img/B16850_06_57.jpg" alt="Figure 6.57 – S3 output path containing the output artifacts produced by the Autopilot job&#13;&#10;" width="1071" height="473"/>
				</div>
			</div>
			<p class="figure-caption">图6.57-S3输出路径包含自动驾驶作业产生的输出伪像</p>
			<p>在这里，我们<a id="_idIndexMarker1285"/>应该找到几个包含自动驾驶作业产生的不同工件的文件夹。这些包括数据处理器模型、文档、预处理数据、sagemaker-automl-candidates、转换数据、调整和验证。</p>
			<p>现在，让我们看看这是如何工作的！</p>
			<h2 id="_idParaDest-282"><a id="_idTextAnchor560"/>工作原理…</h2>
			<p>在这份食谱中，我们仔细研究了自动驾驶实验中自动生成的笔记本。这些生成的笔记本有助于使流程尽可能透明。</p>
			<p>让我们详细讨论一下这些笔记本的内容:</p>
			<ul>
				<li><strong class="bold">数据探索笔记本</strong>:这个<a id="_idIndexMarker1286"/>笔记本帮助机器学习从业者识别数据集中的问题。它是在AutoML作业的第一阶段(即分析阶段)生成的。它有两个主要部分:<ul><li><strong class="bold">数据集样本</strong>:此部分显示数据集的一个小样本。</li><li><strong class="bold">列分析</strong>:此部分显示缺失值的百分比、计数统计和描述性统计。</li></ul></li>
				<li><strong class="bold">候选定义笔记本</strong>:这个<a id="_idIndexMarker1287"/>笔记本包含建议的机器学习算法，以及超参数范围。它还包含培训开始前建议的预处理步骤。它有四个主要部分:<ul><li><strong class="bold"> SageMaker设置</strong>:本节重点介绍下载生成的模块和配置自动驾驶作业。</li><li><strong class="bold">候选管道</strong>:本节重点介绍如何创建一个AutoMLInteractiveRunner对象，该对象自动执行<a id="_idIndexMarker1288"/>功能工程和调优步骤。</li><li><strong class="bold">执行候选管道</strong>:本节主要针对每个候选管道执行特征转换和多算法超参数调整步骤。</li><li><strong class="bold">模型选择和部署</strong>:这一部分主要是使用<strong class="bold"> SageMaker Python SDK </strong>中的PipelineModel类来选择和部署最佳模型，以及相应的特征工程模型。</li></ul></li>
			</ul>
			<p>在这个菜谱中，我们还快速地看了一下包含由自动驾驶作业生成的工件的S3桶。<em class="italic">图6.59 </em>显示了包含不同输出工件的几个文件夹(前缀):</p>
			<ul>
				<li>data-processor-models/:该文件夹包含数据处理模型。</li>
				<li>documentation/:这个文件夹包含模型可解释性报告。</li>
				<li>预处理数据/:此文件夹包含预处理数据，包括拆分为CSV文件块(例如，chunk_20.csv和chunk_21.csv)的定型和验证数据集。</li>
				<li>sagemaker-automl-candidates/:该文件夹包含生成的笔记本(即sagemakerautopilotopcandidatediationnotebook . ipynb和sagemakerautopilotdataexplorationnotebook . ipynb)。</li>
				<li>transformed-data/:该文件夹包含来自预处理数据/的CSV文件的相应转换版本。</li>
				<li>tuning/:该文件夹包含由调优作业生成的model.tar.gz文件中的模型工件。</li>
				<li>validations/:该文件夹包含output_validation文件。</li>
			</ul>
			<p>关于这个话题的更多<a id="_idIndexMarker1289"/>信息，请随意查看以下链接:<a href="https://docs.aws.amazon.com/sagemaker/latest/dg/autopilot-automate-model-development.html">https://docs . AWS . Amazon . com/sage maker/latest/DG/auto pilot-automate-model-development . html</a>。</p>
			<h1 id="_idParaDest-283"><a id="_idTextAnchor561"/>使用SageMaker XGBoost内置算法执行自动模型调整</h1>
			<p><em class="italic">超参数</em>是<a id="_idIndexMarker1290"/>机器学习算法的<a id="_idIndexMarker1291"/>属性，影响算法如何工作和行为。在训练步骤中，算法不会学习和修改这些属性，正是这一关键特性使其不同于参数。当在训练步骤中处理训练数据时获得模型的参数时，必须在训练作业开始之前指定超参数。<strong class="bold">超参数优化</strong>是寻找产生最佳模型的最佳<a id="_idIndexMarker1292"/>配置和超参数值组合的过程。</p>
			<p>也就是说，<strong class="bold">自动模型调整</strong>使用不同的超参数配置运行多个训练任务，以寻找模型的“最佳”版本。</p>
			<p class="callout-heading">注意</p>
			<p class="callout">在这种情况下，最佳模型是产生最佳客观度量的模型。这个客观的衡量标准取决于正在解决的问题。</p>
			<p>在这个菜谱中，我们将使用<strong class="bold"> Amazon SageMaker </strong>的<strong class="bold">自动模型调整</strong>功能，通过搜索超参数值的最优集合来寻找“最佳”<strong class="bold"> XGBoost </strong>二元分类器模型。我们将使用我们在本章前面评分的合成数据集作为fit()函数的输入数据集。</p>
			<h2 id="_idParaDest-284">做好准备</h2>
			<p>该配方继续从<em class="italic">生成一个<a id="_idTextAnchor564"/>合成数据<a id="_idTextAnchor565"/>集合，其中包含随机值</em>配方的附加列。</p>
			<h2 id="_idParaDest-285"><a id="_idTextAnchor566"/>怎么做……</h2>
			<p>该配方中的第一组<a id="_idIndexMarker1293"/>步骤<a id="_idIndexMarker1294"/>着重于在运行<strong class="bold">自动模型调整</strong>作业之前准备前<a id="_idTextAnchor567"/>必要条件。让我们开始吧:</p>
			<ol>
				<li value="1">Navigate to the my-experiments/chapter06 directory inside <strong class="bold">SageMaker Studio</strong>. Feel free to create this directory if it does not exist yet:<div><img src="img/B16850_06_58.jpg" alt="Figure 6.58 – The my-experiments/chapter06 directory&#13;&#10;" width="334" height="139"/></div><p class="figure-caption">图6.58–我的实验/第6章目录</p><p>在这里，我们有我的实验/第六章目录。继续之前，双击chapter06目录</p></li>
				<li>Create a new notebook using the Python 3 (Data Science) kernel inside the my-experiments/chapter06 directory and rename it to the name of this recipe (that is, Performing Automatic Model Tuning with the SageMaker XGBoost built-in algorithm):<div><img src="img/B16850_06_59.jpg" alt="Figure 6.59 – Creating a new notebook&#13;&#10;" width="433" height="222"/></div><p class="figure-caption">图6.59–创建新笔记本</p><p>在这里，我们<a id="_idIndexMarker1295"/>可以<a id="_idIndexMarker1296"/>看到如何从<strong class="bold">文件</strong>菜单创建一个新的<strong class="bold">笔记本</strong>。当提示使用内核时，选择<strong class="bold"> Python 3(数据科学)</strong>。</p></li>
				<li>导入、加载和准备<strong class="bold">自动模型调整</strong>工作的一些先决条件。与前面的方法类似，一些先决条件包括我们的区域、boto3客户机、SageMaker会话和SageMaker执行角色。我们还将在下面的代码块中从<strong class="bold"> SageMaker Python SDK </strong>导入tuner】</li>
				<li>使用%store magic <a id="_idIndexMarker1297"/>来<a id="_idIndexMarker1298"/>加载s3_bucket_name和前缀的变量值:<pre>%store -r <strong class="bold">s3_bucket_name</strong> %store -r <strong class="bold">prefix</strong></pre></li>
				<li>准备将指向本配方中使用的S3输入和输出位置的变量:<pre><strong class="bold">training_s3_input_location</strong> = \ f"s3://{<strong class="bold">s3_bucket_name</strong>}/{<strong class="bold">prefix</strong>}/<strong class="bold">training_data_no_header.csv</strong>"  <strong class="bold">validation_s3_input_location</strong> = \ f"s3://{<strong class="bold">s3_bucket_name</strong>}/{<strong class="bold">prefix</strong>}/<strong class="bold">validation_data_no_header.csv</strong>"  <strong class="bold">test_s3_input_location</strong> = \ f"s3://{<strong class="bold">s3_bucket_name</strong>}/{<strong class="bold">prefix</strong>}/<strong class="bold">test_data_no<a id="_idTextAnchor569"/>_header.csv</strong>"  <strong class="bold">training_s3_output_location</strong> = \ f"s3://{<strong class="bold">s3_bucket_name</strong>}/output/"</pre></li>
				<li>使用<strong class="bold"> SageMaker Python SDK </strong>中的retrieve()函数获取指定版本的<strong class="bold"> XGBoost </strong>内置算法的容器URI:<pre>from sagemaker.image_uris impor<a id="_idTextAnchor570"/>t <strong class="bold">retrieve</strong> container = <strong class="bold">retrieve</strong>('<strong class="bold">xgboost</strong>', region, version="0.90-2") container</pre></li>
				<li>使用training input<a id="_idIndexMarker1299"/>指定<a id="_idIndexMarker1300"/>输入数据的内容类型为text/csv: <pre>from sagemaker.inputs import <strong class="bold">TrainingInput</strong> s3_input_training = <strong class="bold">TrainingInput</strong>(     training_s3_input_location,      content_type="text/csv") s3_input_validation <a id="_idTextAnchor571"/>= <strong class="bold">TrainingInput</strong>(     validation_s3_input_location,      content_type="text/csv")</pre></li>
				<li>初始化评估器对象:<pre>estimator = sagemaker.estimator.<strong class="bold">Estimator</strong>(              container,             role,             instance_count=1,              instance_type='ml.m5.large',              <a id="_idTextAnchor572"/>output_path=training_s3_output_location,              sagemaker_session=session)</pre></li>
				<li>指定几个超参数，我们将在不同的培训工作中保持不变:<pre>estimator.<strong class="bold">set_hyperparam<a id="_idTextAnchor573"/>eters</strong>(     eval_metric='auc',     objective='binary:logistic',     num_round=50)</pre></li>
				<li>Specify the hyperparameter range configuration for eta, min_child_weight, and max_depth. As you can see, we are using the ContinuousParameter and IntegerParameter classes to specify the configuration<a id="_idIndexMarker1301"/> of<a id="_idIndexMarker1302"/> the continuous and discrete hyperparameters, respectively:<pre><strong class="bold">hyperparameter_ranges</strong> = {
    '<strong class="bold">eta</strong>': tuner.<strong class="bold">ContinuousParameter</strong>(0, 1),
    '<strong class="bold">min_child_weight</strong>'<a id="_idTextAnchor574"/>: tuner.<strong class="bold">ContinuousParameter</strong>(3, 7),
    '<strong class="bold">max_depth</strong>': tuner.<strong class="bold">IntegerParameter</strong>(2, 8)
}</pre><p class="callout-heading">注意</p><p class="callout">请注意，这个超参数配置只是一个例子。如果您认为合适，可以随意修改这个hyperparameter_ranges配置。</p></li>
				<li>Specify the value of objective_metric_name:<pre><strong class="bold">objective_metric_name</strong> = '<strong class="bold">validation:auc</strong>'</pre><p>在这个食谱中，我们<a id="_idIndexMarker1303"/>将要指定ROC曲线 ( <strong class="bold"> A <a id="_idTextAnchor576"/> UC </strong>)下的<strong class="bold">区域。通常，模型的AUC度量值越高，其表现越好。</strong></p></li>
				<li>初始化HyperparameterTuner对象。我们在前面的步骤中指定了估计量、客观度量名称和超参数范围配置，作为初始化超参数调谐器对象的三个参数:<pre>hyperparameter_tuner = tuner.<strong class="bold">HyperparameterTuner</strong>(     estimator,     <strong class="bold">objectiv<a id="_idTextAnchor577"/><a id="_idTextAnchor578"/><a id="_idTextAnchor579"/>e_metric_name</strong>,     <strong class="bold">hyperparameter_ranges</strong>,     <strong class="bold">max_jobs=20</strong>,     <strong class="bold">max_parallel_jobs=3</strong>)</pre></li>
				<li>使用<a id="_idIndexMarker1304"/>fit()函数<a id="_idIndexMarker1305"/>启动超参数调整工作。请注意，我们已经将wait值设置为False，这样我们就可以在优化作业运行时继续下面的步骤:<pre>hyperparameter_tuner.<strong class="bold">fit</strong>(     {'train': s3_input_training,      <a id="_idTextAnchor580"/> 'validation': s3_input_validation},     include_cls_metadata=False,     wait=False )</pre></li>
				<li>Use the describe_hyper_parameter_tuning_job() function to check the status of the tuning job:<pre><strong class="bold">job_name</strong> = hyperparameter_tuner.<strong class="bold">latest_tuning_job.job_name</strong>
response = client.<strong class="bold">describe_hyper_parameter_tuning_job</strong>(
    HyperParameterTuningJobName=job_name
)
response['<strong class="bold">HyperParameterTuningJobStatus</strong>']</pre><p>一旦调优作业运行完毕，我们应该会得到一个Completed值。在优化作业运行时，我们应该会获得一个正在进行的值。</p><p class="callout-heading">重要说明</p><p class="callout">随意<a id="_idIndexMarker1306"/>到<a id="_idIndexMarker1307"/>使用SageMaker控制台检查由超参数调整作业启动的培训作业的状态和进程。如果在运行这些培训<a id="_idTextAnchor581"/>作业时出现错误，我们将能够在<strong class="bold"> CloudWatch日志</strong>中查看详细信息并解决<a id="_idIndexMarker1308"/>问题。</p></li>
				<li>Use pprint() to display the content of response:<pre>from pprint import <strong class="bold">pprint</strong>
<strong class="bold">pprint</strong>(response)</pre><p>这将为我们提供一个嵌套的值字典，类似于下面的屏幕截图所示:</p><div><img src="img/B16850_06_60.jpg" alt="Figure 6.60 – Results after calling describe_hyper_parameter_tuning_job()&#13;&#10;" width="837" height="212"/></div><p class="figure-caption">图6.60–调用describe _ hyper _ parameter _ tuning _ job()后的结果</p><p>在这里，我们<a id="_idTextAnchor582"/> <a id="_idTextAnchor583"/>可以看到，我们能够实现0.91098的验证值:auc指标。</p></li>
				<li>Finally, get the name of the tuning job and use the %store magic to save its value:<pre>r = response
tuning_job_name = r['<strong class="bold">HyperParameterTuningJobName</strong>']
%store tuning_job_name
tuning_job_name</pre><p>我们将在稍后的<em class="italic">分析自动模型调整作业结果</em>配方中使用调整作业名称的值。</p><p class="callout-heading">注意</p><p class="callout">如果我们<a id="_idIndexMarker1309"/>想要<a id="_idIndexMarker1310"/>部署自动模型调优作业的最佳模型，那么使用hyperparameter_tuner.deploy(...).此deploy()函数应该具有与估计器或模型对象的deploy()函数相同的参数-<a id="_idTextAnchor584"/>endpoint _ name、instance_type和initial_instance_count。</p></li>
			</ol>
			<p>现在，让我们看看这是如何工作的！</p>
			<h2 id="_idParaDest-286"><a id="_idTextAnchor585"/>工作原理……</h2>
			<p><strong class="bold">亚马逊SageMaker </strong>的<strong class="bold">自动模型调整</strong>功能帮助我们寻找模型的最佳版本。这是通过自动搜索模型超参数的优化值来实现的:</p>
			<div><div><img src="img/B16850_06_61.jpg" alt="Figure 6.61 – How Automatic Model Tuning works&#13;&#10;" width="1461" height="651"/>
				</div>
			</div>
			<p class="figure-caption">图6.61–自动模型调整的工作原理</p>
			<p>如上图所示，SageMaker的<strong class="bold">自动模型调整</strong>功能包括使用多个训练任务测试不同的超参数配置值，以得出最佳模型。基于在执行训练作业时计算的每个模型的客观度量值来选择最佳模型。让我们详细讨论一下这个过程:</p>
			<ul>
				<li><strong class="bold">准备超参数范围配置</strong>:我们提供我们希望调整和优化的每个超参数的值范围。在这个配方中，我们通过提供最小值和最大值来指定eta、min_child_weight和max_depth的超参数范围配置。对于这些范围中的每一个，可以指定缩放类型，以改变调谐器算法如何搜索<a id="_idIndexMarker1311"/>特定的<a id="_idIndexMarker1312"/>超参数范围。缩放类型可以是线性、对数或反对数。默认设置为<strong class="bold">自动</strong>。</li>
				<li><strong class="bold">初始化HyperparameterTuner对象</strong>:当我们初始化HyperparameterTuner对象时，我们传递了估计器对象、客观度量名称、hyperparameter范围配置和一些其他参数。客观度量对于了解在模型调整过程中生成的模型是否优于由培训作业生成的其他模型至关重要。在这个配方中，使用AUC，其值越高，模型越好。</li>
				<li><strong class="bold">调用fit()函数启动调优作业</strong>:为了启动调优作业，调用HyperparameterTuner对象的fit()函数。与estimator对象的fit()函数类似，HyperparameterTuner对象的fit()函数接受定型数据以及其他参数值，如wait和include_cls_metadata。</li>
				<li><strong class="bold">等待调整作业完成</strong>:由于配置和执行了多个培训作业，自动模型调整作业需要一些时间来完成。一旦所有的训练工作都完成了，最佳的调整工作就被选中，然后<a id="_idTextAnchor586"/>我们可以继续分析和部署模型(需要单独完成)。</li>
			</ul>
			<p>至此，我们应该对<strong class="bold">自动调模</strong>的工作原理有了很好的了解。</p>
			<h2 id="_idParaDest-287">还有更多…</h2>
			<p>对于亚马逊SageMaker 的<strong class="bold">自动模型调整</strong>功能，我们仅仅触及了皮毛。让我们来讨论其中的一些功能:</p>
			<ul>
				<li><strong class="bold">热启动</strong>:我们可以<a id="_idIndexMarker1313"/>用它来启动一个超参数调优作业，利用之前的调优作业作为起点。这对于不同的情况很有用，包括继续已停止的优化作业或使用新数据优化模型。</li>
				<li><strong class="bold">提前停止</strong>:当目标度量在多次迭代中没有显著改善时，我们可以使用<a id="_idIndexMarker1314"/>来停止超参数调优工作。并不是所有的内置SageMaker算法都支持提前停止。我们可以对线性学习器、XGBoost、图像分类等算法使用提前停止选项。</li>
				<li><strong class="bold">策略</strong>:我们可以用它来<a id="_idIndexMarker1315"/>指定我们是使用<strong class="bold">贝叶斯搜索</strong>还是<strong class="bold">随机搜索</strong>选项来寻找<a id="_idIndexMarker1316"/>超参数的优化值。在<strong class="bold">随机搜索</strong>中，从超参数范围中随机<a id="_idIndexMarker1317"/>采样值，然后在运行已配置了这些随机选择的超参数值的训练作业后进行评估。与<strong class="bold">随机搜索</strong>选项相比，<strong class="bold">贝叶斯搜索</strong>选项在确定下一组值时利用了之前迭代的评估结果。<strong class="bold">贝叶斯搜索</strong>选项是默认选项，在寻找更好的结果时使用“探索/利用”方法，因为它有时会探索接近当前最佳评估培训工作的超参数值。有时，它探索一个远离任何现有的超参数值配置的值配置。请随时查看https://docs . AWS . Amazon . com/sage maker/latest/DG/automatic-model-tuning-how-it-works . html了解更多信息。</li>
			</ul>
			<p>在执行自动化超参数优化时，我们也不局限于SageMaker的内置算法。我们还可以使用以下方法优化模型:</p>
			<ul>
				<li>深度学习库和框架(例如<strong class="bold"> TensorFlow </strong>和<strong class="bold"> PyTorch </strong>)</li>
				<li>自定义容器图像(例如，使用R)</li>
			</ul>
			<p>最后可以同时对多个模型进行<a id="_idIndexMarker1318"/>自动超参数调优。以下是如何实现这一点的示例代码片段:</p>
			<pre><strong class="bold">estimator_dict</strong> = { '<strong class="bold">nn</strong>': &lt;est1&gt;, '<strong class="bold">ll</strong>': &lt;est2&gt; }
<strong class="bold">hyperparams_dict</strong> = { '<strong class="bold">nn</strong>': { ... },  '<strong class="bold">ll</strong>': { ... }}
<strong class="bold">metrics_dict</strong> = { '<strong class="bold">nn</strong>': '&lt;metric1&gt;', '<strong class="bold">ll</strong>': '&lt;metric2&gt;' }
<strong class="bold">metric_definitions_dict</strong> = { '<strong class="bold">nn</strong>': [...], '<strong class="bold">ll</strong>': [...] }
     
hyperparameter_tuner = <strong class="bold">HyperparameterTuner.create</strong>(
    ...,
    estimator_dict=<strong class="bold">estimator_dict</strong>,
    hyperparameter_ranges_dict=<strong class="bold">hyperparams_dict</strong>,
    objective_metric_name_dict=<strong class="bold">metrics_dict</strong>,
    metric_definitions_dict=<strong class="bold">metric_definitions_dict</strong>
)</pre>
			<p>在这里，我们可以看到，我们只需要为estimator_dict、hyperparameter_ranges_dict、objective_metric_name_dict和metric_definitions_dict提供遵循通用嵌套字典结构的参数值。关于更完整的例子，您可以查看SageMaker的多算法<a id="_idIndexMarker1319"/>对<strong class="bold">自动模型调整</strong>功能的支持。这可以在检查SageMaker自动驾驶仪实验结果和工件配方的<em class="italic">的<a id="_idIndexMarker1320"/>和<strong class="bold">候选定义笔记本</strong>中找到。</em></p>
			<h2 id="_idParaDest-288"><a id="_idTextAnchor588"/>参见</h2>
			<p>如果您正在寻找在真实数据集和更复杂的示例上使用SageMaker的<strong class="bold">自动模型调整</strong>功能的示例，请随意查看AWS/Amazon-SageMaker-examples GitHub资源库中的一些笔记本:</p>
			<ul>
				<li>使用<strong class="bold">提前停止</strong>到<a id="_idIndexMarker1321"/>加速带有<strong class="bold">自动模型调整</strong>的多类图像分类器的调整过程:<a href="https://github.com/aws/amazon-sagemaker-examples/blob/master/hyperparameter_tuning/image_classification_early_stopping/hpo_image_classification_early_stopping.ipynb">https://github . com/AWS/Amazon-sagemaker-examples/blob/master/hyperparameter _ Tuning/image _ class ification _ early _ stopping/hpo _ image _ class ification _ early _ stopping . ipynb</a></li>
				<li>使用SageMaker中的R使用自定义算法容器映像执行自动超参数优化:<a href="https://github.com/aws/amazon-sagemaker-examples/blob/master/hyperparameter_tuning/r_bring_your_own/tune_r_bring_your_own.ipynb">https://github . com/AWS/Amazon-SageMaker-examples/blob/master/hyperparameter _ tuning/R _ bring _ your _ own/tune _ R _ bring _ your _ own . ipynb</a></li>
			</ul>
			<p>现在，让我们仔细看看如何分析自动模型调优作业的结果！</p>
			<h1 id="_idParaDest-289"><a id="_idTextAnchor589"/>分析自动模型调整作业结果</h1>
			<p>在之前的<a id="_idIndexMarker1322"/>配方中，我们使用了SageMaker的<strong class="bold">自动模型调整</strong>功能来帮助我们确定模型的最佳超参数值。在这个菜谱中，我们将使用来自<strong class="bold"> SageMaker Python SDK </strong>的HyperparameterTuningJobAnalytics类来加载自动模型调优作业的属性和细节。当我们想要分析和比较不同训练工作的属性、超参数和结果时，这将很方便。</p>
			<p class="callout-heading">Ti <a id="_idTextAnchor590"/> p</p>
			<p class="callout">即使<strong class="bold">自动模型调整</strong>工作尚未完成，我们也可以运行该配方。</p>
			<h2 id="_idParaDest-290">准备就绪</h2>
			<p>该配方继续使用从<em class="italic"> P <a id="_idTextAnchor593"/>到<a id="_idTextAnchor594"/>使用SageMaker XGBoost内置算法</em>配方执行自动模型调整。</p>
			<h2 id="_idParaDest-291"><a id="_idTextAnchor595"/>怎么做……</h2>
			<p>以下步骤集中于使用HyperparameterTuningJobAnalytics加载和检查<a id="_idIndexMarker1323"/>自动模型调整<strong class="bold">作业的结果和当前状态。让我们开始吧:</strong></p>
			<ol>
				<li value="1">Navigate to the my-experiments/chapter06 directory inside <strong class="bold">SageMaker Studio</strong>. Feel free to create this directory if it does not exist yet:<div><img src="img/B16850_06_62.jpg" alt="Figure 6.62 – The my-experiments/chapter06 directory&#13;&#10;" width="336" height="139"/></div><p class="figure-caption">图6.62–我的实验/第6章目录</p><p>在这里，我们有我的实验/第六章目录。继续之前，双击chapter06目录。</p></li>
				<li>Create a new notebook using the Python 3 (Data Science) kernel inside the my-experiments/chapter06 directory and rename it with the name of this recipe (that is, Analyzing the Automatic Model Tuning job results): <div><img src="img/B16850_06_63.jpg" alt="Figure 6.63 – Creating a new notebook&#13;&#10;" width="453" height="222"/></div><p class="figure-caption">图6.63–创建新笔记本</p><p>在这里，我们<a id="_idIndexMarker1324"/>可以看到如何从<strong class="bold">文件</strong>菜单创建一个新的<strong class="bold">笔记本</strong>。当提示使用内核时，选择<strong class="bold"> Python 3(数据科学)</strong>。</p></li>
				<li>使用%store魔术加载tuning_job_name的值。请记住，我们将该值ea <a id="_idTextAnchor596"/> rlier存储在使用SageMaker XGBoost内置算法配方<pre>%store -r <strong class="bold">tuning_job_name</strong></pre>执行自动模型调整的<em class="italic">中</em></li>
				<li>Initialize a HyperparameterTuningJobAnalytics object with tuning_job_name as the parameter. Load the DataFrame containing the results and metrics of the automated tuning job using the dataframe() function:<pre>import pandas as pd
import sagemaker
analytics = sagemaker.<strong class="bold">HyperparameterTuningJobAnalytics</strong>(
    tuning_job_name)
full_df <a id="_idTextAnchor598"/>= analytics.<strong class="bold">dataframe()</strong>
full_df</pre><p>这将为我们提供一个类似于<a id="_idTextAnchor599"/>的数据帧，如下所示:</p><div><img src="img/B16850_06_64.jpg" alt="Figure 6.64 – Results after using HyperparameterTuningJobAnalytics.dataframe() &#13;&#10;" width="804" height="476"/></div><p class="figure-caption">图6.64–使用hyperparametertuningjobanalytics . data frame()后的结果</p><p>在这里，我们<a id="_idIndexMarker1325"/>可以看到与<strong class="bold">自动模型调整</strong>作业触发的训练作业相关的参数、超参数和度量值。此时，我们可以使用<strong class="bold"> pandas </strong>库使用不同的数据操作选项来分析这个数据帧。</p></li>
				<li>Sort the DataFrame by the FinalObjectiveValue column in descending order:<pre>full_df.<strong class="bold">sort_values</strong>("<strong class="bold">FinalObjectiveValue</strong>", <strong class="bold">ascending=False</strong>)</pre><p>这将为我们提供一个类似如下的值的数据框架:</p><div><img src="img/B16850_06_65.jpg" alt="Figure 6.65 – Training job results sorted by FinalObjectiveValue&#13;&#10;" width="802" height="465"/></div><p class="figure-caption">图6.65–按最终目标值排序的培训工作结果</p><p>这里，<a id="_idIndexMarker1326"/>结果按最终目标值降序排列。此数据帧中的第一行将为我们提供当前FinalObjectiveValue最高的模型。</p></li>
				<li>Get the median value of the number of seconds the training jobs has executed for using the median() function:<pre>full_df["<strong class="bold">TrainingEl<a id="_idTextAnchor600"/>apsedTimeSeconds</strong>"].<strong class="bold">median()</strong></pre><p>这应该会返回一个接近82.0的值。</p></li>
			</ol>
			<p>现在，让我们看看这是如何工作的！</p>
			<h2 id="_idParaDest-292"><a id="_idTextAnchor601"/>工作原理……</h2>
			<p>在这个配方中，我们加载了一个<strong class="bold"> SageMaker自动模型调整</strong>作业的结果和细节。我们期望在这个过程中看到大量的训练作业被运行，这个方法是用几行代码快速获得训练作业的属性和结果的一种方法。</p>
			<p>HyperparameterTuningJobAnalytics允许我们在使用<strong class="bold"> Amazon SageMaker </strong>的自动模型调整功能时，提取我们已经执行的训练作业的属性和指标。如图<em class="italic">图6.67 </em>所示，数据帧的超参数配置中有以下几列(即eta、max_depth、min _ child _ weight):training job name、TrainingJobStatus、FinalObjectiveValue。</p>
			<p>在<strong class="bold"> SageMaker Python SDK </strong>中，我们有以下几个类。这些可以在分析<a id="_idIndexMarker1327"/>不同的工作和实验时使用:</p>
			<ul>
				<li>超参数调整作业分析</li>
				<li>培训工作分析</li>
				<li>实验分析</li>
			</ul>
			<p>这些类中的每一个都允许我们收集关于它们对应的目标实体的更多细节(例如，ExperimentAnalytics为<strong class="bold"> SageMaker实验</strong>加载细节和结果)。</p>
		</div>
		<div><div/>
		</div>
	</div>
</body></html>