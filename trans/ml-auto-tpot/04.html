<html><head/><body>





<style type="text/css">body{margin:1em;background-color:transparent!important;}#sbo-rt-content *{text-indent:0pt!important;}#sbo-rt-content .bq{margin-right:1em!important;}#sbo-rt-content *{word-wrap:break-word!important;word-break:break-word!important;}#sbo-rt-content table,#sbo-rt-content pre{overflow-x:unset!important;overflow:unset!important;overflow-y:unset!important;white-space:pre-wrap!important;}</style>
<div><div><h1 id="_idParaDest-37"><em class="italic"> <a id="_idTextAnchor036"/>第二章</em>:深入TPOT</h1>
			<p>在这一章中，你将会学到关于TPOT图书馆及其底层架构的所有理论知识。建筑和遗传编程等主题对于全面掌握图书馆的内部运作至关重要。</p>
			<p>我们将浏览TPOT用例，并深入研究解决各种机器学习问题的不同方法。您可以在回归和分类任务中学习自动化的基础知识。</p>
			<p>我们还将介绍独立Python安装和Anaconda发行版的完整环境设置，并向您展示如何设置虚拟环境。</p>
			<p>本章将涵盖以下主题:</p>
			<ul>
				<li>介绍TPOT</li>
				<li>TPOT可以解决的问题类型</li>
				<li>安装TPOT和设置环境</li>
			</ul>
			<h1 id="_idParaDest-38"><a id="_idTextAnchor037"/>技术要求</h1>
			<p>要完成本章，您只需要一台安装了Python的计算机。单机版和Anaconda都可以。在本章的最后，我们将通过一个虚拟环境来完成两者的安装。</p>
			<p>本章没有代码。</p>
			<h1 id="_idParaDest-39"><a id="_idTextAnchor038"/>介绍TPOT</h1>
			<p><strong class="bold"> TPOT </strong>或<strong class="bold">基于树的流水线优化工具</strong>，是一个开源库，用于使用Python编程语言以自动化方式执行机器学习。在表面之下，它使用<a id="_idIndexMarker086"/>众所周知的<strong class="bold"> scikit-learn </strong>机器学习库来执行<a id="_idIndexMarker087"/>数据准备、转换和机器学习。它还使用GP过程来发现给定数据集的最佳性能管道。GP的概念将在后面的章节中介绍。</p>
			<p>根据经验，每当你需要一个自动化的机器学习管道时，你都应该使用TPOT。数据科学是一个广阔的领域，像TPOT这样的图书馆可以让你花更多的时间在数据收集和清理上，因为其他事情都是自动完成的。</p>
			<p>下图显示了典型的机器学习管道的样子:</p>
			<div><div><img src="img/B16954_02_001.jpg" alt="Figure 2.1 – Example machine learning pipeline&#13;&#10;" width="1330" height="616"/>
				</div>
			</div>
			<p class="figure-caption">图2.1–机器学习管道示例</p>
			<p>上图显示了机器学习过程的哪些部分可以自动化，哪些不能自动化。数据收集阶段(<strong class="bold">原始数据</strong>)对于任何机器学习项目都是必不可少的。在这个阶段，您收集的数据将作为机器学习模型的输入。如果输入数据不够好，或者不够多，机器学习算法就无法产生高质量的模型。</p>
			<p>假设有足够的数据并且您可以访问它，下一个最重要的问题是数据清理。由于显而易见的原因，这个步骤不能自动化，至少不能完全自动化。每个数据集都是不同的；因此，数据清理没有单一的方法。缺少值和格式错误的值是最常见和最耗时的问题类型，它们通常需要大量的领域知识才能成功解决。</p>
			<p>一旦你有了大量准备充分的数据，TPOT就可以开始发挥作用了。TPOT使用GP来寻找特定任务的最佳算法，因此没有必要手动选择和优化单个算法。达尔文的自然选择过程启发了遗传算法，但是在几个章节中会有更多的介绍。</p>
			<p>TPOT管道<a id="_idIndexMarker088"/>有许多参数，这取决于你试图解决的问题的类型(回归或分类)。本章稍后将讨论所有参数，但无论问题类型如何，您都应该知道这些参数:</p>
			<ul>
				<li><code>generations</code>:表示流水线优化过程运行的迭代次数</li>
				<li><code>population_size</code>:代表每代GP群体中保留的个体数量</li>
				<li><code>offspring_size</code>:代表每一代要生育的后代数量</li>
				<li><code>mutation_rate</code>:告诉GP算法每代应用随机变化的管道数量</li>
				<li><code>crossover_rate</code>:告诉GP算法每一代繁殖多少管道</li>
				<li><code>cv</code>:用于评估管道的交叉验证技术</li>
				<li><code>scoring</code>:用于评估给定管道质量的函数</li>
			</ul>
			<p>一旦TPOT完成优化，它将返回找到的最佳管道的Python代码，这样您就可以自己进行模型评估和验证了。下图显示了TPOT管道的一个简化示例:</p>
			<div><div><img src="img/B16954_02_002.jpg" alt="Figure 2.2 – Example TPOT pipeline&#13;&#10;" width="1311" height="522"/>
				</div>
			</div>
			<p class="figure-caption">图2.2-TPOT管道示例</p>
			<p>TPOT图书馆建立在Python众所周知的机器学习包之上。因此，TPOT可以访问它的所有类和方法。上图显示了<strong class="bold"> PCA </strong>和<strong class="bold">多项式特征</strong>作为两种可能的特征预处理操作。TPOT不限于这两种，而是可以使用以下任何一种:</p>
			<ul>
				<li><code>PCA</code></li>
				<li><code>RandomizedPCA</code></li>
				<li><code>PolynomialFeatures</code></li>
				<li><code>Binarizer</code></li>
				<li><code>StandardScaler</code></li>
				<li><code>MinMaxScaler</code></li>
				<li><code>MaxAbsScaler</code></li>
				<li><code>RobustScaler</code></li>
			</ul>
			<p>这些都是内置在<code>scikit-learn</code>中的类，用于以某种方式修改数据集并返回修改后的数据集。下一步涉及某种特征选择。该步骤旨在仅选择具有良好预测能力的特征，并丢弃其他特征。通过这样做，TPOT降低了机器学习问题的维度，最终结果是使问题更容易解决。</p>
			<p>前面的图<a id="_idIndexMarker090"/>隐藏了<strong class="bold">选择最佳特性</strong>步骤背后的抽象。要执行此步骤，TPOT可以使用以下算法之一:</p>
			<ul>
				<li><code>VarianceThreshold</code></li>
				<li><code>SelectKBest</code></li>
				<li><code>SelectPercentile</code></li>
				<li><code>SelectFwe</code></li>
				<li><code>RecursiveFeatureElimination</code></li>
			</ul>
			<p>如你所见，TPOT在模特培训方面非常灵活。为了进一步理解表面之下发生的事情，我们需要了解一点GP。接下来的部分就是这样做的。</p>
			<h2 id="_idParaDest-40"><a id="_idTextAnchor039"/>遗传编程的简要概述</h2>
			<p><strong class="bold"> GP </strong>是一种进化型<a id="_idIndexMarker091"/>算法，是机器学习的子集(<em class="italic">遗传编程页面，GP团队；2019年6月1日</em>)。进化算法用于寻找我们人类不知道如何直接解决的问题的解决方案。这些算法生成的解决方案，在最坏的情况下，可以与最好的人类解决方案相媲美，而且往往更好。</p>
			<p>在机器学习中，GP可以用来发现一个数据集中特征之间的关系(<strong class="bold">回归</strong>)，以及将数据分组到类别中(<strong class="bold">分类</strong>)。在常规软件工程中，GP通过代码合成、遗传改进、自动缺陷修复来应用，并在开发游戏策略中应用(<em class="italic">遗传编程页，GP团队；2019年6月1日</em>)。</p>
			<p>GP受到生物进化及其机制的启发。它使用基于随机变异、交叉、适应度函数和世代的算法来解决前面描述的机器学习的回归和分类任务。这些属性听起来应该很熟悉，因为我们在前一节中已经介绍过了。</p>
			<p>GP背后的想法对于机器学习的进步至关重要，因为它是基于自然选择的达尔文过程。用机器学习的术语来说，这些过程用于生成<a id="_idIndexMarker092"/>最佳解决方案——模型和超参数。</p>
			<p>遗传算法有三个<a id="_idIndexMarker093"/>属性:</p>
			<ul>
				<li><strong class="bold">选择</strong>:由一组可能的解决方案和适应度函数组成。每次迭代都会对每个拟合进行评估。</li>
				<li><strong class="bold">交叉</strong>:选择最佳(最合适)解决方案并进行交叉以创建新群体的过程。</li>
				<li><strong class="bold">变异</strong>:从上一点取孩子，用一些随机的修改对他们进行变异，直到获得最佳解。</li>
			</ul>
			<p>了解你正在处理的语言/库的基础和底层架构总是一个好主意。TPOT是用户友好的，易于使用，所以它不需要我们知道所有关于GP和遗传算法的知识。因此，本章不会深入探讨这个话题。如果你有兴趣学习更多关于GP的知识，你可以在本章末尾找到有用的链接。</p>
			<p>我们已经讨论了很多关于机器学习自动化、TPOT和GP的好的方面。但是有什么不好的地方吗？下一节将讨论其中的几个问题。</p>
			<h2 id="_idParaDest-41"><a id="_idTextAnchor040"/> TPOT的局限性</h2>
			<p>到目前为止，我们只讨论了TPOT图书馆和机器学习过程自动化的<a id="_idIndexMarker094"/>优点。在这种情况下，利大于弊，但我们仍然应该谈论潜在的负面影响。第一个是执行时间。这将因数据集的大小和硬件规格而异，但一般来说，这将需要很长时间才能完成，大型数据集需要几小时或几天，小型数据集只需几分钟。</p>
			<p>了解原因是至关重要的。按照默认的TPOT设置——100代人，100个人口规模——TPOT将在完工前评估10，000条管道。这相当于对一个机器学习模型进行一万次特征工程和训练。正因为如此，预计TPOT会跑得很慢。</p>
			<p>如果你决定引入<strong class="bold">交叉验证</strong>，事情会变得更加复杂。这个术语表示一个过程，其中一个<a id="_idIndexMarker095"/>机器学习模型在<em class="italic">k–1</em>子集上被训练<em class="italic"> k </em>次，并在一个单独的子集上被评估。交叉验证的目标是更准确地表示模型的性能。k的选择是任意的，但是在实践中，最常见的值是10。</p>
			<p>实际上，交叉验证<a id="_idIndexMarker096"/>使得TPOT明显变慢。当使用交叉验证时，默认情况下，TPOT将使用100个群体大小和10个交叉验证折叠来评估100代。这导致在完成之前要评估100，000条不同的管道。</p>
			<p>为了解决这个问题，TPOT引入了<code>max_time_mins</code>参数。默认情况下，它被设置为<code>None</code>，但是您可以将其值显式设置为任何整数。例如，指定<code>max_time_mins=10</code>只会给TPOT 10分钟来优化管道。如果你想要最好的结果，这不是一个理想的解决方案，但当你时间紧迫时，它就派上了用场。</p>
			<p>第二个缺点是，TPOT有时会为同一数据集推荐不同的解决方案(管道)。当TPOT优化器短时间运行时，这通常会是一个问题。例如，如果您已经使用了<code>max_time_mins</code>参数来限制优化器运行的时间，那么您每次都会获得稍微不同的“最优”管道就不足为奇了。</p>
			<p>这不是担心的理由，因为在相同的时间框架内，所有的管道应该仍然优于您可以手动完成的任何事情，但是知道为什么会发生这种情况是很重要的。有两个可能的原因:</p>
			<ul>
				<li><em class="italic">TPOT优化器没有收敛</em>:这是最有可能的情况。由于时间不够，或者数据集过于复杂，无法在给定时间段内进行优化，TPOT无法找到最佳管道(或者两种情况都有)。</li>
				<li><em class="italic">有多条“最佳”流水线</em>:对于一些机器学习问题，许多方法工作方式相同的情况并不少见。如果数据集相对较小，这种情况更有可能发生。</li>
			</ul>
			<p>本节简要介绍了TPOT图书馆，并解释了它的优点和缺点。下一节<a id="_idIndexMarker097"/>回顾了TPOT正在解决的问题类型，并详细讨论了回归和分类任务的自动化。</p>
			<h1 id="_idParaDest-42"><a id="_idTextAnchor041"/>TPOT可以解决的问题类型</h1>
			<p>TPOT图书馆<a id="_idIndexMarker098"/>被设计成自动化机器学习任务的首选工具；因此，它应该能够轻松处理你扔给它的任何东西。我们将很快开始在实际意义上使用TPOT。<a href="B16954_03_Final_SK_ePub.xhtml#_idTextAnchor051"> <em class="italic">第3章</em> </a>，<em class="italic">回归前的探索</em>，用很多例子展示了如何使用库处理实际任务，后面的章节重点介绍其他类型的任务。</p>
			<p>一般来说，TPOT可用于处理以下类型的任务:</p>
			<ul>
				<li><strong class="bold">回归</strong>:其中<a id="_idIndexMarker099"/>目标变量是连续的，如年龄、身高、体重、分数或价格。参考<a href="B16954_01_Final_SK_ePub.xhtml#_idTextAnchor014"> <em class="italic">第1章</em> </a>、<em class="italic">机器学习和自动化的思想</em>，对回归做一个简要的概述。</li>
				<li><strong class="bold">分类</strong>:其中<a id="_idIndexMarker100"/>目标变量为分类变量，如售出/未售出、流失/未流失或是/否。分类的简要概述参见<a href="B16954_01_Final_SK_ePub.xhtml#_idTextAnchor014"> <em class="italic">第1章</em> </a>、<em class="italic">机器学习和自动化思想</em>。</li>
				<li><strong class="bold">并行训练</strong> : TPOT可以通过<strong class="bold"> Dask </strong>库并行处理机器学习模型的<a id="_idIndexMarker101"/>训练。请阅读<a href="B16954_05_Final_SK_ePub.xhtml#_idTextAnchor065"> <em class="italic">第五章</em> </a>，<em class="italic">与TPOT和达斯克</em>的平行训练，以获得全貌。</li>
				<li><strong class="bold">神经网络</strong> : TPOT甚至可以<a id="_idIndexMarker102"/>基于最先进的神经网络算法以全自动的方式建立模型。请阅读<a href="B16954_06_Final_SK_ePub.xhtml#_idTextAnchor073"> <em class="italic">第六章</em> </a>，<em class="italic">深度学习入门——神经网络速成班</em>，了解神经网络速成班<a href="B16954_07_Final_SK_ePub.xhtml#_idTextAnchor086"> <em class="italic">第七章</em> </a>，<em class="italic">神经网络分类器搭配TPOT </em>，了解TPOT的实际实现。</li>
			</ul>
			<p>本节的其余部分简要讨论了TPOT如何处理回归和分类任务，并花了大量的时间探索和解释它们的参数、属性和功能。你会在<a href="B16954_05_Final_SK_ePub.xhtml#_idTextAnchor065"> <em class="italic">第五章</em></a><em class="italic">与TPOT和Dask </em>的并行训练中了解到TPOT是如何处理与Dask的并行训练的，在<a href="B16954_06_Final_SK_ePub.xhtml#_idTextAnchor073"> <em class="italic">第六章</em></a><em class="italic">深度学习入门——神经网络速成班</em>中了解到它是如何处理神经网络的，因为这些题目需要先覆盖前提条件。</p>
			<h2 id="_idParaDest-43">TPOT如何处理回归任务</h2>
			<p>TPOT库通过<code>tpot.TPOTRegressor</code>类处理<a id="_idIndexMarker104"/>回归任务。该类对机器学习管道执行智能搜索，该管道包含监督回归模型、预处理器、特征选择技术以及遵循<code>scikit-learn</code> API ( <em class="italic"> TPOT文档页面，TPOT团队；2019年11月5日</em>)。</p>
			<p>同一个类还对管道中所有对象的超参数执行搜索。<code>tpot.TPOTRegressor</code>类允许我们完全定制通过<code>config_dict</code>参数搜索的模型、变压器和参数。</p>
			<p>我们现在将检查<code>tpot.TPOTRegressor</code>类在实例化时期望的参数:</p>
			<ul>
				<li><code>generations</code>:整数或无(默认= <code>100</code>)。可选参数，指定运行管道优化过程的迭代次数。肯定是正面的。如果未定义，则必须指定<code>max_time_mins</code>参数。</li>
				<li><code>population_size</code>:整数(默认= <code>100</code>)。一个可选参数，指定每代GP群体中保留的个体数量。必须是正数。</li>
				<li><code>offspring_size</code>:整数(默认=同<code>population_size</code>)。一个可选参数，用于指定每个GP世代中要产生的子代数量。必须是正数。</li>
				<li><code>mutation_rate</code>:浮点型(默认= <code>0.9</code>)。一个可选参数，用于指定GP算法的变异率。必须在[0.0，1.0]范围内。此参数用于指示算法有多少个管道将随机更改应用于每一代。</li>
				<li><code>crossover_rate</code>:浮点型(默认= <code>0.1</code>)。一个可选参数，指示GP算法每一代“繁殖”多少管道。必须在[0.0，1.0]范围内。</li>
				<li><code>scoring</code>:字符串或<a id="_idIndexMarker105"/>可调用(默认= <code>neg_mean_squared_error</code>)。一个可选参数，用于指定回归管道评估的函数名。可以是<code>neg_median_abs_value</code>、<code>neg_mean_abs_error</code>、<code>neg_mean_squared_error</code>或<code>r2</code>。</li>
				<li><code>cv</code>:整数、交叉验证生成器或可迭代函数(默认= <code>5</code>)。一个可选参数，用于指定评估回归管道的交叉验证策略。如果传递的值是一个整数，它需要的是折叠的次数。在其他情况下，它期望一个对象分别被用作交叉验证生成器，或者一个可迭代的生成训练/测试分割。</li>
				<li><code>subsample</code>:浮点型(默认= <code>1.0</code>)。一个可选参数，用于指定优化过程中使用的一部分训练样本的值。必须在[0.0，1.0]范围内。</li>
				<li><code>n_jobs</code>:整数(默认= <code>1</code>)。一个可选参数，用于指定在优化过程中评估管道时并行使用的进程数量。将其设置为<code>-1</code>以使用所有CPU内核。将其设置为<code>-2</code>以使用除一个CPU内核之外的所有CPU内核。</li>
				<li><code>max_time_mins</code>:整数或无(默认= <code>None</code>)。可选参数，用于指定TPOT可以执行优化的分钟数。只有当所有代都在指定的最大时间(分钟)之前进行评估时，TPOT才会优化更少的时间。</li>
				<li><code>max_eval_time_mins</code> : Float(默认= <code>5</code>)。一个可选参数，用于指定TPOT评估单个管道的时间。如果该参数设置为足够高的值，TPOT将评估更复杂的管道。同时，这也让TPOT跑得更久。</li>
				<li><code>random_state</code>:整数或无(默认= <code>None</code>)。可选参数，用于指定伪随机数生成器的种子。使用它获得可重复的结果。</li>
				<li><code>config_dict</code>: Dictionary, string, or None (default = <code>None</code>). An optional parameter used to specify <a id="_idIndexMarker106"/>a configuration dictionary for customizing the operators and parameters that TPOT searches during optimization. Possible inputs are as follows:<p>a) <em class="italic">无</em> : TPOT使用默认配置。</p><p>b) <em class="italic"> Python字典</em> : TPOT使用你的配置。</p><p>c)<em class="italic">‘TPOT之光’</em>:字符串；TPOT将使用只有快速模型和预处理器的内置配置。</p><p>d)<em class="italic">‘TPOT MDR’</em>:字符串；TPOT将使用专门用于基因组研究的内置配置。</p><p>e)<em class="italic">‘TPOT稀疏’</em>:字符串；TPOT将使用一个配置字典和一个支持稀疏矩阵的一次性编码器和操作符。</p></li>
				<li><code>template</code>:字符串(默认= <code>None</code>)。用于指定预定义管道模板的可选参数。用于指定由TPOT评估的机器学习管道的所需结构。</li>
				<li><code>warm_start</code>:布尔型(默认= <code>False</code>)。一个可选参数，用于指示当前实例是否应该重用以前调用<code>fit()</code>函数时的填充。该功能将在本章后面讨论。</li>
				<li><code>memory</code>:内存对象或字符串(默认= <code>None</code>)。一个可选参数，用于在调用<code>fit()</code>函数后缓存每个转换器。该功能将在本章后面讨论。</li>
				<li><code>use_dask</code>:布尔型(默认= <code>False</code>)。一个可选参数，用于指定是否应该使用<em class="italic"> Dask-ML的</em>管道优化。</li>
				<li><code>periodic_checkpoint_folder</code>:路径字符串(默认= <code>None</code>)。可选参数<a id="_idIndexMarker107"/>用于指定TPOT在优化时将管道保存在哪个文件夹中。</li>
				<li><code>early_stop</code>:整数(默认= <code>None</code>)。一个可选参数，用于指定多少代后，如果没有改善，TPOT将停止优化。</li>
				<li><code>verbosity</code>: Integer (default = <code>0</code>). An optional parameter used to specify how much information TPOT outputs to the console while running. Possible options are as follows:<p>T42:TPOT不印刷任何东西。</p><p>b) <em class="italic"> 1 </em> : TPOT打印最少的信息。</p><p>c) <em class="italic"> 2 </em> : TPOT打印更多信息并提供一个进度条。</p><p>d) <em class="italic"> 3 </em> : TPOT打印所有内容并提供一个进度条。</p></li>
				<li><code>disable_update_check</code>:布尔型(默认= <code>False</code>)。可选参数，指示是否应禁用TPOT版本检查器。您可以忽略此参数，因为它只告诉您是否有更新版本的库可用，与实际培训无关。</li>
			</ul>
			<p>如果你的目标是真正掌握这个库——至少是处理回归任务的那部分，你应该知道很多参数。我们只讨论了<code>tpot.TPOTRegressor</code>类的参数，接下来我们将讨论属性和函数。不用担心；只有几个可用的。</p>
			<p>先说属性。总共有三个。一旦安装好管道，这些就可用了:</p>
			<ul>
				<li><code>fitted_pipeline_</code>:来自<code>scikit-learn</code>的管道对象。向您展示了TPOT在给定训练集的优化过程中发现的最佳管道<a id="_idIndexMarker108"/>。</li>
				<li><code>pareto_front_fitted_pipelines_</code> : Python字典。它包含了TPOT帕累托前线的所有管道。字典键是表示管道的字符串，值是对应的管道。该参数仅在<code>verbosity</code>参数设置为<code>3</code>时可用。</li>
				<li><code>evaluated_individuals_</code> : Python字典。它包含所有评估的管线。字典键是表示管道的字符串，值是一个元组，包含每个管道中的步骤数和相应的准确性度量。</li>
			</ul>
			<p>在接下来的章节中，我们将会看到提到的属性在实践中是如何工作的。本节唯一要讨论的是属于<code>tpot.TPOTRegressor</code>类的函数。总共有四个:</p>
			<ul>
				<li><code>fit(features, target, sample_weight=None, groups=None)</code>:该功能用于运行TPOT优化过程。<code>features</code>参数是用于预测目标变量的特征/预测器/属性的数组。<code>target</code>参数也是一个数组，指定预测的目标标签列表。另外两个参数是可选的。<code>sample_weights</code>参数是指示每个样本权重的数组。权重越高表示越重要。最后一个参数<code>groups</code>是一个数组，它为执行交叉验证时使用的样本指定组标签。它只能与组交叉验证功能结合使用。<code>fit()</code>函数返回拟合的TPOT对象的副本。</li>
				<li><code>predict(features)</code>:该函数用于根据<code>features</code>参数生成新的预测。该参数是包含用于预测目标变量的特征/预测器/属性的数组。该函数返回一个预测数组。</li>
				<li><code>score(testing_features, testing_target)</code>:该函数返回优化后的流水线在给定测试数据上的得分。该函数接受两个参数。第一个是<code>testing_features</code>。它是测试集的数组/特征矩阵。第二个是<code>testing_target</code>。它也是一个数组，但是包含用于训练集中预测的<a id="_idIndexMarker109"/>目标标签。该函数返回测试集的准确度分数。</li>
				<li><code>export(output_file_name)</code>:该函数用于将优化后的管道导出为Python代码。该函数接受单个参数<code>output_file_name</code>。它用于指定存储Python代码的路径和文件名。如果没有指定上述参数的值，整个管道将以文本形式返回。</li>
			</ul>
			<p>概述了参数、属性和函数之后，您就可以在实践中使用TPOT的回归功能了。<a href="B16954_03_Final_SK_ePub.xhtml#_idTextAnchor051"> <em class="italic">第3章</em> </a>，<em class="italic">回归前的探索</em>，里面都是回归的例子，所以如果你想自动化回归任务的话，就不要犹豫了。</p>
			<p>本章的下一节将讨论TPOT如何处理分类任务。</p>
			<h2 id="_idParaDest-44"><a id="_idTextAnchor043"/>TPOT如何处理分类任务</h2>
			<p>TPOT库<a id="_idIndexMarker110"/>通过<code>tpot.TPOTClassifer</code>类处理分类任务。该类对包含监督回归模型、预处理器、特征选择技术以及任何其他遵循<code>scikit-learn</code> API的估计器或转换器的机器学习管道进行搜索(<em class="italic"> TPOT文档页面，TPOT团队；2019年11月5日</em>)。该类还对管道中所有对象的超参数执行搜索。</p>
			<p><code>tpot.TPOTClassifier</code>类允许我们完全定制将通过<code>config_dict</code>参数搜索的模型、变压器和参数。</p>
			<p><code>tpot.TPOTClassifier</code>类包含与之前讨论的<code>tpot.TPOTRegressor</code>几乎相同的参数、属性和函数，所以在<a id="_idIndexMarker111"/>中再次详细讨论它们是多余的。相反，我们将只提到相同的参数、属性和函数，并且我们将介绍和解释那些对于分类是唯一的或者工作方式不同的参数、属性和函数。</p>
			<p>首先，让我们检查一下参数:</p>
			<ul>
				<li><code>generations</code></li>
				<li><code>population_size</code></li>
				<li><code>offspring_size</code></li>
				<li><code>mutation_rate</code></li>
				<li><code>crossover_rate</code></li>
				<li><code>scoring</code> : String或callable(默认= <code>accuracy</code>)。这是一个可选参数，用于针对分类问题评估给定管道的质量。可以使用以下评分功能:<code>accuracy</code>、<code>adjusted_rand_score</code>、<code>average_precision</code>、<code>balanced_accuracy</code>、<code>f1</code>、<code>f1_macro</code>、<code>f1_micro</code>、<code>f1_samples</code>、<code>f1_weighted</code>、<code>neg_log_loss</code>、<code>precision</code>、<code>recall</code>、<code>recall_macro</code>、<code>recall_micro</code>、<code>recall_samples</code>、<code>recall_weighted</code>、<code>jaccard</code>、<code>jaccard_macro</code>、<code>jaccard_micro</code>、<code>jaccard_samples</code>、<code>jaccard_weighted</code>、<code>roc_auc</code>、<code>roc_auc_ovr</code>、<code>roc_auc_ovo</code>。如果要使用自定义的评分函数，可以用下面的签名作为函数传递:<code>scorer(estimator, X, y)</code>。</li>
				<li><code>cv</code></li>
				<li><code>subsample</code></li>
				<li><code>n_jobs</code></li>
				<li><code>max_time_mins</code></li>
				<li><code>max_eval_time_mins</code></li>
				<li><code>random_state</code></li>
				<li><code>config_dict</code></li>
				<li><code>template</code></li>
				<li><code>warm_start</code></li>
				<li><code>memory</code></li>
				<li><code>use_dask</code></li>
				<li><code>periodic_checkpoint_folder</code></li>
				<li><code>early_stop</code></li>
				<li><code>verbosity</code></li>
				<li><code>disable_update_check</code></li>
				<li><code>log_file</code>:类似文件的类或字符串(默认= <code>None</code>)。这是一个可选参数，用于将进度内容保存到文件中。如果提供了字符串值，它应该是所需输出文件的路径和文件名。</li>
			</ul>
			<p>我们可以看到，一个参数<a id="_idIndexMarker112"/>变了，一个参数是全新的。重复一遍——请参考前面的小节，详细了解每个参数的作用。</p>
			<p>接下来，我们必须讨论<code>tpot.TPOTClassifier</code>类的属性。一旦管道优化过程完成，这些就变得可用。总共有三个，它们的行为都与<code>tpot.TPOTRegressor</code>类相同:</p>
			<ul>
				<li><code>fitted_pipeline_</code></li>
				<li><code>pareto_front_fitted_pipelines_</code></li>
				<li><code>evaluated_individuals_</code></li>
			</ul>
			<p>最后，我们将讨论函数。与参数一样，所有参数都列出来了，但只详细讨论新的和更改的参数。总共有五个功能:</p>
			<ul>
				<li><code>fit(features, classes, sample_weight=None, groups=None)</code>:该功能与<code>tpot.TPOTRegressor</code>中的功能相同，但第二个参数被称为<code>classes</code>而不是<code>target</code>。此参数需要一个用于预测的类标签数组。</li>
				<li><code>predict(features)</code></li>
				<li><code>predict_proba(features)</code>:该函数执行与<code>predict()</code>函数相同的任务，但是返回类别概率而不是类别。通过检查概率，您可以看到模型在哪些地方对预测完全确定，在哪些地方不那么确定。您还可以使用类别概率来调整决策阈值。你将在第四章 、<em class="italic">分类前探索</em>中学习如何做到这一点。</li>
				<li><code>score(testing_features, testing_target)</code></li>
				<li><code>export(output_file_name)</code></li>
			</ul>
			<p>你现在已经准备好<a id="_idIndexMarker113"/>去看看TPOT在实践中是如何运作的。大多数时候，没有必要对列出的一些参数动手脚，但是您需要知道它们是为更高级的用例而存在的。<a href="B16954_04_Final_SK_ePub.xhtml#_idTextAnchor058"> <em class="italic">第4章</em> </a>，<em class="italic">分类前的探索</em>，里面有很多分类的例子，所以如果你想学习如何自动化分类任务的话，不要犹豫，马上开始吧。</p>
			<p>本章的下一节将讨论如何通过虚拟环境建立TPOT环境，包括独立Python安装和通过Anaconda安装。</p>
			<h1 id="_idParaDest-45"><a id="_idTextAnchor044"/>安装TPOT并设置环境</h1>
			<p>本节讨论了在开始实际工作之前的最后一个必需的<a id="_idIndexMarker114"/>步骤——安装和环境设置。假设您已经安装了Python 3，无论是通过独立安装还是通过Anaconda。</p>
			<p>您将了解如何在以下场景中为TPOT设置虚拟环境:</p>
			<ul>
				<li>独立Python</li>
				<li>蟒蛇</li>
			</ul>
			<p>没有必要阅读两个安装部分，所以只需选择更适合你的部分。操作系统之间的安装不应该有任何不同。如果您将Python作为独立安装安装，您可以通过终端访问<code>pip</code>。如果您通过Anaconda安装了它，就可以访问Anaconda Navigator。</p>
			<h2 id="_idParaDest-46"><a id="_idTextAnchor045"/>使用独立Python安装来安装和配置TPOT</h2>
			<p>在继续之前，确保已经安装了Python <a id="_idIndexMarker116"/>和<code>pip</code>(Python的包管理器)。您可以通过在终端中输入以下代码来检查<code>pip</code>是否已安装:</p>
			<pre>&gt; pip</pre>
			<p>如果您看到如下图所示的输出，就可以开始了:</p>
			<div><div><img src="img/B16954_02_003.jpg" alt="Figure 2.3 – Checking whether pip is installed&#13;&#10;" width="967" height="733"/>
				</div>
			</div>
			<p class="figure-caption">图2.3–检查是否安装了pip</p>
			<p>我们现在可以<a id="_idIndexMarker118"/>继续进行虚拟环境设置:</p>
			<ol>
				<li><a id="_idIndexMarker119"/>首先要做的是安装<code>virtualenv</code>包。为此，从终端执行以下代码:<pre><strong class="bold">&gt; pip install virtualenv</strong></pre></li>
				<li>After a couple of seconds, you should see a success message, as shown in the following figure:<div><img src="img/B16954_02_004.jpg" alt="Figure 2.4 – virtualenv installation&#13;&#10;" width="1380" height="490"/></div><p class="figure-caption">图2.4–virtualenv安装</p></li>
				<li>下一步是<a id="_idIndexMarker120"/>创建一个文件夹来存储TPOT环境。我们的位于<code>Documents</code>文件夹中，但是你可以把它存储在任何地方。下面是创建文件夹和安装Python虚拟环境需要执行的确切shell行【T20:<pre><strong class="bold">&gt; cd Documents</strong> <strong class="bold">&gt; mkdir python_venvs</strong> <strong class="bold">&gt; virtualenv python_venvs/tpot_env</strong></pre></li>
				<li>The execution and results are shown in the following figure:<div><img src="img/B16954_02_005.jpg" alt="Figure 2.5 – Creating a virtual environment&#13;&#10;" width="1387" height="513"/></div><p class="figure-caption">图2.5–创建虚拟环境</p><p>现在，环境已成功安装。</p></li>
				<li>要激活<a id="_idIndexMarker122"/>环境，您需要从终端执行下面一行:<pre><strong class="bold">&gt; source python_venvs/tpot_env/bin/activate</strong></pre></li>
				<li>The text in parentheses confirms that the environment is activated. Take a look at the change from the <code>base</code> environment to <code>tpot_env</code> in the following figure:<div><img src="img/B16954_02_006.jpg" alt="Figure 2.6 – Activating a virtual environment&#13;&#10;" width="1357" height="128"/></div><p class="figure-caption">图2.6–激活虚拟环境</p></li>
				<li>要停用<a id="_idIndexMarker123"/>环境，请在终端中输入以下行:<pre><code>jupyterlab</code>: A notebook environment required for analyzing and exploring data and building machine learning models in an interactive way.</pre></li><li><code>numpy</code> : Python数值计算的首选库。</li><li><code>pandas</code>:知名的数据加载、处理、准备、转换、聚合甚至可视化的库。</li><li><code>matplotlib</code> : Python的标准数据可视化库。我们有时会在基本情节中使用它。</li><li><code>seaborn</code>:数据可视化库<a id="_idIndexMarker124"/>，比<code>matplotlib</code>更具美感的视觉效果。</li><li><code>scikit-learn</code> : Python的机器学习和与之相关的一切的必去库。</li><li><code>TPOT</code>:用于自动寻找最优的机器学习流水线。</li>
				<li>To install every<a id="_idIndexMarker125"/> mentioned library, you can execute the following line from the opened terminal window:<pre><strong class="bold">&gt; pip install jupyterlab numpy pandas matplotlib seaborn scikit-learn TPOT</strong></pre><p>Python将立即开始下载和安装库，如下图所示:</p><div><img src="img/B16954_02_008.jpg" alt="Figure 2.8 – Installing libraries with pip&#13;&#10;" width="1379" height="624"/></div><p class="figure-caption">图2.8–使用pip安装库</p></li>
				<li>To test whether the<a id="_idIndexMarker126"/> environment was successfully configured, we can open <code>JupyterLab</code> from the terminal. Execute the following shell command once the libraries are installed:<pre><strong class="bold">&gt; jupyter lab</strong></pre><p>如果你看到类似下面的东西，那么一切都按计划进行。带有Jupyter的浏览器窗口应该会立即打开:</p><div><img src="img/B16954_02_009.jpg" alt="Figure 2.9 – Starting JupyterLab for standalone installation&#13;&#10;" width="1379" height="383"/></div><p class="figure-caption">图2.9–启动JupyterLab进行独立安装</p></li>
				<li>For the final check, we<a id="_idIndexMarker128"/> will take a look at which Python version came with the environment. This can be done straight from the notebooks, as shown in the following figure:<div><img src="img/B16954_02_010.jpg" alt="Figure 2.10 – Checking the Python version for the standalone installation&#13;&#10;" width="950" height="182"/></div><p class="figure-caption">图2.10–检查独立安装的Python版本</p></li>
				<li>最后，我们将通过导入并打印版本来查看TPOT库是否已安装。这项检查也可以在笔记本上完成。按照下图中的说明查看如何操作:</li>
			</ol>
			<div><div><img src="img/B16954_02_011.jpg" alt="Figure 2.11 – Checking the TPOT version for the standalone installation&#13;&#10;" width="363" height="189"/>
				</div>
			</div>
			<p class="figure-caption">图2.11–检查独立安装的TPOT版本</p>
			<p>TPOT现已成功安装在虚拟环境中。下一节将介绍如何安装和配置Anaconda环境。</p>
			<h2 id="_idParaDest-47"><a id="_idTextAnchor046"/>通过Anaconda安装和配置TPOT</h2>
			<p>在继续之前，确保您的机器上安装了Anaconda。我们将使用Anaconda来创建和管理我们的<a id="_idIndexMarker132"/>环境，并在那里进行配置:</p>
			<ol>
				<li value="1">To start, open up Anaconda Navigator:<div><img src="img/B16954_02_012.jpg" alt="Figure 2.12 – Anaconda Navigator&#13;&#10;" width="1319" height="699"/></div><p class="figure-caption">图2.12-Anaconda导航器</p></li>
				<li>To create a new virtual environment, click on the <strong class="bold">Create</strong> button in the bottom-left portion of the<a id="_idIndexMarker133"/> screen:<div><img src="img/B16954_02_013.jpg" alt="Figure 2.13 – Creating a new environment in Anaconda&#13;&#10;" width="1312" height="704"/></div><p class="figure-caption">图2.13–在Anaconda中创建新环境</p></li>
				<li>After clicking on the <code>base (root)</code> environment. Here's how it should look:<div><img src="img/B16954_02_015.jpg" alt="Figure 2.15 – Listing of all virtual environments&#13;&#10;" width="1284" height="697"/></div><p class="figure-caption">图2.15–所有虚拟环境列表</p></li>
				<li>现在，您可以在虚拟环境中安装库了。Anaconda可以轻松地从终端打开环境，只需点击播放按钮上的<a id="_idIndexMarker138"/>并选择<code>jupyterlab</code>:一个笔记本<a id="_idIndexMarker140"/>环境，这是分析和探索数据以及以交互方式构建机器学习模型所需的环境。</li><li><code>numpy</code> : Python的数值计算库。</li><li><code>pandas</code>:知名的数据加载、处理、准备、转换、聚合甚至可视化的库。</li><li><code>matplotlib</code> : Python的标准数据可视化库。我们有时会在基本情节中使用它。</li><li><code>seaborn</code>:比<code>matplotlib</code>更美观的数据可视化库。</li><li><code>scikit-learn</code> : Python的机器学习和与之相关的一切的go-to库。</li><li><code>TPOT</code>:用于自动寻找最优的机器学习流水线。</li>
				<li>To install every mentioned library, you <a id="_idIndexMarker141"/>can execute the following line from the opened terminal window:<pre><strong class="bold">&gt; pip install jupyterlab numpy pandas matplotlib seaborn scikit-learn TPOT</strong></pre><p>Python应该立即<a id="_idIndexMarker142"/>开始下载和安装库，如下图所示:</p><div><img src="img/B16954_02_017.jpg" alt="Figure 2.17 – Library installation through the terminal&#13;&#10;" width="1377" height="394"/></div><p class="figure-caption">图2.17–通过终端安装库</p></li>
				<li>To test whether the environment was successfully configured, we can open <code>JupyterLab</code> from the terminal. Execute the following shell command once the libraries are installed:<pre><strong class="bold">&gt; jupyter lab</strong></pre><p>如果您看到类似下面的内容，那么一切都按计划进行。带有Jupyter的浏览器窗口应该会立即打开:</p><div><img src="img/B16954_02_018.jpg" alt="Figure 2.18 – Starting JupyterLab from the terminal&#13;&#10;" width="1379" height="407"/></div><p class="figure-caption">图2.18–从终端启动JupyterLab</p></li>
				<li>For the final check, we will take<a id="_idIndexMarker143"/> a look at which Python version came with the<a id="_idIndexMarker144"/> environment. This can be done straight from the notebooks, as shown in the following figure:<div><img src="img/B16954_02_019.jpg" alt="Figure 2.19 – Checking the Python version&#13;&#10;" width="931" height="184"/></div><p class="figure-caption">图2.19–检查Python版本</p></li>
				<li>最后，我们将通过导入并打印版本来查看TPOT库是否已安装。这项检查也可以在笔记本上完成。按照下图中的说明查看如何操作:</li>
			</ol>
			<div><div><img src="img/B16954_02_020.jpg" alt="Figure 2.20 – Checking the TPOT version&#13;&#10;" width="185" height="103"/>
				</div>
			</div>
			<p class="figure-caption">图2.20–检查TPOT版本</p>
			<p>我们现在准备好<a id="_idIndexMarker145"/>继续TPOT的实际应用。</p>
			<h1 id="_idParaDest-48"><a id="_idTextAnchor047"/>总结</h1>
			<p>你在这一章学到了很多——从TPOT如何工作和GP到用<code>pip</code>和Anaconda设置环境。现在，您已经准备好以自动化的方式处理实际任务了。</p>
			<p>下一章通过几个例子深入探讨了用TPOT处理回归任务。在我们动手实践之后，本章所讨论的一切将会变得更加清晰。然后，在<a href="B16954_04_Final_SK_ePub.xhtml#_idTextAnchor058"> <em class="italic">第四章</em></a><em class="italic">分类前探索</em>中，你会通过解决分类任务来进一步强化你的知识。</p>
			<h1 id="_idParaDest-49">问&amp;答</h1>
			<ol>
				<li value="1">用你自己的话来定义TPOT图书馆。</li>
				<li>说出并解释几个TPOT的局限性。</li>
				<li>你会如何限制TPOT的优化时间？</li>
				<li>简要定义术语“遗传编程”</li>
				<li>列出并解释<code>tpot.TPOTRegressor</code>类的五个参数。</li>
				<li>列出并解释<code>tpot.TPOTClassifier</code>类中引入的不同的和新的参数。</li>
				<li>什么是虚拟环境，为什么它们有用？</li>
			</ol>
			<h1 id="_idParaDest-50"><a id="_idTextAnchor049"/>延伸阅读</h1>
			<p>以下是我们在本章中引用的资源:</p>
			<ul>
				<li><em class="italic">基因编程页面</em>:<a href="http://geneticprogramming.com/">http://geneticprogramming.com</a></li>
				<li><em class="italic">http://epistasislab.github.io/tpot/ TPOT文件页</em>:<a href="http://epistasislab.github.io/tpot/%20"/></li>
			</ul>
		</div>
	</div>
</body></html>