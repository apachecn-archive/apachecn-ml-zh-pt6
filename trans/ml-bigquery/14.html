<html><head/><body>


	
		<title>B16722_11_Final_ASB_ePub</title>
		
	
	
		<div><h1 id="_idParaDest-158"><em class="italic"> <a id="_idTextAnchor160"/>第十一章</em>:实现深度神经网络</h1>
			<p><strong class="bold">深度神经网络</strong> ( <strong class="bold"> DNNs </strong>)是<a id="_idIndexMarker506"/>实现机器学习算法的最先进技术之一。它们被广泛用于不同的用例，可以被认为在日常生活中无处不在。</p>
			<p>当我们与虚拟助理交互时，或者我们使用移动应用程序进行自动翻译和图像识别时，我们正在利用经过大型音频和图像数据集训练的dnn的功能。</p>
			<p>阅读完本章后，您将能够使用BigQuery ML开发、评估和测试一个DNN。在本章中，我们将通过使用BigQuery ML来预测与纽约市自行车共享服务相关的租赁期限，从而了解实现DNN所需的所有步骤。</p>
			<p>使用BigQuery ML，我们将浏览以下主题:</p>
			<ul>
				<li>介绍业务场景</li>
				<li>发现DNNs</li>
				<li>准备数据集</li>
				<li>训练DNN模型</li>
				<li>评估DNN模型</li>
				<li>使用DNN模型</li>
				<li>得出商业结论</li>
			</ul>
			<h1 id="_idParaDest-159"><a id="_idTextAnchor161"/>技术要求</h1>
			<p>本章要求您能够访问网络浏览器，并能够利用以下内容:</p>
			<ul>
				<li>访问谷歌云控制台的GCP帐户</li>
				<li>托管BigQuery数据集的GCP项目</li>
			</ul>
			<p>现在我们已经准备好了技术需求，让我们开始分析和开发我们的BigQuery ML DNN模型。</p>
			<p>看看下面的视频，看看运行中的代码:<a href="https://bit.ly/33lbq8A">https://bit.ly/33lbq8A</a></p>
			<h1 id="_idParaDest-160"><a id="_idTextAnchor162"/>介绍业务场景</h1>
			<p>在本节中，您将<a id="_idIndexMarker507"/>了解将使用DNNs技术处理的业务场景。</p>
			<p>该业务场景与第四章 、<em class="italic">中提出并使用的用例<a href="B16722_04_Final_ASB_ePub.xhtml#_idTextAnchor061"> <em class="italic">、</em>用线性回归预测数值非常相似。在本章中，我们将使用与纽约市自行车共享服务相关的相同数据集，但我们将应用更高级的机器学习算法。</a></em></p>
			<p>我们可以记住ML模型的假设目标是预测自行车租赁的行程时间。预测值可用于通过新的移动应用程序为自行车共享服务的客户提供更好的体验。利用预测的乘坐持续时间，客户将获得到达特定目的地所需时间的明确指示，以及乘坐成本的估计。</p>
			<p>既然我们已经解释并理解了业务场景，那么让我们来看看可以用来根据树的特征对树进行自动分类的机器学习技术。</p>
			<h1 id="_idParaDest-161"><a id="_idTextAnchor163"/>发现DNNs</h1>
			<p>在本节中，我们将<a id="_idIndexMarker508"/>了解什么是<strong class="bold">dnn</strong>，并且我们将了解哪些回归和分类用例可以用高级机器学习算法来管理。</p>
			<p><strong class="bold">人工神经网络</strong> ( <strong class="bold"> ANNs </strong>)是试图复制人脑的<a id="_idIndexMarker509"/>人工系统。它们受到生物神经网络的启发，由神经元和连接神经元的突触组成。人工网络的每个神经元都是一个组件，它将特定的数学激活函数应用于输入，并返回通过突触传递给下一个神经元的输出。在人工神经网络中，神经元通常在输入和输出之间分层组织。</p>
			<p>与线性模型不同，人工神经网络设计用于模拟输入和输出变量之间的非线性关系。</p>
			<p><strong class="bold"> DNNs </strong>是由输入和输出之间的多层组成的<a id="_idIndexMarker510"/>ann，通常为两层或多层。每一层神经元被称为隐藏层，其功能是接受一系列输入信号并向下一层返回一系列输出信号。</p>
			<p>在下图中，我们可以看到DNN由三个输入变量、两个隐藏层和一个输出变量组成:</p>
			<div><div><img src="img/B16722_11_001.jpg" alt="Figure 11.1 – Diagram of a DNN&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">图11.1-DNN示意图</p>
			<p>网络中的每个神经元将特定函数应用于输入信号，并将该函数的输出作为神经元的输出返回。训练DNN是一项专注于找到网络中每个神经元之间每个突触的正确权重的活动。</p>
			<p>虽然，为了实现DNNs的潜力，我们需要重要的硬件资源，但是用这种技术实现的机器学习模型可以在人脑典型的重要任务中实现最佳结果。一些例子如下:</p>
			<ul>
				<li><strong class="bold">语音识别</strong>:处理音频文件以识别演讲词，使其可读的<a id="_idIndexMarker512"/>能力。这种功能广泛应用于智能手机的虚拟助手或联络中心应用程序中。</li>
				<li><strong class="bold">图像和人脸识别</strong>:识别<a id="_idIndexMarker513"/>图片和视频中不同实体、动物或人物的可能性。这种技术对于从图像和视频中自动提取洞察力非常有用，避免了任何手动操作。</li>
				<li><strong class="bold">自然语言处理</strong>:广泛用于从自由<a id="_idIndexMarker514"/>文本中分析和检索信息，并分析信息的情感。例如，这些类型的算法用于自动识别社交网络中的政策违规，或者评估产品评论中的情绪。</li>
			</ul>
			<p>既然我们已经发现了dnn是什么，那么让我们来关注BigQuery ML如何提供这些强大的算法。</p>
			<h2 id="_idParaDest-162"><a id="_idTextAnchor164"/>big query ML中的DNNs</h2>
			<p>在这一节中，我们将学习<a id="_idIndexMarker515"/>big query ML提供的模型类型选项<a id="_idIndexMarker516"/>来创建一个DNN模型。</p>
			<p>BigQuery ML允许您创建两种不同类型的dnn:</p>
			<ul>
				<li><strong class="bold"> DNNClassifier </strong>:该<a id="_idIndexMarker517"/>算法可用于将事件、对象或实体分类为有限数量的离散类。</li>
				<li><strong class="bold"> DNNRegressor </strong>:这种<a id="_idIndexMarker518"/>模型与前一种类似，不同之处在于它返回一个连续的结果。因此，它可以用来预测数值。</li>
			</ul>
			<p>对于我们的业务场景，我们将使用<strong class="bold"> DNNRegressor </strong>，因为<a id="_idIndexMarker519"/>我们的目标是预测一个连续值:<em class="italic">自行车租赁的骑行时间</em>。</p>
			<p>当我们根据我们的使用<a id="_idIndexMarker521"/>案例选择了使用哪种类型的<a id="_idIndexMarker520"/> DNN时，下一个选择将集中在每个神经元将应用于输入信号的功能上。BigQuery ML允许我们选择以下函数之一:</p>
			<ul>
				<li><strong class="bold">整流线性函数</strong> ( <strong class="bold"> ReLU </strong>):这是一个线性函数，如果<a id="_idIndexMarker522"/>为正，则返回输入值本身，否则返回零。</li>
				<li><strong class="bold"> ReLU6 </strong>:这是<a id="_idIndexMarker523"/>类似于前面的功能，最大输出值上限为6。这只是从不同函数的经验测试中得出的任意值。</li>
				<li><strong class="bold">串联整流线性单元</strong> ( <strong class="bold"> CReLU </strong>):与前面的功能不同，它保留了<a id="_idIndexMarker524"/>负值。</li>
				<li><strong class="bold">指数线性单元</strong> ( <strong class="bold"> ELU </strong>):这是<a id="_idIndexMarker525"/>一个指数函数，倾向于更快地收敛到结果，并产生更精确的输出。</li>
				<li><strong class="bold">比例指数线性单元</strong> ( <strong class="bold"> SELU </strong>):这是ELU的一个演化，增加了<a id="_idIndexMarker526"/>数学函数的自规范化。</li>
				<li><strong class="bold"> SIGMOID </strong>:这类似于<a id="_idIndexMarker527"/>阶跃函数，总是输出0到1之间的值。该功能将非线性引入DNN。</li>
				<li><strong class="bold"> TANH </strong>:这是<a id="_idIndexMarker528"/>类似于sigmoid函数，但是返回一个介于-1和1之间的值。</li>
			</ul>
			<p>每个函数都有一些优点和缺点，应该根据用例以及训练数据集来选择它们，以实现最佳结果。对于我们的业务场景，我们将使用这些函数中的一些来试验DNNs的训练，并选择产生最佳结果的函数。</p>
			<p>既然我们已经学习了DNNs的基础知识和BigQuery ML通过其SQL接口提供的主要选项，让我们开始为创建我们的机器学习模型准备数据。</p>
			<h1 id="_idParaDest-163"><a id="_idTextAnchor165"/>准备数据集</h1>
			<p>在开始ML <a id="_idIndexMarker529"/>实现之前，有必要为我们的用例分析和准备数据。由于数据集已经在<a href="B16722_04_Final_ASB_ePub.xhtml#_idTextAnchor061"> <em class="italic">第4章</em> </a>、<em class="italic">使用线性回归预测数值</em>中使用，我们将不再从头开始分析，而是专门关注与我们的用例相关的查询。</p>
			<p>要开始准备我们的数据，我们需要做以下工作:</p>
			<ol>
				<li>登录谷歌云控制台，从导航菜单访问<strong class="bold"> BigQuery </strong>用户界面。</li>
				<li>在我们在第2章 、<em class="italic">设置您的GCP和BigQuery环境</em>中创建的项目下创建一个新的数据集。对于这个用例，我们将使用默认选项创建数据集<code>11_nyc_bike_sharing_dnn</code>。</li>
				<li>Now we're ready to create the table that will contain the training dataset. Let's execute the following SQL statement:<pre>CREATE OR REPLACE TABLE `11_nyc_bike_sharing_dnn.training_table` AS
              SELECT 
                   tripduration/60 tripduration,
                   start_station_name,
                   end_station_name,
                   IF (EXTRACT(DAYOFWEEK FROM starttime)=1 OR EXTRACT(DAYOFWEEK FROM starttime)=7, true, false) is_weekend,
                   EXTRACT(YEAR FROM starttime)-birth_year as age
              FROM
                    `bigquery-public-data.new_york_citibike.citibike_trips`
              WHERE 
                    (
                        (EXTRACT (YEAR FROM starttime)=2017 AND
                          (EXTRACT (MONTH FROM starttime)&gt;=04 OR EXTRACT (MONTH FROM starttime)&lt;=10))
                        OR (EXTRACT (YEAR FROM starttime)=2018 AND
                          (EXTRACT (MONTH FROM starttime)&gt;=01 OR EXTRACT (MONTH FROM starttime)&lt;=02))
                    )
                    AND (tripduration&gt;=3*60 AND tripduration&lt;=3*60*60)
                    AND  birth_year is not NULL
                    AND birth_year &lt; 2007; </pre><p>查询的结果存储在新表<code>`11_nyc_bike_sharing_dnn.training_table`</code>中，我们创建该表是为了支持用例的后续步骤。</p><p><code>SELECT</code>语句从表<code>citibike_trips</code>中提取字段，并应用一些转换。<code>tripduration</code>是将秒换算成分。<a id="_idIndexMarker530"/>字段<code>start_station_name</code>和<code>end_station_name</code>按原样提取。使用<code>starttime</code>，该查询计算租赁是在一周还是在周末发生。最后，使用<code>starttime</code>和<code>birth_year</code>之差计算乘坐时顾客的年龄。</p><p>正如我们已经在<a href="B16722_04_Final_ASB_ePub.xhtml#_idTextAnchor061"> <em class="italic">第4章</em> </a>、<em class="italic">用线性回归预测数值</em>中所做的那样，<code>WHERE</code>子句允许我们只考虑我们想要用于训练阶段的月份。训练数据集的时间范围从2017年4月到2018年2月。在同一个<code>WHERE</code>子句中，我们还应用了来自数据质量检查的过滤器。</p></li>
				<li>After the <a id="_idIndexMarker531"/>creation of the training table, we can create the second table dedicated to the records that will be used to evaluate our machine learning model:<pre>CREATE OR REPLACE TABLE  `11_nyc_bike_sharing_dnn.evaluation_table` AS
SELECT 
                   tripduration/60 tripduration,
                   start_station_name,
                   end_station_name,
                   IF (EXTRACT(DAYOFWEEK FROM starttime)=1 OR EXTRACT(DAYOFWEEK FROM starttime)=7, true, false) is_weekend,
                   EXTRACT(YEAR FROM starttime)-birth_year as age
               FROM
                    `bigquery-public-data.new_york_citibike.citibike_trips`
               WHERE 
                    (EXTRACT (YEAR FROM starttime)=2018 AND (EXTRACT (MONTH FROM starttime)=03 OR EXTRACT (MONTH FROM starttime)=04))
                    AND (tripduration&gt;=3*60 AND tripduration&lt;=3*60*60)
                    AND  birth_year is not NULL
                    AND birth_year &lt; 2007;</pre><p>该查询非常类似于用于创建训练表的语句。唯一的区别与在<code>WHERE</code>条款中选择的周期有关。对于表<code>`11_nyc_bike_sharing_dnn.evaluation_table`</code>，我们将<code>SELECT</code>语句的重点放在与2018年3月和4月相关的记录上，这些记录之前被排除在培训表之外。</p></li>
				<li>Adopting<a id="_idIndexMarker532"/> the same approach, we can also create the table that will be used to test our machine learning model:<pre>CREATE OR REPLACE TABLE  `11_nyc_bike_sharing_dnn.prediction_table` AS
              SELECT 
                   tripduration/60 tripduration,
                  start_station_name,
                   end_station_name,
                   IF (EXTRACT(DAYOFWEEK FROM starttime)=1 OR EXTRACT(DAYOFWEEK FROM starttime)=7, true, false) is_weekend,
                   EXTRACT(YEAR FROM starttime)-birth_year as age
              FROM
                    `bigquery-public-data.new_york_citibike.citibike_trips`
              WHERE 
                    EXTRACT (YEAR FROM starttime)=2018
                    AND EXTRACT (MONTH FROM starttime)=05
                     AND (tripduration&gt;=3*60 AND tripduration&lt;=3*60*60)
                    AND  birth_year is not NULL
                    AND birth_year &lt; 2007;</pre><p>查询<a id="_idIndexMarker533"/>应用用于创建训练和评估表的相同逻辑，但是仅考虑2018年5月。</p></li>
			</ol>
			<p>既然我们已经对数据集进行了分段，并且清楚了哪些记录用于训练、评估和测试阶段，那么让我们用BigQuery ML来训练我们的DNN模型。</p>
			<h1 id="_idParaDest-164"><a id="_idTextAnchor166"/>训练DNN模型</h1>
			<p>既然我们已经<a id="_idIndexMarker534"/>将数据集分割成多个表以支持ML模型生命周期的不同阶段，让我们使用不同的激活函数来训练我们的DNN回归模型:</p>
			<ol>
				<li value="1">First of all, we can start with the training of a DNN model by using the <code>RELU</code> function. Let's execute the following SQL statement to create the machine learning model <code>`11_nyc_bike_sharing_dnn.trip_duration_by_stations_day_age_relu`</code>:<pre>CREATE OR REPLACE MODEL `11_nyc_bike_sharing_dnn.trip_duration_by_stations_day_age_relu`
OPTIONS
  (model_type='DNN_REGRESSOR',
        ACTIVATION_FN = 'RELU') AS
SELECT
  start_station_name,
  end_station_name,
  is_weekend,
  age,
  tripduration as label
FROM
  `11_nyc_bike_sharing_dnn.training_table`;</pre><p>在SQL语句中，我们可以注意到用于创建新模型的关键字<code>CREATE OR REPLACE MODEL</code>。这些关键字后面是模型的标识符，由数据集和ML模型名称的串联表示。</p><p>在这第一行之后，我们找到了指定机器学习模型类型的<code>OPTIONS</code>关键字。由于我们试图预测连续场<code>tripduration</code>，我们选择使用<code>DNN_REGRESSOR</code>作为<code>model_type</code>。</p><p>DNN训练期间的另一个重要选项是将应用于网络神经元的激活函数。在第一次尝试中，我们使用了最常见的函数之一:<code>RELU</code>。这种选择是由条款<code>ACTIVATION_FN = 'RELU'</code>规定的。</p><p>在<code>OPTIONS</code>之后，我们需要指定训练ML模型的记录集。由于我们已经在<a href="B16722_04_Final_ASB_ePub.xhtml#_idTextAnchor061"> <em class="italic">第4章</em> </a>、<em class="italic">中确定了相关字段，使用线性回归预测数值</em>，查询使用字段<code>start_station_name</code>、<code>end_station_name</code>、<code>is_weekend</code>和<code>age</code>作为DNN模型的特征。</p><p>通过关键字<code>as label</code>，我们正在指示BigQuery ML使用<code>tripduration</code>作为我们机器学习模型的标签。或者，可以将标签包含在带有关键字<code>INPUT_LABEL_COLS</code>的<code>OPTIONS</code>列表中。</p><p>由于dnn是高级和复杂的模型，在收敛到解决方案并生成机器学习模型之前，可能需要几分钟。</p></li>
				<li>At the end of the execution of the SQL query, we can select the DNN model <code>trip_duration_by_stations_day_age_relu</code> in the BigQuery navigation menu and click on the <code>tripduration</code>.<p>正如您在下面的<a id="_idIndexMarker536"/>截图中看到的，<strong class="bold">平均绝对误差</strong>非常接近4分钟:</p><div><img src="img/B16722_11_002.jpg" alt="Figure 11.2 – The Evaluation tab shows some key performance indicators of the DNN model&#13;&#10;"/></div><p class="figure-caption">图11.2–评估选项卡显示了DNN模型的一些关键绩效指标</p></li>
				<li>As a second attempt, we can try to change the activation function in the neurons of our neural network to see if the performance of the first model can be further improved. Let's run the following SQL statement using the <code>CRELU</code> activation function:<pre>CREATE OR REPLACE MODEL `11_nyc_bike_sharing_dnn.trip_duration_by_stations_day_age_crelu`
OPTIONS
  (model_type='DNN_REGRESSOR',
        ACTIVATION_FN = 'CRELU') AS
SELECT
  start_station_name,
  end_station_name,
  is_weekend,
  age,
  tripduration as label
FROM
  `11_nyc_bike_sharing_dnn.training_table`;</pre><p>训练DNN <code>`11_nyc_bike_sharing_dnn.trip_duration_by_stations_day_age_crelu`</code>的查询与我们在第一次尝试中使用的SQL语句非常相似。唯一的区别在于<code>OPTIONS</code>中指定的不同激活功能。使用子句<code>ACTIVATION_FN = 'CRELU'</code>，我们在网络的神经元中使用<code>CRELU</code>函数。</p><p>训练查询的执行<a id="_idIndexMarker537"/>将需要几分钟才能完成。</p></li>
				<li>At the end of the execution of the SQL query, we can select the DNN model <code>trip_duration_by_stations_day_age_crelu</code> in the BigQuery navigation menu and visualize the performance in the <strong class="bold">Evaluation</strong> tab.<p>从下面的截图可以看出，<strong class="bold">平均绝对误差</strong>几乎接近4分钟:</p></li>
			</ol>
			<div><div><img src="img/B16722_11_003.jpg" alt="Figure 11.3 – The Evaluation tab shows some key performance indicators of the DNN model&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">图11.3–评估选项卡显示了DNN模型的一些关键绩效指标</p>
			<p>现在，让我们开始评估我们在本节中培训的dnn。</p>
			<h1 id="_idParaDest-165"><a id="_idTextAnchor167"/>评估DNN模型</h1>
			<p>为了评估我们的<a id="_idIndexMarker538"/> BigQuery ML DNNs，我们将使用<code>ML.EVALUATE</code>函数和我们特意创建的表作为评估数据集:</p>
			<ol>
				<li value="1">First of all, we can start evaluating the model <code>`11_nyc_bike_sharing_dnn.trip_duration_by_stations_day_age_relu`</code>. Let's run the following query:<pre>SELECT
  *
FROM
  ML.EVALUATE(MODEL `11_nyc_bike_sharing_dnn.trip_duration_by_stations_day_age_relu`,
    (
    SELECT
          start_station_name,
          end_station_name,
          is_weekend,
          age,
          tripduration as label
    FROM
           `11_nyc_bike_sharing_dnn.evaluation_table` ));</pre><p>在SQL语句中，我们可以注意到关键字<code>ML.EVALUATE</code>用于评估DNN。评估函数后面是BigQuery ML模型的标识符:<code>`11_nyc_bike_sharing_dnn.trip_duration_by_stations_day_age_relu`</code>。</p><p>评估<a id="_idIndexMarker539"/>函数应用于从表<code>`11_nyc_bike_sharing_dnn.evaluation_table`</code>中提取所有字段的<code>SELECT</code>语句。</p><p>几秒钟后，我们可以看到评估阶段的结果，如下图所示:</p><div><img src="img/B16722_11_004.jpg" alt="Figure 11.4 – The results of the evaluation SQL statement&#13;&#10;"/></div><p class="figure-caption">图11.4–评估SQL语句的结果</p><p>我们可以注意到<strong class="bold"> mean_absolute_error </strong>值与我们在训练阶段获得的值没有太大的不同。我们可以说，我们的模型不受过度拟合的影响，并且在评估数据集的新记录上工作得很好。</p></li>
				<li>Let's apply the same evaluation logic on the second model, <code>`11_nyc_bike_sharing_dnn.trip_duration_by_stations_day_age_crelu`</code>. To evaluate the performance of this BigQuery ML model, we run the following SQL statement:<pre>SELECT
  *
FROM
  ML.EVALUATE(MODEL `11_nyc_bike_sharing_dnn.trip_duration_by_stations_day_age_crelu`,
    (
    SELECT
          start_station_name,
          end_station_name,
          is_weekend,
          age,
          tripduration as label
    FROM
           `11_nyc_bike_sharing_dnn.evaluation_table` ));</pre><p>上一个查询和前一个查询之间唯一的<a id="_idIndexMarker540"/>区别在于要进行评估的DNN的名称:<code>`11_nyc_bike_sharing_dnn.trip_duration_by_stations_day_age_crelu`</code>。</p><p>几秒钟后，我们将看到评估结果，如下图所示:</p></li>
			</ol>
			<div><div><img src="img/B16722_11_005.jpg" alt="Figure 11.5 – The results of the evaluation SQL statement&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">图11.5–评估SQL语句的结果</p>
			<p>此外，在这种情况下，<strong class="bold"> mean_absolute_error </strong>值与我们在训练阶段获得的4分钟值相差不远。该模型不受<a id="_idIndexMarker541"/>过拟合的影响，工作原理与上一个相似。</p>
			<p>现在我们已经评估了BigQuery ML模型，让我们看看如何使用基于<code>ReLU</code>激活函数的DNN来预测自行车租赁的持续时间。</p>
			<h1 id="_idParaDest-166"><a id="_idTextAnchor168"/>使用DNN模型</h1>
			<p>在本节中，我们将<a id="_idIndexMarker542"/>使用基于<code>ReLU</code>函数的DNN模型，并对其进行培训，以利用BigQuery ML功能来预测纽约市自行车共享公司的自行车骑行时长。</p>
			<p>为了测试我们的DNN，我们将使用表<code>prediction_table</code>上的<code>ML.PREDICT</code>函数。让我们运行以下SQL语句:</p>
			<pre>SELECT
   tripduration as actual_duration,
   predicted_label as predicted_duration,
   ABS(tripduration - predicted_label) difference_in_min
FROM
  ML.PREDICT(MODEL `11_nyc_bike_sharing_dnn.trip_duration_by_stations_day_age_relu`,
    (
    SELECT
         start_station_name,
          end_station_name,
          is_weekend,
          age,
          tripduration
    FROM
           `11_nyc_bike_sharing_dnn.prediction_table`
    ))
    order by  difference_in_min asc;</pre>
			<p>查询语句是由关键字<code>SELECT</code>组成的<a id="_idIndexMarker543"/>，它提取实际和预测的租赁期限。它以分钟为单位计算差值，并将结果从最小差值到最大差值排序。为了计算差值，我们使用了提取数值绝对值的<code>ABS</code>函数。</p>
			<p><code>ML.PREDICT</code>函数应用于<code>SELECT</code>语句，该语句从<code>prediction_table</code>中提取特征和实际持续时间。最后一个字段仅用于与预测值进行比较，DNN不使用该字段返回预测值。</p>
			<p>在下面的屏幕截图中，您可以看到查询执行的结果:</p>
			<div><div><img src="img/B16722_11_006.jpg" alt="Figure 11.6 – The output of the query shows the actual and the predicted label &#13;&#10;with the difference expressed in minutes&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">图11.6-查询的输出显示了实际和预测的标签，差异以分钟表示</p>
			<p>现在我们已经<a id="_idIndexMarker544"/>测试了我们的BigQuery ML模型，让我们看看一些最终的考虑事项，将基于<code>CReLU</code>激活函数的DNN的结果与我们在<a href="B16722_04_Final_ASB_ePub.xhtml#_idTextAnchor061"> <em class="italic">第4章</em> </a>、<em class="italic">中使用线性回归预测数值</em>中获得的结果进行比较。</p>
			<h1 id="_idParaDest-167"><a id="_idTextAnchor169"/>得出商业结论</h1>
			<p>在此<a id="_idIndexMarker545"/>部分，我们将应用我们的DNN模型，并了解BigQuery ML模型能够预测多少次接近实际的租赁期限。</p>
			<p>我们将在前面的查询中添加一个父语句<code>SELECT COUNT</code>,以计算实际持续时间和预测持续时间之差小于<code>15</code>分钟的次数。</p>
			<p>让我们执行以下查询来计算旅行持续时间预测值与实际值相差多远:</p>
			<pre>SELECT COUNT (*)
FROM (
SELECT
   tripduration as actual_duration,
   predicted_label as predicted_duration,
   ABS(tripduration - predicted_label) difference_in_min
FROM
  ML.PREDICT(MODEL  `11_nyc_bike_sharing_dnn.trip_duration_by_stations_day_age_relu`,
    (
    SELECT
          start_station_name,
          end_station_name,
          is_weekend,
          age,
          tripduration
    FROM
           `11_nyc_bike_sharing_dnn.prediction_table`
    ))
    order by  difference_in_min asc) where difference_in_min&lt;=15 ;  </pre>
			<p><code>SELECT COUNT</code>查询的结果返回1，640，446个预测值，预测值和实际值之间的差异小于<code>15</code>分钟。</p>
			<p>考虑到<a id="_idIndexMarker546"/>表<code>prediction_table</code>的总大小是1，728，078，我们可以说在94.92%的情况下，我们的DNN能够以小于15分钟的差异预测旅行持续时间。</p>
			<p>现在，我们可以将使用DNN获得的最佳结果与使用第4章<em class="italic">中的<a href="B16722_04_Final_ASB_ePub.xhtml#_idTextAnchor061"> <em class="italic">【使用线性回归预测数值】</em>中的线性回归模型获得的性能进行比较。</a></em></p>
			<h2 id="_idParaDest-168"><a id="_idTextAnchor170"/>深度神经网络与线性模型</h2>
			<p>在下表中，基于<code>CReLU</code>激活函数的DNN <a id="_idIndexMarker548"/>模型的<a id="_idIndexMarker547"/>结果与线性回归模型进行了比较:</p>
			<div><div><img src="img/B16722_11_007.jpg" alt="Figure 11.7 – Comparison between the DNN model and the linear regression model&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">图11.7-DNN模型和线性回归模型的比较</p>
			<p>查看上表，我们可以说，要预测纽约市自行车共享服务的出行持续时间，使用DNN模型可以获得最佳结果。为此，我们可以建议使用DNN模型向公司的客户建议旅行持续时间。使用DNN，我们可以将平均绝对误差降低43%以上。在某些行业，这种改进可能是公司的一大竞争优势。</p>
			<h1 id="_idParaDest-169"><a id="_idTextAnchor171"/>总结</h1>
			<p>在这一章中，我们实现了两个dnn。我们想起了已经在第四章<a href="B16722_04_Final_ASB_ePub.xhtml#_idTextAnchor061"><em class="italic"><em class="italic">中介绍的业务场景，用线性回归</em>预测数值。该用例基于预测纽约市自行车共享服务的租赁时间的需求。之后，我们学习了DNNs的基础知识和不同的激活函数，这些函数可以用来实现网络中的神经元。</em></a></p>
			<p>我们将BigQuery公共数据集分成三个不同的表:一个用于存放训练数据，第二个用于评估阶段，最后一个用于测试我们的DNN模型。</p>
			<p>在BigQuery ML模型的训练阶段，我们测试了两个不同的激活函数<code>ReLU</code>和<code>CReLU</code>，比较平均绝对误差以找到最好的一个。</p>
			<p>之后，我们在一组新的记录上评估了我们的DNN模型，以防止任何过度拟合，并对我们的BigQuery ML模型的良好质量更有信心。</p>
			<p>最后，我们将基于<code>ReLU</code>函数的模型应用于记录的最后一个子集，以预测每次自行车租赁的行程持续时间。我们发现，我们的BigQuery ML模型能够预测超过94%的租赁的实际行程持续时间在15分钟的范围内。</p>
			<p>最后，我们还将DNN模型的性能与第四章<em class="italic">中的<a href="B16722_04_Final_ASB_ePub.xhtml#_idTextAnchor061"> <em class="italic">【用线性回归预测数值】中的线性回归结果进行了比较。我们注意到，DNN优于线性回归，平均绝对误差减少了43%，并且可以为我们的业务场景获得更好的结果。</em></a></em></p>
			<p>在下一章，我们将学习如何在GCP人工智能笔记本上使用BigQuery ML。</p>
			<h1 id="_idParaDest-170"><a id="_idTextAnchor172"/>更多资源</h1>
			<ul>
				<li><strong class="bold">纽约市自行车共享公共数据集</strong>:<a href="https://console.cloud.google.com/marketplace/product/city-of-new-york/nyc-citi-bike">https://console . cloud . Google . com/market place/product/city-of-new York/NYC-Citi-Bike</a></li>
				<li><strong class="bold"> BigQuery ML创建模型</strong>:<a href="https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create-dnn-models">https://cloud . Google . com/big query-ML/docs/reference/standard-SQL/bigqueryml-syntax-Create-dnn-models</a></li>
				<li><strong class="bold"> BigQuery ML评估模型</strong>:<a href="https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-evaluate">https://cloud . Google . com/big query-ML/docs/reference/standard-SQL/bigqueryml-syntax-Evaluate</a></li>
				<li><strong class="bold">big query ML Predict</strong>:<a href="https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-predict">https://cloud . Google . com/big query-ML/docs/reference/standard-SQL/bigqueryml-syntax-Predict</a></li>
			</ul>
		</div>
	

</body></html>