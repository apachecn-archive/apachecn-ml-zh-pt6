<html><head/><body>


	
		<title>B16722_14_Final_ASB_ePub</title>
		
	
	
		<div><h1 id="_idParaDest-194"><em class="italic"> <a id="_idTextAnchor196"/>第十四章</em> : BigQuery ML技巧和最佳实践</h1>
			<p>BigQuery ML的巨大优势是将<strong class="bold">机器学习</strong> ( <strong class="bold"> ML </strong>)的使用民主化，用于数据和业务分析师。事实上，BigQuery ML使没有任何编程经验的用户能够实现高级的ML算法。尽管BigQuery ML旨在简化和自动化ML模型的创建，但在ML算法的开发生命周期中，应该采用一些最佳实践和技巧来获得有效的性能。</p>
			<p>拥有数据科学的背景可以帮助我们进一步提高ML模型的性能，避免用例实现过程中的陷阱。在这一章中，我们将学习如何为每个特定的业务场景选择正确的技术，并将学习我们可以用来提高ML模型性能的工具。</p>
			<p>按照典型的ML开发生命周期，我们将讨论以下主题:</p>
			<ul>
				<li>选择正确的BigQuery ML算法</li>
				<li>准备数据集</li>
				<li>了解特征工程</li>
				<li>调谐超参数</li>
				<li>使用BigQuery ML进行在线预测</li>
			</ul>
			<h1 id="_idParaDest-195"><a id="_idTextAnchor197"/>选择正确的BigQuery ML算法</h1>
			<p>在本节中，我们将了解为什么在实现ML模型之前定义一个清晰的业务目标如此重要，并且我们将了解哪种BigQuery ML算法适合于每个特定的用例。</p>
			<p class="callout-heading">重要说明</p>
			<p class="callout">数据科学家是负责收集、分析和理解大量数据的专业人士。这个角色通常需要多种技能，比如匹配统计数据和编码。</p>
			<p class="callout">数据分析师<strong class="bold">和数据科学家</strong>不同。数据分析师更关注行业知识和业务流程，而不是编码和编程技能。担任这一角色的人在数据操作和可视化方面拥有丰富的经验，能够展示从数据中获得的相关业务见解。</p>
			<p>为了在ML中获得有意义的结果，有必要定义一个清晰的业务目标。在开始实际实现ML模型之前，数据分析师和数据科学家应该清楚地定义他们希望实现的业务目标。</p>
			<p>设立明确目标的最著名的技巧之一就是所谓的<strong class="bold">具体、可衡量、可实现、相关和基于时间的</strong> ( <strong class="bold"> SMART </strong>)框架。在这个范例中，每个字母代表我们最终目标应该满足的一个<a id="_idIndexMarker630"/>具体特征，如下所示:</p>
			<ul>
				<li><strong class="bold">具体的</strong>:需要定义一个清晰准确的商业目标。</li>
				<li><strong class="bold">可测</strong>:为了了解BigQuery ML模型是否满足我们的标准，我们需要选择<a id="_idIndexMarker631"/>一个或多个<strong class="bold">关键绩效指标</strong>(<strong class="bold">KPI</strong>)，如<a id="_idIndexMarker632"/><strong class="bold">接收方工作特性</strong>(<strong class="bold">ROC</strong>)<strong class="bold">曲线下面积</strong> ( <strong class="bold"> AUC </strong> ) <a id="_idIndexMarker633"/>值，或<strong class="bold">均值<strong class="bold"/></strong></li>
				<li><strong class="bold">可达到的</strong>:我们需要分析我们想要解决的用例的复杂性，并设定正确的期望值——例如，我们不能期望我们的BigQuery ML模型在100%的时间里预测正确的值。</li>
				<li><strong class="bold">相关</strong>:我们需要把精力集中在最重要的用例上，因为有些业务场景可能会给我们公司带来有限的业务优势。</li>
				<li><strong class="bold">基于时间的</strong>:作为数据分析师和数据科学家，我们在时间方面的资源有限。关注正确的目标是为公司创造价值的基础。</li>
			</ul>
			<p>我们可以将SMART框架应用到ML领域，以帮助我们选择正确的用例以及要使用的正确的BigQuery ML算法。</p>
			<p>例如，在下表的<a id="_idIndexMarker635"/>中，您可以看到我们在<a href="B16722_04_Final_ASB_ePub.xhtml#_idTextAnchor061"> <em class="italic">第4章</em> </a>、<em class="italic">中开发的应用于用例的智能框架，使用线性回归</em>预测数值:</p>
			<div><div><img src="img/B16722_14_001.jpg" alt="Figure 14.1 – The SMART framework applied to a ML use case&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">图14.1–应用于ML用例的智能框架</p>
			<p>一旦我们使用SMART方法定义了我们的业务目标，我们就可以选择最佳的BigQuery ML算法来帮助我们处理业务场景。</p>
			<p>根据我们想要实现的业务目标和我们可以利用的训练数据集，我们可以确定可能解决我们用例的BigQuery ML算法。</p>
			<p>在下表中，我们可以看到可用于开发ML模型的所有BigQuery ML技术的总结:</p>
			<div><div><img src="img/B16722_14_002.jpg" alt="Figure 14.2 – The BigQuery ML algorithms at a glance&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">图14.2–大查询ML算法一览</p>
			<p>为了实现我们的目标，我们<a id="_idIndexMarker636"/>可以导航到<em class="italic">图14.2 </em>中表示的表格，并清楚地找到可以解决我们用例的BigQuery ML算法。例如，对于我们在<em class="italic">图14.1 </em>中分析的业务场景，我们可以断言如下:</p>
			<ul>
				<li>我们在<a href="B16722_04_Final_ASB_ePub.xhtml#_idTextAnchor061"> <em class="italic">第4章</em></a><em class="italic">使用线性回归预测数值</em>中使用的BigQuery公共数据集是一个带标签的数据集，因为对于每个记录，它都包括过去乘坐的行程持续时间。</li>
				<li>预期的结果是一个连续的实数。事实上，用例的目标是预测旅行持续时间，用分钟表示。</li>
			</ul>
			<p>通过使用<em class="italic">图14.2 </em>中的表格，我们注意到我们可以使用以下BigQuery ML算法之一来处理我们的预测用例:</p>
			<ul>
				<li><strong class="bold">线性回归</strong></li>
				<li><strong class="bold">增强树–XG boost–回归</strong></li>
				<li><strong class="bold">深度神经网络–回归</strong></li>
			</ul>
			<p>在本节中，我们学习了如何设定明确的业务目标。然后，我们理解了可以使用哪种BigQuery <a id="_idIndexMarker637"/> ML技术来实现我们的业务目标。在下一节中，我们将着重于准备数据集以获得有效的ML模型。</p>
			<h1 id="_idParaDest-196"><a id="_idTextAnchor198"/>准备数据集</h1>
			<p>在这一节中，我们将学习<a id="_idIndexMarker638"/>关于我们可以应用哪些技术来确保我们将用于构建ML模型的数据是正确的，并产生预期的结果。之后，我们将发现可以用来将数据集划分为训练集、验证集和测试集的策略。</p>
			<h2 id="_idParaDest-197"><a id="_idTextAnchor199"/>处理高质量数据</h2>
			<p>在这一节中，我们将<a id="_idIndexMarker639"/>了解数据集应该具有的特征，以便开发有效的BigQuery ML模型。</p>
			<p>因为ML模型从数据中学习，所以为我们的ML算法提供高质量的数据非常重要，尤其是在训练阶段。由于数据质量是一个非常宽泛的话题，需要一本专门的书来详细分析。为此，我们将只关注与ML模型的构建相关的主要数据质量概念。</p>
			<p class="callout-heading">重要说明</p>
			<p class="callout"><strong class="bold">数据质量</strong>是一门学科，包括识别和纠正数据中的异常、错误和缺陷的过程、专业人员、技术和最佳实践。</p>
			<p class="callout">这种实践是通过可信且经济的数据洞察支持业务决策的基础。</p>
			<p>我们可以根据不同的数据质量维度来衡量数据集的质量。</p>
			<p>在下图中，您可以看到用于衡量数据质量的不同维度:</p>
			<div><div><img src="img/B16722_14_003.jpg" alt="Figure 14.3 – The data quality dimensions&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">图14.3-数据质量维度</p>
			<p>我们可以从以下维度来评价一个数据集的质量:<strong class="bold">准确性</strong>、<strong class="bold">完整性</strong>、<strong class="bold">一致性</strong>、<strong class="bold">及时性</strong>、<strong class="bold">有效性</strong>、<strong class="bold">唯一性</strong>。</p>
			<p>在接下来的<a id="_idIndexMarker641"/>部分中，我们将解释每个数据质量维度，以及为什么它对ML模型的实现很重要。</p>
			<h3>准确(性)</h3>
			<p><strong class="bold">准确性</strong>是指<a id="_idIndexMarker642"/>在我们的数据集中可用的信息。如果一个数值是错误的，没有反映现实，这将影响建立在它之上的BigQuery ML模型的有效性。</p>
			<p>发现不准确的信息并非易事，但我们可以应用一些数据质量检查来识别数据中的相关问题，例如，我们可以执行查询来识别并最终删除包含不正确值的记录。</p>
			<p>在下表中，您<a id="_idIndexMarker643"/>可以看到一个不准确数据的典型例子，用一个负值来表示一个人的年龄:</p>
			<div><div><img src="img/B16722_14_004.jpg" alt="Figure 14.4 – An example of a table with inaccurate values in the Age column &#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">图14.4–年龄列中的值不准确的表格示例</p>
			<p>在<code>SELECT</code>查询中使用<code>MAX</code>和<code>MIN</code>操作符是找到列中错误值的好方法。这些<a id="_idIndexMarker644"/>记录被称为异常值，因为它们呈现的值与同一列中的其他记录非常不同。执行一些初步的<strong class="bold">结构化查询语言</strong> ( <strong class="bold"> SQL </strong>)查询来<a id="_idIndexMarker645"/>提取特征和标签的最大值和最小值，这对于帮助识别数据集中最相关的错误非常有用。</p>
			<p>例如，在<em class="italic">图14.4 </em>中，Alice的年龄将被标识为<strong class="bold">年龄</strong>列中的异常值。在这些情况下，我们可以考虑过滤掉具有不现实值的记录。</p>
			<h3>完全</h3>
			<p><code>NULL</code>字段，这些字段将影响我们模型的性能。</p>
			<p>在下表中，你<a id="_idIndexMarker647"/>可以看到一个不完整数据的例子:</p>
			<div><div><img src="img/B16722_14_005.jpg" alt="Figure 14.5 – An example of a table with incomplete values in the Age column &#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">图14.5–年龄列中值不完整的表格示例</p>
			<p>为了防止出现不完整的记录，最有效的解决方案是在查询中应用特定的筛选器来排除缺少值的记录。典型的完整性检查是基于添加一个<code>WHERE</code>子句，当模型的特征或标签不应该为空并且应该不同于<code>NULL</code>。</p>
			<p>在下面的代码片段中，您可以看到一个对<code>&lt;TEXT_FIELD&gt;</code>占位符应用完整性检查的<code>SELECT</code>语句示例:</p>
			<pre>SELECT *
FROM &lt;TABLE_NAME&gt;
WHERE
    &lt;TEXT_FIELD&gt; IS NOT NULL AND &lt;TEXT_FIELD&gt; &lt;&gt; '' </pre>
			<p>在前面的例子中，我们在由<code>&lt;TABLE_NAME&gt;</code>占位符表示的表上应用完整性检查。质量检查验证<code>&lt;TEXT_FIELD&gt;</code>字段不等于<code>NULL</code>并且不为空。</p>
			<p>如果一条记录显示不完整的字段，我们可以选择从数据集中排除这条记录，或者用缺省值替换缺失的<a id="_idIndexMarker648"/>值以填补空白。</p>
			<h3>一致性</h3>
			<p>实现数据的一致性是最复杂的任务之一。在企业环境中，相同的数据通常存储在多个位置，可能用不同的格式或度量单位来表示。当某一列显示的值与数据集中其他列的值不兼容时，数据就是不一致的。</p>
			<p>例如，我们可以想象一个表，其中一列包含以C表示的温度，另一列包含以f表示的相同温度，如果两个值应该表示相同的温度，但没有很好地计算，则该表将呈现不一致。</p>
			<p>在下表中，您可以看到第二条记录显示温度值不一致:</p>
			<div><div><img src="img/B16722_14_006.jpg" alt="Figure 14.6 – An example of a table with inconsistent values in the Temperature columns &#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">图14.6–温度列中值不一致的表格示例</p>
			<p>在<em class="italic">图14.6 </em>中，第二个记录——对应于在<strong class="bold">巴黎</strong>测得的温度——显示了C和F刻度之间的不一致。</p>
			<p>为了检查数据的一致性，我们通常应该对位于同一表或不同表中的多个字段进行验证检查。</p>
			<h3>及时</h3>
			<p><strong class="bold">及时性</strong>在我们需要使用BigQuery ML模型的时候<a id="_idIndexMarker650"/>尤为重要。当我们训练一个ML模型时，我们需要确保在训练阶段使用的所有特征在ML模型被执行时都是可用的。</p>
			<p>在<a href="B16722_04_Final_ASB_ePub.xhtml#_idTextAnchor061"> <em class="italic">第四章</em> </a>、<em class="italic">用线性回归预测数值</em>的业务场景中，我们用一家自行车租赁公司的起止站来预测出行时长。在这种情况下，我们已经利用开始和停止站训练了BigQuery ML模型，但是如果停止站在预测时间不可用，ML模型就变得不适用和没有价值。</p>
			<p>为了避免这种常见错误，我们需要检查用于训练模型的所有特征在ML模型将生成预测的预测阶段是否也可用。</p>
			<h3>有效期</h3>
			<p>值的<strong class="bold">有效性</strong>与字段应该具有的预期格式<a id="_idIndexMarker651"/>严格相关。如果一个列包含以格式<em class="italic"> DD/MM/YYYY </em>表示的日期值，并且其中一个记录的格式为<em class="italic"> DD-MM-YYYY </em>，则该记录的有效性会受到影响。</p>
			<p>在下表中，您会注意到第二条记录为<strong class="bold">出生日期</strong>字段提供了一个无效值:</p>
			<div><div><img src="img/B16722_14_007.jpg" alt="Figure 14.7 – An example of a table with invalid values in the Birth Date column&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">图14.7–出生日期列中包含无效值的表格示例</p>
			<p>为了满足这个维度，我们<a id="_idIndexMarker652"/>必须检查一列的所有值是否以相同的格式和相同的方式存储。为了检查每个字段的确切格式，我们可以对列中的值应用正则表达式。</p>
			<h3>独特性</h3>
			<p><strong class="bold">唯一的</strong>信息意味着在一个表中有<a id="_idIndexMarker653"/>条记录来代表一个特定的项目。发生数据重复的原因有多种，例如数据接收过程中的错误，或者数据加载过程中不受控制的中断和重新启动。</p>
			<p>为了防止这些<a id="_idIndexMarker654"/>错误，我们需要知道组成我们的记录的<strong class="bold">主键</strong> ( <strong class="bold"> PK </strong>)的字段，并且我们需要检查<strong class="bold"> PK </strong>是否匹配一个——并且只有一个——记录。</p>
			<p class="callout-heading">重要说明</p>
			<p class="callout">在表中，<strong class="bold"> PK </strong>是唯一标识一行的最小列集。</p>
			<p>重复记录的存在可以导致ML模型从不是实际的而是由技术错误产生的事件中学习。</p>
			<p>既然我们已经发现了在实现BigQuery ML模型之前要检查的所有数据质量维度，那么让我们看看可以用来将数据集划分为训练集、验证集和测试集的技术。</p>
			<h2 id="_idParaDest-198"><a id="_idTextAnchor200"/>分割数据集</h2>
			<p>在这一节中，我们将学习如何<a id="_idIndexMarker655"/>轻松分割数据集，以支持BigQuery ML模型的训练、验证和测试阶段。</p>
			<p>对于大多数BigQuery ML算法，我们需要将初始数据集分成三个不同的集合，如下所示:</p>
			<ul>
				<li><strong class="bold">训练</strong>数据集表示我们将用来训练BigQuery ML模型的<a id="_idIndexMarker656"/>数据样本。</li>
				<li><strong class="bold">验证</strong>数据集不同于<a id="_idIndexMarker657"/>训练数据集，我们可以用它来评估模型的性能。我们对与训练阶段使用的样本数据不同的全新数据进行验证。在这个阶段，我们还可以调整模型的超参数。</li>
				<li><strong class="bold">测试</strong>集是用于最终应用模型并验证其结果和性能的数据集<a id="_idIndexMarker658"/>。</li>
			</ul>
			<p>将初始的<a id="_idIndexMarker659"/>数据集分成这三个子集可能很麻烦，但是如果您有足够的数据，您可以应用以下经验法则:</p>
			<ul>
				<li>训练集80%的数据。</li>
				<li>10%用于验证集。</li>
				<li>剩余的10%用于测试集。</li>
				<li>如果我们正在处理大量的数据，我们可以减少用于验证和测试集的观察的百分比。</li>
			</ul>
			<p>在下面的屏幕截图中，您可以看到最佳分割策略的图形表示:</p>
			<div><div><img src="img/B16722_14_008.jpg" alt="Figure 14.8 – The 80/10/10 splitting strategy for ML&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">图14.8–ML的80/10/10分割策略</p>
			<p>为了获得最佳结果，分割过程应尽可能随机。</p>
			<p>在下面的代码块中，您可以看到如何通过使用<code>MOD</code>函数来应用这个经验法则:</p>
			<pre>SELECT
  CASE
    WHEN MOD(&lt;RECORD_KEY&gt;, 10) &lt; 8 THEN 'training'
    WHEN MOD(&lt;RECORD_KEY&gt;, 10) = 8 THEN 'evaluation'
    WHEN MOD(&lt;RECORD_KEY&gt;, 10) = 9 THEN 'test'
  END AS dataframe
FROM
  &lt;TABLE_NAME&gt;</pre>
			<p>在示例中，存储在由占位符<code>&lt;TABLE_NAME&gt;</code>表示的表中的记录根据字段dataframe的值被分成三个不同的集合。在这种情况下，MOD <a id="_idIndexMarker660"/>函数返回一个从0到10的值。使用此功能，我们可以将记录分成三个不同的组。通过利用子句<code>MOD(&lt;RECORD_KEY&gt;, 10)&lt;8, MOD(&lt;RECORD_KEY&gt;, 10) = 8 and MOD(&lt;RECORD_KEY&gt;, 10) = 9</code>，我们可以将记录分成<code>'training', 'evaluation'</code>和<code>'test'</code>集合。</p>
			<p>既然我们已经了解了如何根据我们的训练、验证和测试需求来分割数据集，那么让我们来看看对特征工程技术的理解。</p>
			<h1 id="_idParaDest-199"><a id="_idTextAnchor201"/>了解特征工程</h1>
			<p>在本节中，我们将了解在训练阶段之前，我们可以使用哪些技术来改进BigQuery ML模型的特性。</p>
			<p class="callout-heading">重要说明</p>
			<p class="callout"><strong class="bold">特征工程</strong>是对原始数据应用预处理功能的实践，以提取对训练ML模型有用的特征。创建预处理特征可以显著提高ML模型的性能。</p>
			<p>根据设计，当我们使用<code>CREATE MODEL</code>函数时，BigQuery ML会在训练阶段自动应用特征工程，但它也允许我们应用预处理转换。</p>
			<p>为了在训练和预测阶段自动应用特征工程操作，我们可以在训练BigQuery ML模型时将所有预处理功能包括到<code>TRANSFORM</code>子句中。</p>
			<p>从下面的代码示例中我们可以看到，我们需要在<code>OPTIONS</code>子句之前和<code>CREATE MODEL</code>语句之后使用<code>TRANSFORM</code>子句:</p>
			<pre>CREATE MODEL &lt;MODEL_NAME&gt;
TRANSFORM(&lt;TRANSFORM_CLAUSES&gt;)
OPTIONS
  (&lt;OPTION_CLAUSES&gt;) AS
&lt;TRAINING_TABLE&gt;</pre>
			<p>在BigQuery ML中，有两种<a id="_idIndexMarker662"/>不同类型的特征工程功能，概述如下:</p>
			<ul>
				<li><strong class="bold">标量</strong>函数应用于<a id="_idIndexMarker663"/>单个记录</li>
				<li><strong class="bold">解析</strong>函数<a id="_idIndexMarker664"/>计算所有行的结果</li>
			</ul>
			<p>在下面的列表中，您可以查看可以在BigQuery ML中应用的最重要的特征工程函数:</p>
			<ul>
				<li><code>ML.BUCKETIZE</code>:用于将数值表达式转换为分类字段，例如，您可以使用此函数将一个人的年龄转换为<em class="italic">年轻</em>、<em class="italic">中年</em>或<em class="italic">年老</em>桶。</li>
				<li><code>ML.FEATURE_CROSS</code>:用于将两个功能组合成一个独特的功能。例如，如果在一个数据集中我们有一个人的性别和出生地，我们可以结合这两个特征来简化我们的BigQuery ML模型。当我们已经关联了特征并且我们想要在ML模型中包括这两种信息时，这种技术特别有用。</li>
				<li><code>ML.QUANTILE_BUCKETIZE</code>: This is very similar to the <code>ML.BUCKETIZE</code> function. In this case, the function is analytic and applies on all records in the dataset. The splitting of records into buckets is based on the quantiles of an entire set of records.<p class="callout-heading">重要说明</p><p class="callout"><strong class="bold">分位数</strong>是数据集的特定部分<a id="_idIndexMarker665"/>。例如，它确定有多少值高于或低于某个阈值。</p></li>
				<li><code>ML.MIN_MAX_SCALER</code>:这是一个分析函数，根据值在整个记录集中的分布返回一个从0到1的值。</li>
				<li><code>ML.STANDARD_SCALER</code>:这是一个分析函数，允许我们使用记录集的标准偏差和平均值。</li>
			</ul>
			<p>关于<a id="_idIndexMarker666"/>特性工程和预处理函数的完整列表，您可以通过以下链接访问官方BigQuery文档:<a href="https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-preprocessing-functions">https://cloud . Google . com/big query-ml/docs/reference/standard-SQL/bigqueryml-preprocessing-functions</a>。</p>
			<p>既然我们已经学习了特征工程，让我们继续学习超参数调整。</p>
			<h1 id="_idParaDest-200"><a id="_idTextAnchor202"/>调整超参数</h1>
			<p>在本节中，我们将发现可以在BigQuery ML中调优的<a id="_idIndexMarker667"/>最重要的超参数。</p>
			<p class="callout-heading">重要说明</p>
			<p class="callout"><strong class="bold">超参数调整</strong>是选择最佳参数集来训练特定ML模型的实践。超参数在ML训练阶段影响和控制学习过程。</p>
			<p>根据设计，BigQuery ML使用默认的超参数来训练模型，但是高级用户可以手动更改它们来影响训练过程。</p>
			<p>在BigQuery ML中，我们可以将<code>OPTIONS</code>子句中的超参数指定为可选参数。根据模型的不同，我们可以在开始训练BigQuery ML模型之前更改最相关的超参数，如下所示:</p>
			<ul>
				<li><code>L1_REG</code>:这是一个正则化参数，我们可以通过保持模型的权重接近零来防止过度拟合。</li>
				<li><code>L2_REG</code>:这是我们可以用来防止过度拟合的第二个正则化参数。</li>
				<li><code>MAX_ITERATIONS</code>:这表示BigQuery ML为训练模型而执行的最大迭代次数。</li>
				<li><code>LEARN_RATE</code>:这是一个根据前一次迭代的误差影响模型变化多少的参数。</li>
				<li><code>MIN_REL_PROGRESS</code>:这是<a id="_idIndexMarker668"/>迭代后继续训练所必需的最小改进。</li>
				<li><code>NUM_CLUSTERS</code>:用于K-Means算法，代表模型将创建的聚类数。</li>
				<li><code>HIDDEN_UNITS</code>:这是<strong class="bold">深度神经网络</strong> ( <strong class="bold"> DNNs </strong>)中使用的<a id="_idIndexMarker669"/>，代表一个网络中隐含的层数。</li>
			</ul>
			<p>要获得可以用BigQuery ML应用的所有超参数的完整列表，我们建议访问官方文档，网址为<a href="https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create">https://cloud . Google . com/big query-ML/docs/reference/standard-SQL/bigqueryml-syntax-create</a>。</p>
			<h1 id="_idParaDest-201"><a id="_idTextAnchor203"/>使用BigQuery ML进行在线预测</h1>
			<p>在本节中，我们将了解如何以同步和在线的方式使用BigQuery ML模型。</p>
			<p>BigQuery ML为商业和数据分析师提供了一个将ML技术大众化的巨大机会。当BigQuery ML经过训练并准备好使用时，我们可以使用SQL查询在BigQuery中直接调用它，或者我们可以将其导出为TensorFlow格式。</p>
			<p>每个用例的需求决定了我们应该采用的预测类型，如下所示:</p>
			<ul>
				<li>当我们想要<a id="_idIndexMarker671"/>启用请求-响应应用程序并且获得即时预测非常重要时，我们使用<strong class="bold">在线预测</strong>。</li>
				<li>当我们不需要即时预测时，我们采用<strong class="bold">批处理预测</strong>来处理<a id="_idIndexMarker672"/>大量数据——例如，调度每日或每周作业，这些作业根据自上次作业执行以来收集的数据计算预测。</li>
			</ul>
			<p>虽然使用BigQuery <a id="_idIndexMarker673"/> SQL语句更适合对存储在BigQuery表中的大量记录进行批量预测，但是将BigQuery ML模型导出到TensorFlow的可能性为应用程序带来了新的机遇。</p>
			<p>在下图中，您可以看到BigQuery ML模型从培训阶段到部署阶段的生命周期:</p>
			<div><div><img src="img/B16722_14_009.jpg" alt="Figure 14.9 – Using a BigQuery ML model for online predictions&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">图14.9–使用BigQuery ML模型进行在线预测</p>
			<p>从前面的图表中，我们看到在BigQuery ML模型生命周期的第一步<strong class="bold"> (1) </strong>中，我们通过利用存储在BigQuery中的训练数据集来训练ML模型。在第一步中，ML模型经历了开发周期的三个主要阶段，如下所示:</p>
			<ul>
				<li><strong class="bold">训练</strong>:在这个阶段，BigQuery ML模型从训练数据中学习。</li>
				<li><strong class="bold">评估</strong>:在这一步中，我们评估模型的KPI，并且我们可以调整超参数。</li>
				<li><strong class="bold">测试</strong>:在最后一个阶段，我们最终在测试数据集上测试BigQuery ML模型，以获得预测。</li>
			</ul>
			<p>当BigQuery ML模型<a id="_idIndexMarker674"/>在性能方面满足我们的期望时，我们可以做以下事情:</p>
			<ul>
				<li>通过利用已经存储在表中的数据，通过SQL使用BigQuery <strong class="bold"> (2a) </strong>中的模型。这种方法通常适用于批量预测，例如，我们可以定期运行BigQuery SQL语句，通过生成新的预测来每天或每周执行模型。</li>
				<li>将模型导出到TensorFlow<code>SavedFormat</code><strong class="bold">【2b】</strong>中，如我们在<a href="B16722_13_Final_ASB_ePub.xhtml#_idTextAnchor184"> <em class="italic">第十三章</em></a><em class="italic">中所述，用BigQuery ML运行tensor flow模型</em>。第二种方法特别适合在其他TensorFlow兼容平台上运行BigQuery之外的ML模型。通过将ML模型导出为XGBoost Booster格式，可以采用相同的方法。</li>
			</ul>
			<p>当我们导出BigQuery ML模型后，我们可以将ML算法部署到以下位置之一:</p>
			<ul>
				<li><strong class="bold">Google Cloud AI Platform Prediction</strong> <strong class="bold">(3a)</strong>: With this Google Cloud module, we can deploy trained ML models in the cloud and leverage the cloud infrastructure to serve the model and generate online predictions. This cloud service automatically provisions and manages the infrastructure resources to run the ML model and can scale up according to the number of requests that come from <a id="_idIndexMarker675"/>client applications. The deployment on Google Cloud AI Platform Prediction automatically generates a <strong class="bold">Representational State Transfer</strong> (<strong class="bold">REST</strong>) endpoint that can be used to invoke the <a id="_idIndexMarker676"/>model through <strong class="bold">HyperText Transfer Protocol</strong> (<strong class="bold">HTTP</strong>) requests. <p>当我们有多个客户端应用程序应该与我们的ML模型进行交互，并且我们不想担心服务的基础设施维护时，这种方法特别有用。作为一个先决条件，我们需要考虑只有在互联网连接可用的情况下才能使用这种方法。事实上，要调用<a id="_idIndexMarker677"/>云平台公开的REST <strong class="bold">应用编程接口</strong> ( <strong class="bold"> API </strong>)，我们需要执行客户端应用对云的HTTP请求。</p></li>
				<li>An <strong class="bold">on-premise machine</strong> where it can <a id="_idIndexMarker678"/>be deployed using containers <strong class="bold">(3b)</strong>. TensorFlow models, in fact, can be deployed using containers by leveraging a <strong class="bold">TensorFlow Serving Docker</strong> container. To understand the deployment<a id="_idIndexMarker679"/> steps of a TensorFlow model in a <strong class="bold">Docker</strong> container, you can check out the documentation at <a href="https://www.tensorflow.org/tfx/serving/docker">https://www.tensorflow.org/tfx/serving/docker</a>.<p class="callout-heading">重要说明</p><p class="callout">一个<strong class="bold">容器</strong>是一个运行在单一操作系统之上的虚拟化<a id="_idIndexMarker680"/>机制。Docker 是一个容器引擎，用于部署容器化的应用。容器引擎为每个应用程序分配硬件资源，并管理虚拟基础架构的可扩展性。</p></li>
			</ul>
			<p>当ML模型需要在特定条件下运行时，我们可以使用这种<a id="_idIndexMarker681"/>方法，例如在没有互联网连接或敏感数据的情况下。事实上，当我们部署本地机器ML模型时，云基础设施不再参与预测，并且本地环境和云之间没有数据传输。</p>
			<p>在这两种部署场景中，可以通过使用HTTP请求调用ML模型，在请求有效负载中传递输入参数。在ML模型执行结束时，预测被返回到响应有效负载中。</p>
			<h1 id="_idParaDest-202"><a id="_idTextAnchor204"/>总结</h1>
			<p>在这一章中，我们学习了在使用BigQuery ML实现ML用例的过程中可以应用的最重要的技巧和最佳实践。</p>
			<p>我们已经分析了数据准备的重要性；我们开始关注数据质量方面；然后，我们学习了如何轻松地分割数据，以获得平衡的训练、验证和测试集。</p>
			<p>然后，我们研究了如何使用BigQuery ML函数为特征工程进一步提高ML模型的性能。</p>
			<p>之后，我们将注意力集中在调整超参数上。当我们训练一个模型时，BigQuery ML允许我们选择不同的参数，这些变量会影响训练阶段。</p>
			<p>最后，我们已经理解了为什么在其他平台上部署BigQuery ML模型如此重要，以便我们获得在线预测并满足接近实时的业务场景。</p>
			<p>恭喜你读完了这本书！现在，您应该能够将BigQuery ML用于您的业务场景和用例。我建议你继续关注这个话题，这个话题如此有趣，发展如此之快。</p>
			<h1 id="_idParaDest-203"><a id="_idTextAnchor205"/>更多资源</h1>
			<ul>
				<li><strong class="bold">big query ML Create Model</strong>:<a href="https://console.cloud.google.com/marketplace/product/city-of-new-york/nyc-citi-bike">https://console . cloud . Google . com/market place/product/city-of-new York/NYC-Citi-bike</a></li>
				<li><strong class="bold"> BigQuery ML预处理函数</strong>:<a href="https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-preprocessing-functions">https://cloud . Google . com/big query-ML/docs/reference/standard-SQL/bigqueryml-预处理-函数</a></li>
				<li><code>CREATE MODEL</code> <strong class="bold">导入TensorFlow模型语句</strong>:<a href="https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create-tensorflow">https://cloud . Google . com/big query-ml/docs/reference/standard-SQL/bigqueryml-syntax-create-tensor flow</a></li>
				<li><code>ML EVALUATE</code> <strong class="bold">功能</strong>:<a href="https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-evaluate">https://cloud . Google . com/big query-ml/docs/reference/standard-SQL/bigqueryml-syntax-evaluate</a></li>
				<li><code>ML PREDICT</code> <strong class="bold">功能</strong>:<a href="https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-predict">https://cloud . Google . com/big query-ml/docs/reference/standard-SQL/bigqueryml-syntax-predict</a></li>
				<li><strong class="bold">导出BigQuery ML模型进行在线预测</strong>:<a href="https://cloud.google.com/bigquery-ml/docs/export-model-tutorial">https://cloud . Google . com/big query-ML/docs/export-model-tutorial</a></li>
			</ul>
		</div>
	

</body></html>