<html><head/><body>


	
		<title>B16722_08_Final_ASB_ePub</title>
		
	
	
		<div><h1 id="_idParaDest-117"><em class="italic"> <a id="_idTextAnchor119"/>第八章</em>:利用时间序列进行预测</h1>
			<p>使用历史数据预测未来趋势是我们可以通过机器学习进行的最有趣的活动之一。</p>
			<p>基于历史数据点和时间序列进行预测特别有趣，在不同的行业中非常有用。预测可以帮助我们预测未来，也可以帮助我们识别数据中不符合预期模式的异常。</p>
			<p>在这一章中，我们将重点介绍使用ARIMA加算法进行时间序列预测。这种技术可用于预测不同领域的数值，如公司的销售额、餐馆的顾客、股票价格和建筑物的耗电量。</p>
			<p>为了理解我们如何使用BigQuery ML来预测趋势并有效地展示我们的结果，我们将浏览以下主题:</p>
			<ul>
				<li>介绍业务场景</li>
				<li>发现时间序列预测</li>
				<li>探索和理解数据集</li>
				<li>训练时间序列预测模型</li>
				<li>评估时间序列预测模型</li>
				<li>使用时间序列预测模型</li>
				<li>展示预测</li>
			</ul>
			<h1 id="_idParaDest-118"><a id="_idTextAnchor120"/>技术要求</h1>
			<p>本章要求您访问网络浏览器，并能够利用以下功能:</p>
			<ul>
				<li>访问谷歌云控制台的GCP帐户</li>
				<li>托管BigQuery数据集的GCP项目</li>
			</ul>
			<p>现在，我们已经准备好了技术需求，让我们开始分析和开发我们的BigQuery ML预测模型。</p>
			<p>请看下面的视频，看看代码是如何运行的:【https://bit.ly/2QY0Qlp<a href="https://bit.ly/2QY0Qlp"/></p>
			<h1 id="_idParaDest-119"><a id="_idTextAnchor121"/>介绍业务场景</h1>
			<p>想象一下，你是一名为爱荷华州工作的商业分析师。国家通过收集该地区每家商店的数据来监测酒类和烈酒的零售分布。控制酒类销售对于监控公民健康和检查税收尤为重要。</p>
			<p>在下面的截图中，您可以看到一张商店中白酒和烈酒典型货架的图片:</p>
			<div><div><img src="img/B16722_08_001.jpg" alt="Figure 8.1 – The shelves in a liquor shop&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">图8.1-酒类商店的货架</p>
			<p>对于我们的业务<a id="_idIndexMarker404"/>场景，我们可以想象爱荷华州想要利用前几年收集的历史数据来预测2020年前30天销售的公升数。</p>
			<p>您的经理可能会要求您利用数据库中已经收集的时间序列数据来预测该州所有商店销售的公升数。</p>
			<p>作为一名业务分析师，您的工作是找到预测销售量的最佳算法，并将结果以图形方式呈现给州长的工作人员。</p>
			<p>现在，我们已经解释并理解了问题陈述，让我们来看看我们可以使用历史数据来预测销售的机器学习技术。</p>
			<h1 id="_idParaDest-120"><a id="_idTextAnchor122"/>发现时间序列预测</h1>
			<p><strong class="bold">时间序列</strong>是以一定时间频率映射的一系列数据<a id="_idIndexMarker405"/>点。例如，它可以包含在<a id="_idIndexMarker406"/>定期收集的股票价格、特定时间段内每天的销售量，或者由<strong class="bold">物联网</strong> ( <strong class="bold"> IoT </strong>)传感器在一天中测量的温度<a id="_idIndexMarker407"/>。</p>
			<p>在下图中，您可以看到一个温度传感器在2020年前15天收集的数据的时间序列图:</p>
			<div><div><img src="img/B16722_08_002.jpg" alt="Figure 8.2 – Example of time series generated by a temperature sensor&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">图8.2–温度传感器产生的时间序列示例</p>
			<p><strong class="bold">预测</strong>使用时间序列<a id="_idIndexMarker408"/>分析包括使用机器学习模型，通过利用已知的过去数据来预测特定措施的未来值。</p>
			<p>BigQuery ML提供了一种特定的机器学习算法，使用时间序列数据来预测数值。该算法被设计和开发来完成以下任务:</p>
			<ul>
				<li>自动清理和调整训练数据，以克服数据质量问题，例如，丢失或重复的值和峰值。</li>
				<li>补偿由特定时间段(如假期)引起的变化。</li>
				<li>使用季节和趋势分解黄土算法分解趋势。</li>
				<li>从数据中推断季节性。</li>
				<li>最后，应用<strong class="bold">自回归综合移动平均</strong> ( <strong class="bold"> ARIMA </strong>)模型的<a id="_idIndexMarker409"/>趋势建模，利用历史数值预测未来数值。</li>
			</ul>
			<p>你可以使用ARIMA模型来发现时间序列数据中隐藏的模式，或者预测某个特定指标的未来值。</p>
			<p>在本节中，我们学习了时间序列预测的基础知识。现在让我们看一下将用于构建BigQuery ML模型的数据集。</p>
			<h1 id="_idParaDest-121"><a id="_idTextAnchor123"/>探索和理解数据集</h1>
			<p>在开始机器学习模型的<a id="_idIndexMarker411"/>开发之前，我们将开始查看数据集及其结构。</p>
			<p>让我们首先清楚地了解BigQuery公共数据集中的时间序列数据，以便在下一节中构建预测模型。</p>
			<h2 id="_idParaDest-122"><a id="_idTextAnchor124"/>了解数据</h2>
			<p>在本节中，我们将分析<a id="_idIndexMarker412"/>数据的结构，以确定用于机器学习模型创建的字段。</p>
			<p>要开始研究数据，我们需要做以下工作:</p>
			<ol>
				<li value="1">登录我们的谷歌云控制台，从导航菜单访问<strong class="bold"> BigQuery </strong>用户界面。</li>
				<li>在我们在第2章 、<em class="italic">设置您的GCP和BigQuery环境</em>中创建的项目下创建一个新的数据集。对于这个用例，我们将使用默认选项创建数据集<code>08_sales_forecasting</code>。</li>
				<li>Open the GCP project <code>iowa_liquor_sales</code>.<p>如下面的<a id="_idIndexMarker413"/>截图所示，BigQuery公共数据集只包含一个表，该表存放从爱荷华州的酒类商店收集的数据:</p><div><img src="img/B16722_08_003.jpg" alt="Figure 8.3 – The Iowa liquor sales public dataset contains the sales of all the liquor shops in Iowa&#13;&#10;"/></div><p class="figure-caption">图8.3-爱荷华州酒类销售公共数据集包含爱荷华州所有酒类商店的销售额</p><p>我们将使用表<strong class="bold"> sales </strong>来构建我们的预测模型。该表包含自2012年以来在爱荷华州销售的所有酒类信息。</p></li>
				<li>Let's click on the table name <strong class="bold">sales</strong> in the BigQuery navigation menu to access the schema of the table:<div><img src="img/B16722_08_004.jpg" alt="Figure 8.4 – The structure of the table lists all the information collected in the table&#13;&#10;"/></div><p class="figure-caption">图8.4-表格的结构列出了表格中收集的所有信息</p></li>
				<li>Each field is well described in the <strong class="bold">Description</strong> column.<p>该表包含列<strong class="bold"> date </strong>，它表示销售的日期。出于我们的目的，我们将尝试<a id="_idIndexMarker414"/>预测某一天售出的总公升数。因此，我们可以注意到字段<strong class="bold"> volume_sold_liters </strong>的存在。该数字字段表示每笔交易中售出的酒类数量。</p></li>
			</ol>
			<p>在本节中，我们已经分析了<strong class="bold"> sales </strong>表的元数据，并了解了哪些字段对构建我们的预测模型有意义。接下来，是时候查看实际数据并开始查询了。</p>
			<h2 id="_idParaDest-123"><a id="_idTextAnchor125"/>检查数据质量</h2>
			<p>在这一部分，我们将应用<a id="_idIndexMarker415"/>一些数据质量检查来分析我们的训练数据集的完整性。</p>
			<p>让我们开始分析将用于构建BigQuery ML模型的表:</p>
			<ol>
				<li value="1">In order to identify the timeframe of our dataset, let's extract the minimum and maximum value of the <code>date</code> field from the <code>`bigquery-public-data.iowa_liquor_sales.sales`</code> table:<pre>SELECT min(date), max(date) FROM `bigquery-public-data.iowa_liquor_sales.sales`; </pre><p>通过执行这条SQL语句，我们可以注意到数据从2012年到2020年11月底。</p><p>查询结果显示在下面的屏幕截图中:</p><div><img src="img/B16722_08_005.jpg" alt="Figure 8.5 – The result of the query shows the timeframe of the dataset&#13;&#10;"/></div><p class="figure-caption">图8.5-查询结果显示了数据集的时间范围</p><p>出于我们的目的，我们可以将注意力集中在2018年和2019年发生的销售上，以预测2020年的前30天。</p></li>
				<li>In the second step, we'll analyze the number of distinct dates that we can find in the chosen timeframe:<pre>SELECT COUNT(DISTINCT date)
FROM
        `bigquery-public-data.iowa_liquor_sales.sales`
WHERE
        EXTRACT (year from date) = 2019         OR  EXTRACT (year from date) = 2018;</pre><p>字段<code>date</code>中可用的查询<code>COUNT</code>和<code>DISTINCT</code>值。使用表达式<code>EXTRACT (year from date)</code>，SQL语句只考虑发生在<code>2018</code>和<code>2019</code>的销售额。</p><p>查询的结果是<a id="_idIndexMarker416"/>，如下图所示:</p></li>
			</ol>
			<div><div><img src="img/B16722_08_006.jpg" alt="Figure 8.6 – The result of the query shows the distinct dates in the dataset&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">图8.6–查询结果显示了数据集中不同的日期</p>
			<p>从结果来看，很明显数据集不包含2年中每一天的信息。这可能是由于公共假期和商店关闭导致的丢失值造成的。这不是一个大问题，因为BigQuery ML会在训练阶段自动管理丢失的值。</p>
			<p>现在，我们已经执行了一些SQL查询来更好地理解我们的数据集，让我们专注于创建我们的训练数据集。</p>
			<h2 id="_idParaDest-124"><a id="_idTextAnchor126"/>创建训练数据集</h2>
			<p>在本节中，我们将创建一个表来<a id="_idIndexMarker417"/>存储将在下一节中用于训练预测模型的数据点。在训练模型之前，我们还将使用Data Studio对时间序列进行图形化分析。</p>
			<p>为了训练我们的模型，我们将创建一个特定的表来存放我们的时间序列的历史数据点:</p>
			<ol>
				<li value="1">Let's create a table that contains only two fields. The first one is <code>date</code> and the second one is <code>total_sold_liters</code>:<pre>CREATE OR REPLACE TABLE `08_sales_forecasting.iowa_liquor_sales` AS
SELECT 
        date,
        SUM(volume_sold_liters) total_sold_liters
FROM
        `bigquery-public-data.iowa_liquor_sales.sales`
WHERE
        EXTRACT (year from date) = 2019 OR  EXTRACT (year from date) = 2018
GROUP BY
        date;</pre><p>该查询在数据集<code>08_sales_forecasting</code>中创建表<code>iowa_liquor_sales</code>。</p><p>该表包含两个不同的字段:<code>date</code>列表示交易发生的时间，第二个字段计算为一天内售出的酒类数量的<code>SUM</code>。<code>total_sold_liters</code>是根据<code>GROUP BY date</code>子句以及<code>2018</code>和<code>2019</code>年的每一天计算的聚合值。</p></li>
				<li>The second step will be to graphically analyze the data stored in the table <code>iowa_liquor_sales</code>.<p>如下图所示，从左侧的BigQuery导航菜单中，我们选择数据集<code>08_sales_forecasting</code>，然后选择表<code>iowa_liquor_sales</code>:</p><div><img src="img/B16722_08_007.jpg" alt="Figure 8.7 – The training table iowa_liquor_sales is visible in the BigQuery navigation menu&#13;&#10;"/></div><p class="figure-caption">图8.7–在BigQuery导航菜单中可以看到培训表iowa _ liquor _ sales</p></li>
				<li>After that, let's <a id="_idIndexMarker418"/>click on <strong class="bold">EXPORT</strong> and then <strong class="bold">Explore with Data Studio</strong> as presented in the following screenshot:<div><img src="img/B16722_08_008.jpg" alt="Figure 8.8 – From BigQuery, it's possible to open Data Studio&#13;&#10;"/></div><p class="figure-caption">图8.8–从BigQuery中，可以打开Data Studio</p><p><strong class="bold"> Data Studio </strong>是Google提供的免费数据<a id="_idIndexMarker419"/>可视化工具<a id="_idIndexMarker420"/>，与BigQuery原生集成，可轻松用于在报告和图表中绘制数据。</p></li>
				<li>In Data Studio, we can select <strong class="bold">Time series chart</strong> as the chart type as shown in the following screenshot:<div><img src="img/B16722_08_009.jpg" alt="Figure 8.9 – In Data Studio, it's possible to select Time series chart to visualize the data&#13;&#10;"/></div><p class="figure-caption">图8.9–在Data Studio中，可以选择时间序列图来可视化数据</p></li>
				<li>Then, we can choose the field <strong class="bold">date</strong> for <strong class="bold">Dimension</strong> and <strong class="bold">total_sold_liters</strong> for <strong class="bold">Metric</strong>, as is presented in the following screenshot:<div><img src="img/B16722_08_010.jpg" alt="Figure 8.10 – In Data Studio, it's possible to select Dimension and Metric settings to draw the diagram&#13;&#10;"/></div><p class="figure-caption">图8.10–在Data Studio中，可以选择维度和度量设置来绘制图表</p></li>
				<li>After that, we <a id="_idIndexMarker421"/>can move to the <strong class="bold">Style</strong> tab and select <strong class="bold">Linear interpolation</strong> in the <strong class="bold">Missing Data</strong> combo box:<div><img src="img/B16722_08_011.jpg" alt="Figure 8.11 – The Linear interpolation option allows to improve the visualization &#13;&#10;of the diagram in case of missing values&#13;&#10;"/></div><p class="figure-caption">图8.11–线性插值选项允许在缺少值的情况下改善图表的可视化</p></li>
				<li>完成这些配置后，我们可以看到Data Studio绘制的图表，该图表显示了所选时间段内白酒销售量的趋势线:</li>
			</ol>
			<div><div><img src="img/B16722_08_012.jpg" alt="Figure 8.12 – The time series is shown in Data Studio with a blue line on the chart&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">图8.12–时间序列显示在Data Studio中，图表上有一条蓝线</p>
			<p>现在我们已经<a id="_idIndexMarker422"/>创建了一个表格，我们的预测模型将在这个表格上进行训练，并将数据可视化为一个图表，让我们开始创建机器学习模型。</p>
			<h1 id="_idParaDest-125"><a id="_idTextAnchor127"/>训练时间序列预测模型</h1>
			<p>在本节中，我们将训练<a id="_idIndexMarker423"/>big query ML时间序列预测模型。</p>
			<p>让我们开始训练机器学习模型<code>liquor_forecasting</code>，执行以下SQL语句:</p>
			<pre>CREATE OR REPLACE MODEL `08_sales_forecasting.liquor_forecasting`
OPTIONS
 (model_type = 'ARIMA',
  time_series_timestamp_col = 'date',
  time_series_data_col = 'total_sold_liters',
  auto_arima = TRUE,
  data_frequency = 'AUTO_FREQUENCY'
) AS
SELECT *
FROM
 `08_sales_forecasting.iowa_liquor_sales`; </pre>
			<p>SQL语句由以下部分组成:</p>
			<ul>
				<li>查询的第一行以关键字<code>CREATE OR REPLACE MODEL</code>开始，接着是机器学习模型的标识符<code>`08_sales_forecasting.liquor_forecasting`</code>，然后是<code>OPTIONS</code>。</li>
				<li>现在让我们专注于我们用来训练机器学习模型的选项。选择的车型类型是<code>'ARIMA'</code>。此选项描述了我们用来为BigQuery ML预测模型定型的算法。</li>
				<li><code>time_series_timestamp_col = 'date'</code>指定用于存放时间序列中数据点的时间的列。</li>
				<li>下一个选项<a id="_idIndexMarker424"/>选择列<code>total_sold_liters</code>作为存储每个数据点的值的列，它由子句<code>time_series_data_col = 'total_sold_liters'</code>表示。</li>
				<li>属性<code>auto_arima</code>，设置为<code>TRUE</code>，允许BigQuery ML自动识别模型的参数<code>p</code>、<code>d</code>和<code>q</code>。</li>
				<li>使用最后一个参数<code>'AUTO_FREQUENCY'</code>，BigQuery自动推断时间序列的频率。在这种情况下，频率是每天。其他选项有<code>'HOURLY'</code>、<code>'DAILY'</code>、<code>'WEEKLY'</code>、<code>'MONTHLY'</code>、<code>'QUARTERLY'</code>和<code>'YEARLY'</code>。</li>
				<li>SQL语句的最后一部分由应用于训练表<code>iowa_liquor_sales</code>的<code>SELECT</code>语句组成。</li>
			</ul>
			<p>现在，我们已经训练了基于ARIMA算法的时间序列预测模型，让我们看看如何使用BigQuery ML语法和BigQuery UI来评估它。</p>
			<h1 id="_idParaDest-126"><a id="_idTextAnchor128"/>评估时间序列预测模型</h1>
			<p>在本节中，我们将<a id="_idIndexMarker425"/>评估我们在上一节中训练的机器学习模型的性能。</p>
			<p>时间序列模型的评估阶段可以通过使用<code>ML.EVALUATE</code> BigQuery ML函数来执行。</p>
			<p>让我们执行以下查询来提取表征ARIMA模型的所有评估参数:</p>
			<pre>SELECT *
FROM
 ML.EVALUATE(MODEL `08_sales_forecasting.liquor_forecasting`);</pre>
			<p>查询结果如下图所示:</p>
			<div><div><img src="img/B16722_08_013.jpg" alt="Figure 8.13 – The records extracted from the evaluation of the time series forecasting model&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">图8.13-从时间序列预测模型的评估中提取的记录</p>
			<p>每行定义了被分类为<strong class="bold"> ARIMA(p，d，q) </strong>模型的每个非季节性ARIMA模型。对于每一行，我们可以注意到以下内容:</p>
			<ul>
				<li>字段<strong class="bold"> non_seasonal_p </strong>代表ARIMA模型的参数<strong class="bold"> p </strong>。该行的值是用于预测的自回归项的数量。它表示用于预测时间序列下一个值的观察值的数量。</li>
				<li>字段<strong class="bold"> non_seasonal_d </strong>代表ARIMA模型的参数<strong class="bold"> d </strong>。该行的值指示需要应用一个数据点与前一个数据点之间的差异多少次，以减轻数据集的季节性。</li>
				<li><strong class="bold"> non_seasonal_q </strong>代表ARIMA模型的参数<strong class="bold"> q </strong>。它表示用于计算<a id="_idIndexMarker426"/>移动平均值的观察值数量，移动平均值用于预测时间序列的下一个值。</li>
				<li><strong class="bold"> has_drift </strong>显示漂移常数是否应用于模型。</li>
				<li><strong class="bold"> log_likelihood </strong>是衡量统计模型对特定数据集的拟合程度的参数。</li>
				<li><strong class="bold"> AIC </strong>代表<strong class="bold">赤池信息准则</strong>。该值用于评估模型的良好度<a id="_idIndexMarker427"/>。AIC值越低通常越好。因此，我们可以认为第一种模式是最好的。</li>
				<li><strong class="bold">方差</strong>测量数据点与序列平均值的距离。</li>
				<li><strong class="bold">季节性周期</strong>列表达了我们数据中的季节性模式。在这种情况下，BigQuery ML在销售时间序列中识别出了每周<strong class="bold">和每年</strong>和<strong class="bold">的模式。</strong></li>
			</ul>
			<p>现在我们已经展示了时间序列预测模型的性能指标，让我们试着用它来预测2020年的前30天。</p>
			<h1 id="_idParaDest-127"><a id="_idTextAnchor129"/>使用时间序列预测模型</h1>
			<p>为了使用我们的<a id="_idIndexMarker428"/> BigQuery ML模型，我们将使用<code>ML.FORECAST</code>函数来指定预测的参数。</p>
			<p>该查询将提取由接受以下参数的预测函数生成的所有字段:</p>
			<ul>
				<li>型号名称<code>`08_sales_forecasting.liquor_forecasting`</code>，前面有关键字<code>MODEL</code>。</li>
				<li>一个<code>STRUCT</code>，它包括预测的<code>horizon</code>:<code>30</code>天和为预测选择的<code>confidence_level</code>——在本例中，80%: <pre>SELECT   * FROM   ML.FORECAST(MODEL `08_sales_forecasting.liquor_forecasting`,               STRUCT(30 AS horizon, 0.8 AS confidence_level)); </pre></li>
			</ul>
			<p>查询的执行会生成如下屏幕截图所示的记录:</p>
			<div><div><img src="img/B16722_08_014.jpg" alt="Figure 8.14 – The results generated by the forecast function&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">图8.14-预测功能生成的结果</p>
			<p>我们可以在<em class="italic">图8.14 </em>中注意到，预测是根据字段<code>confidence_level</code>中的日期按时间顺序排序的。值0.8意味着80%的预测值应该落入由字段<strong class="bold">预测_区间_下限</strong>和<strong class="bold">预测_区间_上限</strong>确定的预测区间。</p>
			<p>现在我们已经应用了我们的模型，让我们了解如何使用Data Studio有效地呈现结果。</p>
			<h1 id="_idParaDest-128"><a id="_idTextAnchor130"/>展示预测</h1>
			<p>在本节中，我们将<a id="_idIndexMarker430"/>使用Data Studio创建一个时序图，以便以图形方式呈现预测结果。</p>
			<p>使用以下查询，我们可以创建一个包含历史值和预测值的表:</p>
			<pre>CREATE OR REPLACE TABLE `08_sales_forecasting.iowa_liquor_sales_forecast` AS
SELECT
  history_date AS date,
  history_value,
  NULL AS forecast_value,
  NULL AS prediction_interval_lower_bound,
  NULL AS prediction_interval_upper_bound
FROM
  (
    SELECT
      date AS history_date,
      total_sold_liters AS history_value
    FROM
      `08_sales_forecasting.iowa_liquor_sales`
  )
UNION ALL
SELECT
  CAST(forecast_timestamp AS DATE) AS date,
  NULL AS history_value,
  forecast_value,
  prediction_interval_lower_bound,
  prediction_interval_upper_bound
FROM
  ML.FORECAST(MODEL `08_sales_forecasting.liquor_forecasting`,
              STRUCT(30 AS horizon, 0.8 AS confidence_level));</pre>
			<p>SQL语句的执行会生成表<code>iowa_liquor_sales_forecast</code>，该表由以下内容组成:</p>
			<ul>
				<li>所有的记录都来自训练表<code>iowa_liquor_sales</code>，我们已经从中提取了时间序列的<code>history_date</code>和<code>history_value</code>。我们还<a id="_idIndexMarker431"/>添加了一些<code>NULL</code>字段来标准化模式，查询的第二部分由<code>UNION ALL</code>分隔。</li>
				<li>由<code>ML.FORECAST</code>函数生成的所有预测记录都已经在前面的章节<em class="italic">中使用时间序列预测模型</em>进行了应用。特别有趣的是，我们不仅提取了<code>forecast_value</code>，还提取了由字段<code>prediction_interval_lower_bound</code>和<code>prediction_interval_upper_bound</code>表示的预测的下限和上限。</li>
				<li>应用于列<code>forecast_timestamp</code>的<code>CAST</code>函数的存在对于根据<a id="_idIndexMarker432"/>到训练表的模式将数据类型从<code>TIMESTAMP</code>改变为<code>DATE</code>是必要的。</li>
			</ul>
			<p>正如我们已经在<em class="italic">创建训练数据集</em>一节中所做的那样，我们现在可以执行以下操作:</p>
			<ol>
				<li value="1">从BigQuery导航菜单中选择我们刚刚创建的<code>iowa_liquor_sales_forecast</code>表。</li>
				<li>点击<strong class="bold">导出</strong>，然后点击<strong class="bold">使用Data Studio </strong>浏览，以访问报告工具。</li>
				<li>从<strong class="bold">图表</strong>面板中选择<strong class="bold">时序图</strong>。</li>
				<li>Drag and drop <strong class="bold">history_value</strong>, <strong class="bold">forecast_value</strong>, <strong class="bold">prediction_interval_lower_bound</strong>, and <strong class="bold">prediction_interval_upper_bound</strong> into the <strong class="bold">Metric</strong> panel as shown in the following screenshot:<div><img src="img/B16722_08_015.jpg" alt="Figure 8.15 – The DATA panel allows us to customize the metrics of the chart&#13;&#10;"/></div><p class="figure-caption">图8.15–数据面板允许我们自定义图表的指标</p></li>
				<li>移动到<strong class="bold">样式</strong>面板，向下滚动<a id="_idIndexMarker433"/>直到我们找到<strong class="bold">缺失数据</strong>部分。这里我们选择<strong class="bold">线性插补</strong>。</li>
				<li>Then, at the top of the screen, we can apply a filter on the <strong class="bold">date</strong> column to focus our chart only on the period that goes from the first of <strong class="bold">December 2019</strong> until the thirtieth of <strong class="bold">January 2020</strong>:<div><img src="img/B16722_08_016.jpg" alt="Figure 8.16 – Application of the filter on the date column&#13;&#10;"/></div><p class="figure-caption">图8.16–在日期列上应用过滤器</p></li>
				<li>点击<strong class="bold">应用</strong>，图表<a id="_idIndexMarker434"/>将最终可视化，如下图所示:</li>
			</ol>
			<div><div><img src="img/B16722_08_017.jpg" alt="Figure 8.17 – Time series chart in Data Studio&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">图8.17-Data Studio中的时间序列图</p>
			<p>查看<a id="_idIndexMarker435"/>图的图例，我们可以看到用不同颜色表示的历史值和预测值。我们还可以注意到，<strong class="bold"> forecast_value </strong>线总是包含在预测区间内。</p>
			<h1 id="_idParaDest-129"><a id="_idTextAnchor131"/>总结</h1>
			<p>在这一章中，我们建立了时间序列预测机器学习模型。在介绍了业务场景之后，我们发现了什么是时间序列预测，特别是用于从历史数据点预测值的ARIMA算法。</p>
			<p>在深入开发BigQuery ML模型之前，我们对爱荷华州收集的与该地区商店的酒类销售相关的数据进行了一些分析。为此，我们介绍了报告工具Data Studio的使用，可以通过BigQuery UI轻松访问它，并利用它来绘制时间序列图。</p>
			<p>然后，我们创建了我们的训练表，它包括历史数据的时间序列，并在其上训练我们的BigQuery ML模型。然后，我们通过利用BigQuery ML SQL语法来评估时间序列预测模型。</p>
			<p>在最后一步中，我们预测了爱荷华州30天内销售的酒类数量，并将结果绘制在Data Studio仪表板中，该仪表板可以呈现给非技术人员。</p>
			<p>在下一章，我们将介绍矩阵分解算法来构建推荐引擎。</p>
			<h1 id="_idParaDest-130"><a id="_idTextAnchor132"/>更多资源</h1>
			<ul>
				<li><strong class="bold">爱荷华州酒类零售公共数据集</strong>:<a href="https://console.cloud.google.com/marketplace/product/iowa-department-of-commerce/iowa-liquor-sales">https://console . cloud . Google . com/market place/product/Iowa-department-of-commerce/Iowa-liquid-Sales</a></li>
				<li><strong class="bold"> BigQuery ML创建模型</strong>:<a href="https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create">https://cloud . Google . com/big query-ML/docs/reference/standard-SQL/bigqueryml-syntax-Create</a></li>
				<li><strong class="bold"> BigQuery ML评估模型</strong>:<a href="https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-evaluate">https://cloud . Google . com/big query-ML/docs/reference/standard-SQL/bigqueryml-syntax-Evaluate</a></li>
				<li><strong class="bold"> BigQuery ML预测</strong>:<a href="https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-forecast">https://cloud . Google . com/big query-ML/docs/reference/standard-SQL/bigqueryml-syntax-Forecast</a></li>
				<li><strong class="bold"> BigQuery ML时间序列预测示例</strong>:<a href="https://cloud.google.com/bigquery-ml/docs/arima-single-timeseries-forecasting-tutorial">https://cloud . Google . com/big query-ML/docs/ARIMA-single-Time Series-Forecasting-tutorial</a></li>
			</ul>
		</div>
	

</body></html>