# 一、机器学习的数据驱动边缘介绍

本书的目的是分享在**边缘**运行的**端到端** ( **E2E** )解决方案开发的规范模式，边缘**边缘是计算拓扑中最靠近模拟接口和数字接口的空间，反之亦然。具体来说，这本书专注于那些边缘用例，其中**机器学习** ( **ML** )技术带来了最大的价值，并教你如何使用**亚马逊网络服务** ( **AWS** )提供的当代工具开发这些解决方案。**

在本章中，您将了解网络物理成果的基础，以及实现这些成果的常见挑战、角色和工具。本章简要介绍了智能家居和工业**物联网** ( **物联网**)设置，并设定了将指导整本书构建的动手项目的场景。它将描述 ML 如何转变我们的能力，以加速云之外的决策。您将了解您将使用 AWS 服务(如 **AWS 物联网 Greengrass** 和**亚马逊 SageMaker** )构建的 E2E 项目的范围。在进入第一个实践章节之前，您还将了解需要哪些类型的技术要求， [*第 2 章*](B17595_02_Final_SS_ePub.xhtml#_idTextAnchor032)*边缘工作负载的基础*。

本章将涵盖以下主题:

*   生活在边缘
*   把 ML 带到边缘
*   完成工作的工具
*   智能家居和工业物联网需求
*   场景设置:现代智能家居解决方案
*   实践先决条件

# 边缘生活

**边缘**是距离模拟接口和数字接口最近的计算拓扑空间，反之亦然。第一个计算系统的边缘，比如 1945 年的电子数字积分器和通用计算机，仅仅是用来输入指令和接收打印输出的接口。如果不直接面对这些界面，你就无法访问它们。随着 20 世纪 70 年代远程访问大型机计算的出现，计算的边缘进一步向外移动到公共终端，这些终端安装在桌子上并通过同轴电缆连接到大型机。用户可以从实验室或工作站方便地访问本地大型机的公共资源，以使用诸如文字处理器或电子表格等高级功能来完成他们的工作。

随着计算能力的提高以及尺寸和成本的降低，人类使用边缘进行计算的进化在继续。我们每天使用的设备，如个人电脑和智能手机，为我们带来了无数的结果。有些成果完全在边缘(设备上)交付，但许多成果只有在连接到互联网并使用远程服务时才能发挥作用。人类的边缘工作负载往往是多样化的、多用途的，并处理一系列动态变化。我们不可能列举出我们可以用智能手机和它的网络浏览器做的所有事情！这些优势的例子都有一个共同点，即人类既是计算任务的操作者，也是接受者。然而，边缘不仅仅是人类和硅的界面。

edge 的另一个重要历史趋势是自主功能。我们设计计算机器来感知和行动，然后将它们部署在可能根本没有人类互动的环境中。自主边缘的例子包括用于制造装配、卫星和气象站的机器人。这些边缘工作负载不同于人工驱动的工作负载，因为它们往往高度专业化、用途单一，并且处理的动态性很小。它们执行一组特定的功能，始终如一地执行这些功能，并重复这些功能直到过时。下图提供了一段时间以来人类驱动的界面和自主机器的简单历史:

![Figure 1.1 – A timeline of cyber-physical interfaces at the edge from 1950 to 2020
](img/B17595_01_001.jpg)

图 1.1-从 1950 年到 2020 年边缘的网络物理界面时间表

在当今无线通信、微控制器和微处理器、电气效率和耐用性的技术进步中，优势可能无处不在。你们中的一些人会在电子阅读器上阅读这本书，这是一种边缘设备，在 10 **公里**的高度，以 900 **公里/小时**的速度巡航。旅行者 1 号宇宙飞船是最遥远的人造边缘解决方案，在撰写本文时，它仍在距离地球 152 **AU** 的地方运行！这里的趋势是，随着时间的推移，沿着通往边缘的路径的能力范围将继续增长，路径的长度也将增长(以及路径上的点数！)以及可以部署这些功能的偏远地区。下图说明了跨计算拓扑的实体、计算能力和功能的扩展:

![Figure 1.2 – Illustration of computing scale from the cloud to a sensor
](img/B17595_01_002.jpg)

图 1.2–从云到传感器的计算规模示意图

我们的世界充满了传感器和执行器；随着时间的推移，越来越多的这些设备正在加入物联网。一个**传感器**是从我们的模拟世界获取测量值并将其转换为数字数据的任何组件。一个**致动器**是接受一些数字命令并施加一些力或改变进入模拟世界的任何部件。有太多的信息需要收集、推理和行动。开发边缘解决方案是一个激动人心的前沿领域，原因如下:

*   当今世界有大量的可能性和问题需要解决。我们需要更多的创新和解决方案来应对全球结果，例如由联合国确定的 17 个可持续发展目标。
*   开发边缘解决方案的成本因素不断缩减，降低了实验的门槛。
*   让任何有学习欲望的人都能接触到解决方案开发的工具正在成熟，并且变得更容易使用。

这本书将教你如何使用现代边缘到云技术开发边缘解决方案的软件，包括如何编写与物理传感器和执行器交互的软件，如何处理和与其他本地设备和云交换数据，以及如何从边缘的高级 ML 技术中获得价值。比“如何做”更重要的是“为什么”——换句话说:*为什么我们要以这种方式构建解决方案？*这本书还将解释构建良好架构的解决方案的架构模式和技巧，这些解决方案将超越特定技术和工具的时代。

编程语言和框架等实现细节随着流行性、必要性和技术突破而变化。我们所构建的模式以及我们为什么以特定的方式构建它们经受住了时间的考验，并将为您未来的许多项目服务。例如，1995 年由*伽马*、*赫尔姆*、*约翰逊*和*维里西德斯*撰写的《设计模式:可重用面向对象软件的元素》至今仍在指导软件开发人员，尽管作者们当时使用的工具在不断发展。我们，作者，不能把自己比作这些伟大的思想家或他们的优秀的书，但我们把它作为我们如何写这本书的一个例子。

## 边缘解决方案的常见概念

就本书的目的而言，我们将扩展边缘的定义，将其定义为在云及其数据中心之外，远离互联网主干网运行的网络物理解决方案的任何组件。这种优势的例子包括控制家庭智能灯泡的无线电开关，记录采矿现场拖拉机拖车占空比和发动机遥测的传感器，允许地铁通勤者进入的十字转门，在大西洋漂流的气象浮标，在新的**增强现实** ( **AR** )游戏中使用摄像头的智能手机，当然还有旅行者 1 号。运行在数据中心以保持服务器冷却的环境控制系统仍然是边缘解决方案；我们的定义旨在突出那些远离全球计算拓扑*引力*的组件。下图显示了在此计算拓扑中，远离数据中心重心的不同距离上发生的计算示例:

![Figure 1.3 – Examples of the edge at various distances
](img/B17595_01_003.jpg)

图 1.3–不同距离的边缘示例

一个**信息物理解决方案**是一个*结合硬件和软件用于数字世界和模拟世界*的互操作。如果模拟世界是一组我们可以衡量现实并对其进行改变的属性，那么数字世界就是我们捕获的关于现实的信息，我们可以存储、传输和推理这些信息。信息物理解决方案可以是独立的，也可以是封闭的回路，如工业制造车间的**可编程逻辑控制器** ( **PLC** )或家庭中的数字恒温器。它可以自主地或在本地参与者(如人或交换机)的指导下执行某些任务。

因此，**边缘解决方案**是*信息物理解决方案的特定扩展，因为它意味着在某个时间点*与某个其他实体的通信或信息交换。它也可以在本地参与者或远程参与者(如 web 服务器)的指导下自主运行。传感器为需要所提供数据的人提供自主功能，或通过 PLC 或服务器上运行的代码作为输入来驱动决策。这些决定，不管是由计算机还是人做出的，都是通过执行器来执行的。模拟的人类对寒冷做出反应的故事是*我觉得冷，所以我会生火取暖*，而数字故事可能看起来像下面的伪代码运行本地控制器来打开炉子:

```
if( io.read_value(THERMOMETER_PIN) < LOWER_HEAT_THRESHOLD ) {
     io.write_value(FURNACE_PIN, HIGH);
}
```

我们将进一步定义具有某种计算能力的边缘解决方案，例如微控制器或微处理器来执行指令。它们至少有一个传感器或致动器来与物理世界接口。边缘解决方案将在某个时间点与网络上或物理世界中的另一个实体交互，例如人或另一台机器。

根据这个定义，现在离你最近的边缘解决方案是什么？

传感器、执行器和计算能力是边缘解决方案最基本的构建模块。我们有兴趣开发的解决方案要复杂得多。作为物联网架构师，您的责任是确保边缘解决方案安全、可靠、高性能且经济高效。一个架构良好的解决方案的高标准意味着您需要在网络、加密、电子工程和操作系统等基础知识方面达到熟练程度。当今实用的生产边缘解决方案整合了多种功能，例如处理实时信号、通过多种传输介质在系统之间进行通信、写入具有冗余故障恢复功能的固件更新，以及自我诊断设备健康状况。

这可能会让人感到难以承受，而现实是为边缘构建解决方案既复杂又繁琐。在实践中，我们使用专门构建的工具和持久的模式，将投入的精力集中在创新和解决问题上，而不是自举和重新发明轮子。本书的目标是从功能性成果的小处着手，逐步构建 E2E 解决方案的大框架。在构建下一个解决方案的过程中，您将从中受益匪浅。虽然这本书没有涵盖该领域的每个主题，但我们会抓住每一个机会强调进一步的教育资源，以帮助您在包括的重点领域之外建立熟练程度。这就是构建边缘解决方案的全部内容！接下来，让我们回顾一下 ML 是如何适应的。

# 将 ML 带到边缘

ML 是一项令人难以置信的技术，在解决当今问题方面取得了进展。训练计算机处理大量信息的能力，在对新输入进行分类和预测结果的服务中，可以与人脑相媲美，在某些应用中甚至超过人脑。为此， *ML 定义了开发人工智能(AI)的机制*。

云提供的巨大计算能力大大减少了训练 ML 模型的时间。数据科学家和数据工程师可以在几个小时而不是几天内训练生产模型。最大似然算法的进步使得模型本身变得更加可移植，这意味着运行模型可以在计算和内存配置更小的计算机上运行。交付便携式 ML 模型的意义不能被夸大。

在边缘运行 ML 模型有助于我们作为架构师提供最佳的边缘解决方案设计原则。通过在边缘托管便携式模型，与我们解决方案的其余部分的接近带来了四个主要优势，概述如下:

*   首先，这意味着该解决方案可以通过不等待对远程服务器的调用的往返延迟来最大化对依赖于 ML 推理结果的能力的响应。解释来自即将发生故障的发动机的无数信号的延迟可以在 10 **毫秒** ( **毫秒**)而不是 100 毫秒内完成。这种程度的延迟可以在安全操作和灾难性故障之间产生差异。
*   第二，它意味着解决方案的功能不会被网络拥塞中断，并且可以在边缘解决方案与公共互联网断开的状态下运行。这为 ML 解决方案脱离云服务运行开辟了可能性。无论连接可用性如何，都可以检测和防止即将发生的发动机故障。
*   第三，任何时候我们都可以使用 ML 模型在本地处理数据，减少最终需要存储在云中的数据量，我们还可以节省传输成本。想想一份昂贵的卫星互联网提供商合同；通过这种传输介质，物联网架构师只想传输对降低成本绝对必要的数据。
*   第四，本地数据处理的另一个好处是，它支持必须符合法规的用例，其中数据必须位于本地国家或遵守隐私问题，如医疗保健数据。可以说，用于拯救生命的医院设备需要尽可能多的智能监控，但运行时数据可能在法律上不允许离开医院。

下图说明了这四个主要优势:

![Figure 1.4 – The four key benefits of ML at the edge
](img/B17595_01_004.jpg)

图 1.4–ML 在边缘的四大优势

想象一下一架可以携带 ML 模型的水下无人机，它可以对来自视频的图像进行分类。无人驾驶飞机可以在远离任何网络连接的情况下对图像进行操作和推断，并可以丢弃任何没有任何价值的图像。例如，如果无人机的任务是只带回独角鲸的图像，那么无人机就不需要大量的存储来保存每一个视频片段供以后分析。无人机可以使用 ML 对独角鲸的图像进行分类，并且只保存那些用于回家途中的图像。随着时间的推移，存储成本不断下降，但考虑到 edge 解决方案(如本解决方案)的宝贵物料清单和空间，采用便携式 ML 型号最终可以大幅节省成本。

下图说明了这一概念:

![Figure 1.5 – Illustration of a submersible drone concept processing photographs and storing only those where a local ML model identifies a narwhal in the subject
](img/B17595_01_005.jpg)

图 1.5-处理照片并仅存储那些本地 ML 模型识别出主题中的独角鲸的水下无人机概念的图示

这本书将教你从 edge 解决方案常见的机器数据中训练 ML 模型的基础知识，以及如何将这样的模型部署到 edge，以利用将 ML 功能与在 edge 上运行的价值主张相结合的。我们还将教您如何在边缘操作 ML 模型，这意味着分析模型的性能，以及如何设置基础设施，以便将更新部署到在云中重新训练的模型。

在本书的课程范围之外，是对推动 ML 和 AI 领域的数据科学的全面深入的探讨。你不需要精通该领域就能理解 ML-powered edge 解决方案的模式。了解如何使用**输入/输出** ( **I/O** )缓冲器在软件中读写数据，就足以完成本书中使用的 ML 工具。

接下来，让我们回顾一下我们需要构建的工具种类，以及我们将用于构建解决方案的特定工具。

# 完成工作的工具

这本书关注 AWS 提供的工具，这些工具在边缘交付基于 ML 的解决方案。随着 2015 年 AWS 物联网核心服务的推出，AWS 已经建立了一套物联网服务，以帮助开发人员构建受益于云计算力量的网络物理解决方案。这些服务包括边缘软件，如用于微控制器的 FreeRTOS 实时操作系统，以及具有物联网核心和物联网设备管理的设备群的**命令和控制** ( **C2** )，以及通过物联网站点和物联网事件等服务从数据中产生可操作见解的分析能力。物联网服务与亚马逊的 ML 服务套件很好地相互作用，使开发人员能够吸收大量数据，用于通过亚马逊 SageMaker 等服务训练 ML 模型。AWS 还可以轻松地将训练好的模型作为端点，用于对实时数据进行推理，或者将这些模型部署到边缘进行本地推理。

您将需要三种软件工具来在边缘创建和操作有目的的智能工作负载。接下来，我们将根据 AWS 提供的工具的一般功能和具体实现来定义每个工具，以构建本书中的项目。任何**信息技术** ( **IT** )总是有更多的复杂性，但是为了我们的目的，这是本书将关注的三种主要工具，以便将智能传递到边缘。

## 边缘运行时

第一个工具是一个用于编排 edge 软件的*运行时。运行库将执行您的代码，并处理来往于您的代码的本地事件。理想情况下，这个运行时是自我修复的，这意味着如果任何服务失败，它应该通过使用故障转移或重新启动服务来自动恢复。这些本地事件可以是触发某些代码运行的硬件中断、读取模拟传感器输入的定时事件，或者转换数字命令以改变所连接的执行器(如开关)的状态。*

本书的主角 AWS 服务是**物联网绿草**。这是我们将用于第一种工具的服务:编排 edge 软件的运行时。物联网 Greengrass 定义了用于编排边缘软件解决方案的打包运行时，以及用于管理在网关等设备上运行的边缘部署车队的 web 服务。2020 年，AWS 发布了物联网 Greengrass 的新主要版本 version 2，该版本将 edge 软件包重新架构为 Apache 2.0 许可下的开源 Java 项目。在这个版本中，开发人员获得了一个新的软件开发模型来创作和部署链接的组件，使他们能够专注于构建业务应用，而不是担心复杂的边缘到云解决方案的基础架构。我们将深入物联网 Greengrass 的更多细节，并在下一章开始用它构建我们的第一个应用。

下图说明了物联网 Greengrass 如何在边缘和云中发挥作用:

![Figure 1.6 – Illustration of how IoT Greengrass plays a role both at the edge and in the cloud
](img/B17595_01_006.jpg)

图 1.6–说明物联网 Greengrass 如何在边缘和云中发挥作用

## 毫升

第二个工具是一个 ML 库和模型。该库规定了如何读取和使用模型，以及本地代码如何调用模型，也称为*做出推断*。模型是训练工作的输出，训练工作将智能打包到一个更简单的框架中，用于将新输入转化为推理。我们将需要一个工具来从一组称为训练集的数据中训练一个新的模型。然后，经过训练的模型将被打包并部署到我们的 edge 运行时工具中。edge 解决方案将需要相应的库和代码，这些库和代码知道如何根据模型处理新数据以产生推理。

我们的第二个工具 ML 库和模型的实现是由 Amazon SageMaker 提供的。SageMaker 是亚马逊为 ML 开发者提供的服务套件。其中包括准备用于训练的数据、使用内置或自定义算法构建模型、调整模型以及将模型作为**应用编程接口** ( **API** )端点进行管理或将其部署到需要运行的任何地方的服务。你甚至可以在没有任何先前经验的情况下训练一个模型，SageMaker 将分析你的数据集，选择一种算法，建立一组调整后的模型，并告诉你哪一个最适合你的数据。

对于一些人工智能用例，如预测数字序列和将人类笔迹解释为文本，亚马逊提供了专门构建的服务，这些服务已经解决了训练 ML 模型的繁重任务。请注意，数据科学的教学超出了本书的范围。我们将使用流行的 ML 框架和算法来交付物联网解决方案的成果。当我们使用框架和算法时，我们也将提供框架和算法的理由，让你对我们如何选择它们有所了解。我们将在 [*第四章*](B17595_04_Final_SS_ePub.xhtml#_idTextAnchor073) 、*将云扩展到边缘*中介绍将 ML 资源部署到边缘的概念，并在 [*第七章*](B17595_07_Final_SS_ePub.xhtml#_idTextAnchor138) 、*边缘的机器学习工作负载*、 [*第九章*](B17595_09_Final_SS_ePub.xhtml#_idTextAnchor182) 、*规模化的车队管理*中深入探讨 ML 工作负载。

## 与边缘沟通

第三个工具是与边缘解决方案沟通的方法。这包括将软件和更新部署到边缘硬件和用于交换双向数据的机制。由于本书涵盖的边缘解决方案是那些与云互操作的解决方案，因此需要一种在边缘和云之间传输数据和命令的方法。这可以是任何数量的**开放系统互联** ( **OSI** )模型第 7 层协议的，物联网中常见的例子有**超文本传输协议**(**HTTP**)**消息队列遥测传输** ( **MQTT** )，以及**受限应用协议** ( **CoAP** )。

服务的 AWS 物联网套件符合这里的需求，并在边缘运行的物联网 Greengrass 解决方案和我们将在 Amazon SageMaker 中使用的 ML 功能之间充当桥梁。物联网核心是一种为 HTTP 和 MQTT 协议提供可扩展的设备网关和消息代理的服务。它将处理云连接、认证和授权，以及边缘和云之间的消息路由。**物联网设备管理**是一项大规模运营设备群的服务。它将帮助我们定义边缘设备的逻辑分组，这些设备将运行相同的软件解决方案并将更新部署到我们的设备群中。本书的大部分章节都将依赖于此类工具，第 8 章 、 *DevOps 和 MLOps for the Edge、*和 [*第 9 章*](B17595_09_Final_SS_ePub.xhtml#_idTextAnchor182) 、*大规模车队管理*中重点介绍了车队管理的规模。

考虑到这些工具，我们接下来将探索市场、角色和用例，在这些市场、角色和用例中，具有 ML 功能的边缘到云解决方案推动了最大的需求。

# 智能家居和工业物联网需求

市场趋势和分析表明，物联网行业，尤其是工业物联网领域，将出现大幅增长。2020 年 *Mordor Intelligence* 报告*智能家居市场——增长、趋势、新冠肺炎影响和预测(2021-2026)* 预计智能家居市场将从 2020 年的 790 亿美元 ( **USD** )增长到 2026 年的 3130 亿美元。同样，2019 年*大观研究*报告*工业物联网市场规模，份额&趋势分析报告按组件(解决方案，服务，平台)按最终用途(制造，物流&运输)，按地区和细分市场预测，2019-2025* 预测工业物联网市场将从 2018 年的 2140 亿美元增长到 2025 年的 9490 亿美元。在这两项研究中，估计的**复合年增长率** ( **CAGR** )约为 25-30%。这意味着新产品、解决方案和服务有很大的机会在企业和最终消费者中获得成功。

你可以在这里看到对智能家居和工业物联网市场预测的描述:

![Figure 1.7 – Market forecasts for smart home and industrial IoT
](img/B17595_01_007.jpg)

图 1.7–智能家居和工业物联网的市场预测

记住预测仅仅是预测，这一点很重要。这些预测变成现实的唯一方法是，像你我这样的发明家和问题解决者兴奋起来，做出东西来！理解智能家居和工业物联网解决方案的未来的关键是它们如何受到完整的边缘到云模式和本地 ML 推理的价值主张的影响。我们可以思考将 ML 带到边缘的主要好处，看看这些市场中的解决方案如何适合创新。

## 智能家居用例

在智能家居解决方案中，功能标准是围绕环境监控(温度/电力消耗/发光)、自动状态改变(早上打开，晚上关闭)以及在以前不可能的地方引入便利(在回家的路上打开空调)。

使用产品的主要角色是居住在解决方案部署地的最终消费者。次要人物角色是主人、宠物、公共设施和家庭安全服务提供商的客人。在产品设计层面，主要利益相关者是物联网架构师、安全工程师、设备制造商和数据科学家。智能家居产品一直在探索，并在利用云中托管的人工智能和人工智能的力量时获得了重大成功。

以下是将 ML 功能部署到边缘可以让智能家居用例受益的三种方式:

*   **语音辅助界面**:亚马逊的 Alexa 等智能语音助手依靠云来执行语音到文本的例程，以便处理命令并生成音频响应。在边缘运行语音识别模型有助于让消费者即使在网络不可用时也能使用一些常用命令。训练模型识别谁在说话，并将其纳入回应中，这增加了个性化因素，可能会使这些语音助手感觉更加可信。
*   **家庭安全**:识别安全漏洞传统上依靠二元传感器，如被动红外运动传感器或磁性接近传感器来检测打开的门和窗户。这种简单的机制可能导致误报和未检测到真正的安全事件。下一级智能安全将需要复杂的事件检测，以分析来自训练模型的多元输入和置信度得分。本地模型可以自动评估消费者是在家还是不在家，解决方案可以利用这一点来校准对事件的敏感度，并升级事件通知。摄像机馈送是高数据速率用例的一个经典示例，使用本地处理来确定将哪些剪辑上传到云中进行存储和进一步处理会变得非常便宜。
*   **可持续性和便利性**:保持温度阈值的简单恒温器仅限于识别阈值何时被突破，并通过启动炉子或空调系统做出反应。传统的智能家庭自动化通过阅读天气预报、建立谁在家中的时间表档案以及遵守经济运行规则来改善这一点。ML 可以带我们更进一步，通过分析更广泛的输入，通过推荐引擎确定如何最可持续地实现个人舒适度目标。例如，ML 模型可能会识别并告诉我们，对于您的特定家庭，晚上最可持续的降温方式是在 2 小时内连续运行空调 5 分钟，而不是连续运行 30 分钟。

## 工业用例

在制造业、电力和公用事业以及供应链物流等垂直行业中，创新的共同主线是创造有利可图的新商业模式并降低现有商业模式的成本。为了与 IT 世界一起创新，可以通过更好地了解客户需求和业务生成的运营数据来测试新的假设，从而实现这些目标。这种理解来自于使用更多已经收集的现有数据，并获取解决假设所需的新数据流，从而带来有价值的新机会。

根据 2015 年*麦肯锡全球研究所*的报告*释放物联网的潜力*，企业的物联网传感器收集的数据中只有 1%得到检查。使用数据的挑战是让系统和人们可以访问数据，并从中获得价值。当数据在边缘被摄取，但存储在本地孤岛中时，它没有什么价值，因为本地孤岛负担不起将其运送到云进行分析的费用。这就是今天的边缘解决方案可以通过本地计算和 ML 将数据转化为可操作的见解的地方。

以下是工业物联网环境中 ML 边缘的三个使用案例:

*   **预测性维护**:工业企业投资并部署昂贵的机器来完成工作。这种机械，例如金属板压机、**计算机数控** ( **CNC** )刳刨机或挖掘机，只有在需要维护操作之前，或者更糟的是，在工作中遇到故障之前，才能在如此多的工作周期内发挥最佳性能。需要保持机器处于最佳状态，同时最大限度地减少停机时间和不必要的维护费用，这是工业物联网和边缘解决方案的主要使用案例。训练模型并在边缘部署它们以进行预测性维护检测，不仅可以使企业避免代价高昂的停机事件，还可以确保在没有高速或一致网络访问的远程环境中平稳运行，从而充分利用本地 ML 的优势。
*   **安全和安保**:员工的人身安全和安保应该是任何企业最关心的问题。安全第一。ML-powered edge 解决方案提高了工作场所安全的标准，其应用包括**计算机视觉** ( **CV** )模型，用于检测员工何时会在没有所需安全设备(如安全帽或安全背心)的情况下进入危险环境。类似的解决方案也可用于检测未授权人员何时进入(或试图进入)受限区域。当涉及到人类安全时，延迟和可用性是最重要的，因此在边缘运行一个全功能的解决方案意味着带来 ML 功能。
*   **质量保证**:当操作人员在生产线上检查组件或成品时，他们知道根据训练有素的参考(每批饼干尝起来都应该像这种饼干)、与规格的比较(铝箔的厚度、光泽、强度)或人的感知(这两块木头是否有合理相似的木纹一起使用)来检查质量的哪些方面？).例如，ML 创新了制造商如何捕捉人类质量检查员的直觉，以增加其操作的规模和精度。通过在制造环境中部署摄像机和 CV 模型等传感器，可以检测每一个组件或最终产品(而不是任意样品),并且每次都进行统计一致的评估。这也给**质量保证** ( **QA** )团队带来了好处，将重点转移到检查解决方案性能上，而不是从事依赖快速主观分析的高度重复性任务。换句话说，我宁愿对 ML 解决方案中通过检验的 10，000 个项目的样本进行 QA，而不是对这 10，000 个项目中的每一个进行 QA。在边缘运行这样一个解决方案，可以减少发送到云的总体数据，并最大限度地减少解决方案产生结果的延迟。

智能家居和行业中的这些用例凸显了 ML 供电的边缘解决方案所能实现的优势。如果有更多的开发人员为生活带来创新的新边缘解决方案，对物联网市场增长的崇高预测更有可能成为现实！让我们回顾一下智能家居解决方案(和免费的产品理念，供人们在那里建立),这将推动本书的实践材料。

# 场景设置:现代智能家居解决方案

你将在本书的章节中构建的解决方案是一个为现代智能家居解决方案建模的网关设备。这意味着我们将使用智能家庭中枢的环境来收集传感器数据，分析和处理这些数据，并根据检测到的事件、时间表和用户命令来控制本地设备。我们在整本书中选择智能家居环境作为我们解决方案的基础，因为它易于理解，并且我们预计我们的许多读者都读过智能家居控制器或亲自与智能家居控制器互动。这使我们能够利用智能家居的背景作为比喻，快速浏览动手操作的章节，找到好东西。如果你的目标是将本书中学到的技能应用到其他领域，比如工业物联网，不用担心；本书中使用的技术和模式不仅仅适用于智能家居环境。

现在，是时候戴上你的想象力的帽子了，让我们更深入地了解驱动我们新的智能家居产品的场景！假设你是 *Home Base Solutions* 的员工，这是一家专门向市场推出新型智能家居设备的公司。 *Home Base Solutions* 为第一次为家中配备智能产品的客户或通过更换旧的智能家居系统寻求更好服务的有经验客户提供一流的功能。

对于的下一个假期， *Home Base Solutions* 希望发布一款新的智能家居中枢，为客户提供他们以前从未见过的东西:一款包括传感器的产品，用于监控他们现有大型电器(如炉子或洗碗机)的健康状况，并使用 ML 向业主建议何时需要维护。当 ML 模型从连接的设备监控套件中检测到数据异常时，会提供维护建议。即使在公共互联网连接中断或拥塞时，这种功能也必须继续工作，因此 ML 组件不能只在云中的服务器上运行。

您可以在此处查看*家庭基础解决方案*设备监控套件的图示:

![Figure 1.8 – Whiteboard sketch of the Home Base Solutions appliance monitoring kit
](img/B17595_01_008.jpg)

图 1.8–家用基础解决方案设备监控套件的白板草图

你在公司的角色是物联网架构师，这意味着你负责设计软件解决方案，该解决方案描述了数据采集、摄取、存储、分析和洞察的 E2E、边缘到云模型。由您来设计如何实现公司的愿景，将 ML 技术本地整合到 hub 产品中，这样就不会硬性依赖任何远程服务来实现持续运营。

作为架构师还意味着您负责选择工具并设计如何操作这些设备的生产设备群，以便客户服务和设备群运营团队能够大规模管理客户设备。你不需要成为 ML 领域的**主题专家**(**SME**)——这是你团队的数据科学家需要介入的地方——但是你应该设计一个架构，它能够提供数据来支持 ML 训练工作，并在中枢设备上运行构建的模型。

在花了几周时间研究可用的软件技术、工具、解决方案供应商和云服务供应商之后，您决定使用 AWS 尝试以下架构:

![Figure 1.9 – Solution architecture diagram for appliance monitoring kit
](img/B17595_01_009.jpg)

图 1.9–设备监控套件的解决方案架构图

只是有点复杂，对吧？如果这些都没有意义，请不要担心。我们将在本书的剩余章节中深入探讨这些工具，在初级水平上介绍它们，在生产中使用的模式，以及如何组合它们来交付成果。每章将集中在一个组成部分或子部分，随着时间的推移，我们将朝着这个总的概念。以下是各个组件及其关系的细分:

1.  由智能家庭中枢控制的传感器和致动器，例如灯及其开/关开关或调光器。这些将通过 Raspberry Pi Sense HAT、您自己的与 Raspberry Pi 兼容的硬件模块或通过软件组件进行模拟。
2.  *家庭基础解决方案*创新的家电监控套件。这些套件中的流数据将在本书中作为软件组件实现。
3.  在智能家居中枢上运行的流缓冲区，用于处理家用电器运行时数据。
4.  ML 模型(每个家用电器一个)存储在集线器上，用于调用来自家用电器监控套件的传入遥测数据。
5.  这一切都是通过运行在 *Home Base Solutions* hub 设备上的 edge 软件解决方案及其由物联网 Greengrass Core software 部署和运行的组件实现的。
6.  在物联网 Greengrass edge 解决方案中运行的组件通过 MQTT 消息和 AWS 物联网核心服务与 AWS 云交换消息。
7.  AWS 物联网核心的规则引擎支持light**extract-transform-load**(**ETL**)操作，并在整个解决方案的云端转发消息。
8.  家电监控数据存储在亚马逊**简易存储服务** ( **S3** )。
9.  亚马逊 SageMaker 使用电器监控数据作为训练和再训练 ML 模型的输入。
10.  物联网 Greengrass 的云服务使用物联网设备管理的原生功能，如组和作业，将代码和资源部署到智能家庭中心的车队。
11.  经过训练的 ML 模型被作为资源部署回边缘用于本地推理。
12.  本地反馈机制，如 a **发光二极管** ( **LED** )或扬声器，向客户发出信号，告知已检测到异常，并建议进行维护活动。
13.  网络反馈机制(例如向移动应用发送推送通知)向客户发出建议维护活动的信号，并且可以提供关于异常事件的进一步上下文。
14.  客户支持和车队运营团队使用一套工具(如 Fleet Hub、Device Defender 和 CloudWatch)来监控客户设备的运行状况。

到本书结束时，您将已经构建了完整的解决方案，并具备了将类似的解决方案应用于您自己的业务需求所需的技能。架构的模式和整体形状保持一致。具体设备、网络和所需结果的实施细节因项目而异。

# 实践先决条件

为了完成本书的实践部分，你需要访问两个计算机系统。

注意

在创作时，AWS IoT Greengrass v2 不支持 Windows 安装。与 edge 解决方案相关的实践部分是特定于 Linux 的，不能在 Windows 上运行

## 系统 1:边缘设备

第一个系统将是您的**边缘设备**，也称为网关，因为它将充当一个或多个设备的代理以及解决方案的云组件。在物联网 Greengrass 术语中，这被称为 a **Greengrass 核心**。这个系统必须是运行 Linux 操作系统的电脑，或者是 Linux 系统的**虚拟机** ( **VM** )。在撰写本文时，AWS 物联网 Greengrass 第二版 ( **v2** )的运行时软件依赖于 Linux。本书推荐使用运行最新版 Raspberry Pi 操作系统的 Raspberry Pi(硬件版 3B 或更高版本)。合适的替代品包括 Linux 笔记本电脑/台式机、运行 Linux 映像的 VirtualBox 等虚拟化产品，或者亚马逊**弹性计算云** ( **EC2** )、Azure 虚拟机或 DigitalOcean Droplets 等云托管的 Linux 实例。

Raspberry Pi 是首选，因为它提供了与物理传感器和执行器交互操作的最简单方式。毕竟我们是在建物联网项目！也就是说，我们将为使用虚拟环境来完成实际操作部分的读者提供代码示例来模拟传感器和执行器的功能。涵盖传感器和执行器用例的推荐扩展套件是 **Raspberry Pi Sense HAT** 。有许多与 Raspberry Pi 兼容的扩展板和模块套件。本书中的用例可以根据需要完成或修改，以适应您所拥有的，尽管我们不会涵盖除了所提供的软件示例之外的备选方案。

在这里，您可以看到带有 Sense HAT 扩展板的树莓派 3B 的直观展示:

![Figure 1.10 – Raspberry Pi 3B with Sense HAT expansion board
](img/B17595_01_010.jpg)

图 1.10–带 Sense HAT 扩展板的树莓派 3B

为了保持解决方案的**物料清单** ( **BOM** )较低，我们在网关设备本身设置了边缘通信的边界。这意味着在本书的解决方案中没有与网关进行无线通信的设备，尽管智能家居产品的实际实现可能会使用某种无线通信。

如果您正在使用本节中概述的推荐组件，您将可以使用一系列传感器、按钮和反馈机制来模拟智能家庭网关设备和安装在家中的连接设备之间的互操作。从这个意义上说，设备和智能家居中枢之间的通信变成了一个与这里展示的软件设计模式正交的实现细节。

## 系统 2:指挥与控制(C2)

第二个系统将是你的 C2 环境。该系统可以是基于 Windows、Mac 或 Unix 的操作系统，您可以从中安装并使用AWS 命令行界面 ( **AWS CLI** )来配置、更新和管理您的 edge 解决方案群。物联网 Greengrass 支持本地开发生命周期，因此我们将直接使用边缘设备(或通过第二个系统的**安全外壳** ( **SSH** )来启动，然后在后面的章节中专门转移到 C2 系统进行远程操作。

下面是一个简单的要求列表:

*   AWS 帐户
*   拥有管理员权限的 AWS 帐户中的用户
*   第一个系统(边缘设备):
    *   基于 Linux 的操作系统，如 Raspberry Pi OS 或 Ubuntu 18.x
        *   推荐:树莓 Pi(硬件改版 3B 或更高版本)
        *   必须是 Armv7l、Armv8 (AArch64)或 x86_64 架构
    *   1 `80`、`443`和`8883`
    *   `sudo`通过软件包管理器安装和升级软件包
    *   (可选)Raspberry Pi Sense HAT 或用于传感器和执行器的等效扩展模块
*   第二系统(C2 系统):
    *   基于 Windows、Mac 或 Unix 的操作系统
    *   键盘和显示器
    *   Python 3.7 以上版本已安装
    *   AWS CLI v2.2+已安装
    *   A network connection that can reach the public internet on TCP ports `80` and `443`

        注意

        如果您正在为此项目创建一个新的 AWS 帐户，您还需要一张信用卡来完成注册过程。如果由您公司的 AWS 管理员提供，建议使用新的开发人员帐户或沙盒帐户。不建议在任何运行生产服务的帐户中试验新项目。

所有这些都是一种详尽的说法:如果你有一台笔记本电脑和一个树莓派，你很可能已经准备好了！如果您只有一台笔记本电脑，您仍然可以在本地虚拟机上完成所有动手练习，无需额外费用。

注意

Python 和 AWS CLI 的安装说明因操作系统而异。本书不介绍这些工具的设置。安装配置见[https://www.python.org](https://www.python.org)和[https://aws.amazon.com/cli/](https://aws.amazon.com/cli/)。

# 总结

现在，您应该对计算拓扑的边缘和边缘解决方案的组件(如传感器、执行器和计算能力)有了一个工作定义。您应该能够确定 ML 技术对于智能家居和边缘工业用例的价值主张。我们创建了一个虚构的公司，确定了新产品发布的范围，并描述了您将在本书剩余部分交付的解决方案的总体架构。

在下一章中，您将通过学习如何使用 AWS IoT Greengrass 在您的边缘设备上编排代码，朝着开发边缘解决方案迈出第一步。如果您的两个动手系统的先决条件已经准备就绪，并且您的 AWS 帐户已经设置好，那么您就可以开始了！

# 知识检查

在进入下一章之前，通过回答这些问题来测试你的知识。答案可以在书的结尾找到:

1.  网络物理解决方案和边缘解决方案有什么区别？
2.  在发明的时候，汽车是一个独立的机械实体，而不是一个信息物理解决方案或边缘解决方案。在汽车发展的某个时刻，它开始满足信息物理解决方案的定义，然后再次满足边缘解决方案的定义。我们今天能找到的符合我们对边缘解决方案定义的汽车特征是什么？
3.  电话一直是一种网络物理解决方案吗？为什么或为什么不？
4.  边缘解决方案的常见组件有哪些？
5.  在边缘交付智能工作负载所需的三种主要工具是什么？
6.  在边缘运行 ML 模型可以在边缘到云的工作负载中实现哪四项主要优势？
7.  任何智能家居解决方案的核心人物是谁？
8.  您能否再举出一个智能家居垂直领域的使用案例，与 ML 供电的边缘解决方案的一个或多个关键优势相关联？
9.  谁是任何工业解决方案的核心人物？
10.  您能为任何一个工业垂直行业找出一个与 ML-powered edge 解决方案的一个或多个关键优势相关的用例吗？
11.  ML-powered edge 解决方案的物联网架构师通常负责所部署模型的性能准确性(例如，预测的置信度得分)吗？为什么或为什么不？

# 参考文献

有关本章中讨论的概念的更多信息，请查看以下资源:

*   *埃里希·伽马*、*理查德·赫尔姆*、*拉尔夫·约翰逊*和*约翰·维里西德斯*。1995.*设计模式:可重用面向对象软件的要素*。*美国爱迪生-韦斯利·朗曼出版公司*:
*   *Smart Homes Market – Growth, Trends, COVID-19 Impact, and Forecasts (2021-2026)*:

    [https://www . mordor intelligence . com/industry-reports/global-smart-homes-market-industry](https://www.mordorintelligence.com/industry-reports/global-smart-homes-market-industry)

*   *Industrial Internet Of Things Market Size, Share & Trends Analysis Report By Component, (Solution, Services, Platform), By End Use (Manufacturing, Logistics and Transport), By Region, And Segment Forecasts, 2019-2025*:

    [https://www . grandview research . com/industry-analysis/industry-internet-of-things-iiot-market](https://www.grandviewresearch.com/industry-analysis/industrial-internet-of-things-iiot-market)

*   *Unlocking the potential of the Internet of Things*:

    [https://www . McKinsey . com/business-functions/McKinsey-digital/our-insights/the-internet-of-things-the-value-of-digitaling-the-physical-world](https://www.mckinsey.com/business-functions/mckinsey-digital/our-insights/the-internet-of-things-the-value-of-digitizing-the-physical-world%0D)

*   *The 17 Goals*, UN website:

    [https://sdgs.un.org/goals](https://sdgs.un.org/goals)