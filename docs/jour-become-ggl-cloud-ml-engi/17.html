<html><head/><body>









<title>Appendix 2: Practicing Using the Python Data Libraries</title>







<div><div><h1 class="chapter-number" id="_idParaDest-194"><a id="_idTextAnchor195"/>附录二</h1>

<h1 id="_idParaDest-195"><a id="_idTextAnchor196"/>练习使用 Python 数据库</h1>

<p>在<a href="B18333_02.xhtml#_idTextAnchor054"> <em class="italic">第二章</em> </a>、<em class="italic">掌握 Python 编程</em>中，我们介绍了 Python 数据库，包括 NumPy、Pandas、Matpotlib 和 Seaborn。在本附录中，我们将通过在 Google Colab 平台(<a href="http://colab.research.google.com">colab.research.google.com</a>)上练习使用这些库来继续学习。</p>

<p>通过一步一步的方法，我们将展示如何使用这些库来管理和可视化数据。对于 NumPy 库，我们将讨论如何生成和操作 NumPy 数组。对于 Pandas 库，我们将介绍包括系列、数据帧、缺失数据处理、分组和操作在内的特性。对于 Matpotlib 和 Seaborn 库，我们将通过探索多个数据可视化示例来展示它们的特性。</p>

<p>遵循这些例子，并确保你理解每一个例子。在 Google Colab 上练习每个例子会产生最好的结果。</p>

<h1 id="_idParaDest-196"><a id="_idTextAnchor197"/> NumPy</h1>

<p>NumPy 是 Python 的一个<a id="_idIndexMarker629"/>库，增加了对大型多维数组和矩阵的支持，以及对这些数组进行操作的大量高级数学函数。</p>

<p>在本节中，我们将讨论以下主题:</p>

<ul>

<li>生成 NumPy 数组</li>

<li>操作 NumPy 阵列</li>

</ul>

<p>我们将从如何生成 NumPy 数组开始。</p>

<h2 id="_idParaDest-197"><a id="_idTextAnchor198"/>生成 NumPy 数组</h2>

<p>在这一节中，我们将演示创建 NumPy 数组的各种方法。数组可能是一维的，也可能是二维的。</p>

<p>让我们使用下面的代码将一个列表转换成一维数组(第一行导入 NumPy 库和，并给它赋予别名<code>np</code>):</p>

<pre class="source-code">import numpy as np

my_list = [1,2,3]

my_list

<strong class="bold">[1, 2, 3]</strong>

import numpy as np

my_list = [1,2,3]

arr = np.array(my_list)

arr

<strong class="bold">array([1, 2, 3])</strong></pre>

<p>现在，让<a id="_idIndexMarker631"/>用下面的代码让我们的列表稍微复杂一点:</p>

<pre class="source-code">import numpy as np

my_mat =[[10,20,30],[40,50,60],[70,80,90]]

np.array(my_mat)

<strong class="bold">array([[10, 20, 30],</strong>

<strong class="bold">       [40, 50, 60],</strong>

<strong class="bold">       [70, 80, 90]])</strong></pre>

<p>请注意，有两组括号表示二维数组。</p>

<p>NumPy 中的一个基本功能是<code>arange()</code>，在这里可以提供开始和停止值。例如，<code>0</code>为起始值，<code>10</code>为终止值，<code>np.arange()</code>会生成一个一维数组，数组中的值从<code>0</code>到<code>10</code>(不包括函数中提供的最后一个值):</p>

<pre class="source-code">import numpy as np

np.arange(0,10)

<strong class="bold">array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])</strong></pre>

<p>让我们使用带有其他值/参数的相同函数。在下面的例子中，我们添加了一个名为<strong class="bold">步长</strong>的<a id="_idIndexMarker632"/>附加参数来创建一个偶数的一维数组:</p>

<pre class="source-code">import numpy as np

np.arange(0,11,2)

<strong class="bold">array([ 0, 2, 4, 6, 8, 10])</strong></pre>

<p><code>arange</code>函数中第一个参数是<code>start</code>值，第二个是<code>stop</code>值，最后一个是步长。</p>

<p>NumPy 的另一个<a id="_idIndexMarker633"/>内置函数是生成一个全零的数组。我们需要为参数提供我们希望在数组中生成多少个零，如下面的代码片段所示:</p>

<pre class="source-code">import numpy as np

np.zeros(5)

<strong class="bold">array([0., 0., 0., 0., 0.])</strong></pre>

<p>您还可以提供一个元组作为参数:</p>

<pre class="source-code">import numpy as np

np.zeros((4,4))

<strong class="bold">array([[0., 0., 0., 0.],</strong>

<strong class="bold">       [0., 0., 0., 0.],</strong>

<strong class="bold">       [0., 0., 0., 0.],</strong>

<strong class="bold">       [0., 0., 0., 0.]])</strong></pre>

<p>类似地，如果我们需要生成一个纯 1 的数组，我们可以使用<code>ones</code>函数并提供一个数字作为参数，如下所示:</p>

<pre class="source-code">import numpy as np

np.ones((3,4))

<strong class="bold">array([[1., 1., 1., 1.],</strong>

<strong class="bold">       [1., 1., 1., 1.],</strong>

<strong class="bold">       [1., 1., 1., 1.]])</strong></pre>

<p>另一个有用的内置函数是<code>linspace</code>，在这里我们输入参数作为第一个数字和最后一个数字，在指定的区间内均匀分布。记住，<code>arange</code>函数返回起点和终点之间的所有整数，但是<code>linspace</code>接受第三个参数，即我们想要的点数:</p>

<pre class="source-code">import numpy as np

np.linspace(0,5,10)

<strong class="bold">array([0.        , 0.55555556, 1.11111111, 1.66666667, 2.22222222,</strong>

<strong class="bold">       2.77777778, 3.33333333, 3.88888889, 4.44444444, 5.        ])</strong></pre>

<p>在<a id="_idIndexMarker634"/>之前的例子中，有一个一维数组(用单括号指定)，在<code>0</code>和<code>5</code>之间有 10 个均匀间隔的点:</p>

<pre class="source-code">import numpy as np

np.linspace(0,5,25)

<strong class="bold">array([0.        , 0.20833333, 0.41666667, 0.625     , 0.83333333,</strong>

<strong class="bold">       1.04166667, 1.25      , 1.45833333, 1.66666667, 1.875     ,</strong>

<strong class="bold">       2.08333333, 2.29166667, 2.5       , 2.70833333, 2.91666667,</strong>

<strong class="bold">       3.125     , 3.33333333, 3.54166667, 3.75      , 3.95833333,</strong>

<strong class="bold">       4.16666667, 4.375     , 4.58333333, 4.79166667, 5.</strong></pre>

<p>请注意，使用具有不同空间点的相同示例(<code>25</code>)，数组看起来像二维数组，但它是一维的，通过数组前面只有一个括号来证明。</p>

<p>如果你在处理线性代数问题，它基本上是一个二维方阵(行数和列数相同)，其中我们有一个 1 的对角线，其他都是 0。这就是为什么它采用一个位数作为参数:</p>

<pre class="source-code">import numpy as np

np.eye(5)

<strong class="bold">array([[1., 0., 0., 0., 0.],</strong>

<strong class="bold">       [0., 1., 0., 0., 0.],</strong>

<strong class="bold">       [0., 0., 1., 0., 0.],</strong>

<strong class="bold">       [0., 0., 0., 1., 0.],</strong>

<strong class="bold">       [0., 0., 0., 0., 1.]])</strong></pre>

<p>此处将使用的<a id="_idIndexMarker635"/>最常用函数之一生成一个包含随机数的数组，如下所示:</p>

<pre class="source-code">import numpy as np

np.random.rand(4,5)

<strong class="bold">array([[0.44698983, 0.46938684, 0.66609426, 0.95168835, 0.48775195],</strong>

<strong class="bold">       [0.17627195, 0.98549358, 0.69526343, 0.44981183, 0.11574242],</strong>

<strong class="bold">       [0.09377203, 0.35856856, 0.38228733, 0.6129268 , 0.16385609],</strong>

<strong class="bold">       [0.79041234, 0.9281485 , 0.72570369, 0.46438003, 0.3159711 ]])</strong></pre>

<p>如果我们需要从标准正态分布返回，而不是<code>rand</code>，我们可以使用<code>randn</code>函数:</p>

<pre class="source-code">import numpy as np

np.random.randn(4)

<strong class="bold">array([ 1.57461921, -1.47658163, 0.38070033, -1.43224982])</strong></pre>

<p>另一个函数是<code>randint</code>，它返回最低和最高整数值之间的随机单个整数，作为参数提供(最低包含值和最高排除值):</p>

<pre class="source-code">import numpy as np

np.random.randint(1,100)

<strong class="bold">29</strong></pre>

<p>如果我们需要<a id="_idIndexMarker636"/>一个特定数量的随机整数在提供的区间内，我们需要提供第三个参数:</p>

<pre class="source-code">import numpy as np

np.random.randint(1,100,10)

<strong class="bold">array([29, 7, 33, 85, 83, 34, 5, 50, 53, 39])</strong></pre>

<p>现在，让我们做一些转换。在下面的例子中，我们已经生成了一个包含 25 个值的一维数组，将其保存在一个<code>array</code>变量中，然后将其重塑为一个二维数组:</p>

<pre class="source-code">import numpy as np

array = np.arange(25)

array

<strong class="bold">array([ 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24])</strong>

array.reshape(5,5)

<strong class="bold">array([[ 0,  1,  2,  3,  4],</strong>

<strong class="bold">       [ 5,  6,  7,  8,  9],</strong>

<strong class="bold">       [10, 11, 12, 13, 14],</strong>

<strong class="bold">       [15, 16, 17, 18, 19],</strong>

<strong class="bold">       [20, 21, 22, 23, 24]])</strong></pre>

<p>如果我们想得到随机生成的数组中的最大值或最小值，可以分别使用<code>array.max()</code>或<code>array.min()</code>函数:</p>

<pre class="source-code">import numpy as np

array = np.random.randint(0,50,10)

array

<strong class="bold">array([ 2, 8, 31, 2, 25, 34, 49, 8, 49, 42])</strong>

array.max()

<strong class="bold">49</strong>

array.min()

<strong class="bold">2</strong></pre>

<p>如果我们想让<a id="_idIndexMarker637"/>从前面例子提供的数组中选取一个值(或一组值),我们可以用括号指定，如下所示:</p>

<pre class="source-code">import numpy as np

array = np.random.randint(0,50,10)

array

<strong class="bold">array([42, 38, 43, 22, 39, 4, 20, 30, 49, 13])</strong>

array[3]

<strong class="bold">22</strong>

array[0:4]

<strong class="bold">array([42, 38, 43, 22])</strong></pre>

<p>如果我们想要替换数组中的单个值或一组值，我们需要如下所示设置这些值:</p>

<pre class="source-code">import numpy as np

array = np.random.randint(0,50,100)

array

<strong class="bold">array([42, 10, 14, 34, 45, 18, 21, 11, 33, 32, 22, 13, 11, 42, 16, 20, 10,</strong>

<strong class="bold">        1, 36, 41, 45, 21, 45, 45, 41,  0, 38, 39, 16, 10, 18, 45, 43, 42,</strong>

<strong class="bold">       23, 31, 20, 14,  9, 46, 44, 33, 24, 35,  6,  6, 26, 13, 20, 20, 28,</strong>

<strong class="bold">       23, 46, 40, 15, 43, 17, 31, 15, 48,  9, 17, 46, 28, 48, 41, 30, 28,</strong>

<strong class="bold">       32, 40, 35,  8, 10,  5, 33, 30,  4, 38, 47, 22, 13, 14, 29,  1, 15,</strong>

<strong class="bold">       48, 18, 48, 18, 21, 45,  9,  6,  1, 31, 28,  5, 42,  8, 28])</strong>

array[0:3] = 100

array

<strong class="bold">array([100, 100, 100,  34,  45,  18,  21,  11,  33,  32,  22,  13,  11,</strong>

<strong class="bold">        42,  16,  20,  10,   1,  36,  41,  45,  21,  45,  45,  41,   0,</strong>

<strong class="bold">        38,  39,  16,  10,  18,  45,  43,  42,  23,  31,  20,  14,   9,</strong>

<strong class="bold">        46,  44,  33,  24,  35,   6,   6,  26,  13,  20,  20,  28,  23,</strong>

<strong class="bold">        46,  40,  15,  43,  17,  31,  15,  48,   9,  17,  46,  28,  48,</strong>

<strong class="bold">        41,  30,  28,  32,  40,  35,   8,  10,   5,  33,  30,   4,  38,</strong>

<strong class="bold">        47,  22,  13,  14,  29,   1,  15,  48,  18,  48,  18,  21,  45,</strong>

<strong class="bold">         9,   6,   1,  31,  28,   5,  42,   8,  28])</strong></pre>

<p>正如您<a id="_idIndexMarker638"/>所见，<code>0</code>、<code>1</code>和<code>2</code>索引中的值被替换为<code>100</code>的值。</p>

<h2 id="_idParaDest-198"><a id="_idTextAnchor199"/>操作 NumPy 数组</h2>

<p>现在，我们<a id="_idIndexMarker639"/>更深入一点，使用二维数组。在下面的例子中，我们生成了一个包含 25 个随机数的数组，并将其重塑为一个二维数组。然后，它显示一个值，该值位于第 1 行第 1 列:</p>

<pre class="source-code">import numpy as np

array = np.random.randint(0,50,25).reshape(5,5)

array

<strong class="bold">array([[15, 21, 34, 39, 18],</strong>

<strong class="bold">       [42, 41, 28, 24,  2],</strong>

<strong class="bold">       [43, 25, 38, 42, 35],</strong>

<strong class="bold">       [ 3,  4, 27,  2, 49],</strong>

<strong class="bold">       [17,  5, 33, 11, 30]])</strong>

array[0:3]

<strong class="bold">array([[15, 21, 34, 39, 18],</strong>

<strong class="bold">       [42, 41, 28, 24,  2],</strong>

<strong class="bold">       [43, 25, 38, 42, 35]])</strong></pre>

<p>以下是根据特定条件返回数组的布尔值(<code>True</code>或<code>False</code>)的函数:</p>

<pre class="source-code">import numpy as np

array = np.random.randint(0,50,25).reshape(5,5)

array

array([[47, 25,  1, 33,  7],

       [31, 18,  9, 13, 41],

       [28, 33, 34, 19,  2],

       [ 1, 32, 45, 34, 48],

       [27, 34, 38, 18,  9]])

array &gt; 25

<strong class="bold">array([[ True, False, False,  True, False],</strong>

<strong class="bold">       [ True, False, False, False,  True],</strong>

<strong class="bold">       [ True,  True,  True, False, False],</strong>

<strong class="bold">       [False,  True,  True,  True,  True],</strong>

<strong class="bold">       [ True,  True,  True, False, False]])</strong></pre>

<p>我们还可以对数组应用一些数学运算，比如加法、减法、乘法和除法运算，以及应用一些函数，比如<code>sin</code>、<code>cos</code>和<code>log</code>:</p>

<pre class="source-code">import numpy as np

array = np.arange(10)

array

<strong class="bold">array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])</strong>

array + array

<strong class="bold">array([ 0, 2, 4, 6, 8, 10, 12, 14, 16, 18])</strong>

array * 2

<strong class="bold">array([ 0, 2, 4, 6, 8, 10, 12, 14, 16, 18])</strong>

np.sin(array)

<strong class="bold">array([ 0.        ,  0.84147098,  0.90929743,  0.14112001, -0.7568025 ,</strong>

<strong class="bold">       -0.95892427, -0.2794155 ,  0.6569866 ,  0.98935825,  0.41211849])</strong></pre>

<p>我们已经展示了一些使用 NumPy 库的例子；有关该库的更多信息，请参考<a href="https://numpy.org/">https://numpy.org/</a>。</p>

<h1 id="_idParaDest-199"><a id="_idTextAnchor200"/>熊猫</h1>

<p>Pandas 是一个构建在 NumPy 之上的<a id="_idIndexMarker642"/>开源库。Pandas 允许快速数据分析和数据准备。它在性能和生产力方面表现出色。</p>

<p>在本节中，我们将讨论以下主题:</p>

<ul>

<li>系列</li>

<li>数据帧</li>

<li>缺失数据处理</li>

<li>分组依据</li>

<li>操作</li>

</ul>

<p>根据环境的不同，您可能需要首先通过命令行或终端运行以下命令来安装 Pandas:</p>

<pre>conda install pandas
pip install pandas</pre>

<p>我们将从查看 Series 数据类型开始。</p>

<h2 id="_idParaDest-200"><a id="_idTextAnchor201"/>系列</h2>

<p>Series 是我们将在 Pandas 中使用的第一个主要数据类型。系列<a id="_idIndexMarker644"/>几乎与 NumPy 数组相同。不同之处在于，对于系列，一系列轴标签可以由一个标签来索引。</p>

<p>我们将制作四个不同的 Python 对象并形成一个列表:</p>

<pre class="source-code">import numpy as np

import pandas as pd

labels = ['A', 'B','C']

my_data = [100,200,300]

array = np.array(my_data)

d = {'A':100, 'B':200, 'C':300}

pd.Series(data = my_data)

<strong class="bold">A    100</strong>

<strong class="bold">B    200</strong>

<strong class="bold">C    300</strong>

<strong class="bold">dtype: int64</strong></pre>

<p>默认情况下，如果我们<a id="_idIndexMarker645"/>不指定索引值，它将分配<code>0, 1, 2, ….</code>因此，我们可以<a id="_idIndexMarker646"/>将这些标签更改为我们之前创建的标签(<code>labels</code>):</p>

<pre class="source-code">pd.Series(my_data, labels)

<strong class="bold">A    100</strong>

<strong class="bold">B    200</strong>

<strong class="bold">C    300</strong>

<strong class="bold">dtype: int64</strong></pre>

<p>如果您想提供一个系列中的字典，您不需要提供索引，因为字典已经有了它的键和值:</p>

<pre class="source-code">pd.Series(d)

<strong class="bold">A    100</strong>

<strong class="bold">B    200</strong>

<strong class="bold">C    300</strong>

<strong class="bold">dtype: int64</strong></pre>

<p>系列可以包含任何数据类型，我们也可以提供标签:</p>

<pre class="source-code">pd.Series(labels, my_data)

<strong class="bold">100    A</strong>

<strong class="bold">200    B</strong>

<strong class="bold">300    C</strong>

<strong class="bold">dtype: object</strong>

Next we will examine Dataframes.</pre>

<h2 id="_idParaDest-201"><a id="_idTextAnchor202"/>数据帧</h2>

<p>DataFrame 是一个带有不同类型列<a id="_idIndexMarker648"/>的<a id="_idIndexMarker647"/>二维标签数据结构。在这一节中，我们将开始使用 Pandas 构建我们的第一个数据框架。在下面的例子中，我们创建了一个由 NumPy 生成的随机数，并构建了一个带有熊猫标签(行和列)的漂亮视图:</p>

<pre class="source-code">import numpy as np

import pandas as pd 

from numpy.random import randn

np.random.seed(101)

df = pd.DataFrame(randn(5,4),['a','b','c','d','e'],['x','y','z','t'])

df

<strong class="bold">          x         y          z         t</strong>

<strong class="bold">a     2.706850  0.628133    0.907969  0.503826</strong>

<strong class="bold">b     0.651118  -0.319318  -0.848077  0.605965</strong>

<strong class="bold">c     -2.018168  0.740122    0.528813 -0.589001</strong>

<strong class="bold">d     0.188695  -0.758872  -0.933237  0.955057</strong>

<strong class="bold">e     0.190794  1.978757    2.605967  0.683509</strong></pre>

<p>如果要显示数据帧的特定行，请在括号中指定该行的名称:</p>

<pre class="source-code">df['x']

<strong class="bold">a    2.706850</strong>

<strong class="bold">b    0.651118</strong>

<strong class="bold">c   -2.018168</strong>

<strong class="bold">d    0.188695</strong>

<strong class="bold">e    0.190794</strong>

<strong class="bold">Name: x, dtype: float64</strong></pre>

<p>注意<a id="_idIndexMarker649"/>输出是一个系列，我们之前已经介绍过。如果您<a id="_idIndexMarker650"/>想要检查输出的类型，使用<code>type</code>语法，如下所示:</p>

<pre class="source-code">type(df['x']) 

<strong class="bold">pandas.core.series.Series</strong></pre>

<p>如果要显示数据框架中的多列，可以在括号中将其指定为列表:</p>

<pre class="source-code">df[['x','y']]

<strong class="bold">          x         y</strong>

<strong class="bold">a     2.706850    0.628133</strong>

<strong class="bold">b     0.651118   -0.319318</strong>

<strong class="bold">c    -2.018168    0.740122</strong>

<strong class="bold">d    0.188695    -0.758872</strong>

<strong class="bold">e    0.190794     1.978757</strong></pre>

<p>DataFrame 的另一个特性是能够向它添加新列。当添加新列时，我们需要指定新列的值。在下面的例子中，我们正在创建一个新列<code>new</code>，我们将对<code>x</code>和<code>y</code>中的所有值求和，并将它们添加到该列中:</p>

<pre class="source-code">df['new'] = df['x'] + df['y']

df

<strong class="bold">        x            y         z        t         new</strong>

<strong class="bold">a    2.706850    0.628133  0.907969   0.503826   3.334983</strong>

<strong class="bold">b    0.651118   -0.319318  -0.848077  0.605965   0.331800</strong>

<strong class="bold">c    -2.018168   0.740122  0.528813  -0.589001   -1.278046</strong>

<strong class="bold">d     0.188695  -0.758872  -0.933237  0.955057   -0.570177</strong>

<strong class="bold">e   0.190794    1.978757    2.605967   0.683509  2.169552</strong></pre>

<p>如果您<a id="_idIndexMarker651"/>想要删除特定的列或行，您可以使用<a id="_idIndexMarker652"/>内置的<code>drop</code>功能:</p>

<pre class="source-code">df.drop('new', axis=1)

<strong class="bold">         x           y          z        t</strong>

<strong class="bold">a     2.706850   0.628133   0.907969   0.503826</strong>

<strong class="bold">b     0.651118   -0.319318  -0.848077  0.605965</strong>

<strong class="bold">c     -2.018168  0.740122   0.528813   -0.589001</strong>

<strong class="bold">d     0.188695   -0.758872  -0.933237  0.955057</strong>

<strong class="bold">e     0.190794    1.978757   2.605967  0.683509</strong></pre>

<p>如果需要从特定的行获得输出，可以使用代表<code>location</code>的<code>loc</code>语法，并且需要指定一个行名作为参数:</p>

<pre class="source-code">df

         <strong class="bold">x         y           z          t        new</strong>

<strong class="bold">a    2.706850   0.628133   0.907969   0.503826   3.334983</strong>

<strong class="bold">b    0.651118   -0.319318  -0.848077  0.605965   0.331800</strong>

<strong class="bold">c    -2.018168  0.740122   0.528813  -0.589001   -1.278046</strong>

<strong class="bold">d    0.188695   -0.758872  -0.933237  0.955057   -0.570177</strong>

<strong class="bold">e    0.190794   1.978757   2.605967   0.683509   2.169552</strong>

df.loc['a']

<strong class="bold">x      2.706850</strong>

<strong class="bold">y      0.628133</strong>

<strong class="bold">z      0.907969</strong>

<strong class="bold">t      0.503826</strong>

<strong class="bold">new    3.334983</strong>

<strong class="bold">Name: a, dtype: float64</strong></pre>

<p>有条件的<a id="_idIndexMarker653"/>选择也是 Pandas 的一个特性，你可以在 DataFrame 中调用<a id="_idIndexMarker654"/>数据作为一个布尔值(<code>True</code>或<code>False</code>):</p>

<pre class="source-code">df 

<strong class="bold">        x           y         z          t         new</strong>

<strong class="bold">a   2.706850   0.628133    0.907969   0.503826   3.334983</strong>

<strong class="bold">b   0.651118   -0.319318   -0.848077  0.605965   0.331800</strong>

<strong class="bold">c   -2.018168   0.740122   0.528813   0.589001   -1.278046</strong>

<strong class="bold">d   0.188695   -0.758872   -0.933237  0.955057   -0.570177</strong>

<strong class="bold">e   0.190794   1.978757    2.605967   0.683509   2.169552</strong>

df &gt; 0

       <strong class="bold">x      y     z      t     new</strong>

<strong class="bold">a    True   True   True   True   True</strong>

<strong class="bold">b    True   False  False  True   True</strong>

<strong class="bold">c    False  True   True   False  False</strong>

<strong class="bold">d    True   False  False  True   False</strong>

<strong class="bold">e    True   True   True   True   True </strong></pre>

<h2 id="_idParaDest-202"><a id="_idTextAnchor203"/>缺失数据处理</h2>

<p>在我们之前创建的<a id="_idIndexMarker655"/> DataFrame 中，如果我们应用一些条件(比如大于零)，小于零的数据将显示为<code>NaN</code>(空数据)。如果您<a id="_idIndexMarker656"/>只需要显示没有<code>null</code>数据的行和列，使用<code>dropna</code>语法，如下所示:</p>

<pre class="source-code">df

<strong class="bold">         x         y          z          t        new</strong>

<strong class="bold">a    2.706850   0.628133   0.907969   0.503826   3.334983</strong>

<strong class="bold">b    0.651118   -0.319318  -0.848077  0.605965   0.331800</strong>

<strong class="bold">c    -2.018168   0.740122  0.528813  -0.589001   -1.278046</strong>

<strong class="bold">d    0.188695   -0.758872  -0.933237  0.955057   -0.570177</strong>

<strong class="bold">e    0.190794   1.978757   2.605967   0.683509    2.169552</strong>

df[df &gt; 0].dropna()

<strong class="bold">         x           y        z           t         new</strong>

<strong class="bold">a     2.706850   0.628133  0.907969   0.503826   3.334983</strong>

<strong class="bold">e     0.190794   1.978757  2.605967   0.683509   2.169552</strong></pre>

<p>现在，我们<a id="_idIndexMarker657"/>将应用一个条件，并用大于零的<a id="_idIndexMarker658"/>值保存一个新的数据帧(<code>new_df</code>)，如下所示:</p>

<pre class="source-code">new_df = df[df &gt; 0]

new_df

<strong class="bold">         x         y           z         t        new</strong>

<strong class="bold">a    2.706850   0.628133   0.907969   0.503826  3.334983</strong>

<strong class="bold">b    0.651118      NaN        NaN     0.605965  0.331800</strong>

<strong class="bold">c       NaN     0.740122   0.528813    NaN         NaN</strong>

<strong class="bold">d    0.188695      NaN       NaN      0.955057     NaN</strong>

<strong class="bold">e    0.190794   1.978757    2.605967  0.683509  2.169552</strong></pre>

<p>对于没有任何值(<code>NaN</code>)的单元格，我们将用该列中所有值的平均值来替换它们:</p>

<pre class="source-code">new_df['x'].fillna(value=new_df['x'].mean())

<strong class="bold">a    2.706850</strong>

<strong class="bold">b    0.651118</strong>

<strong class="bold">c    0.934364</strong>

<strong class="bold">d    0.188695</strong>

<strong class="bold">e    0.190794</strong>

<strong class="bold">Name: x, dtype: float64</strong></pre>

<p>注意<a id="_idIndexMarker659"/>在<code>x</code>列和<code>c</code>行中的值不为空，而是用一个值替换<a id="_idIndexMarker660"/>。</p>

<h2 id="_idParaDest-203"><a id="_idTextAnchor204"/>分组依据</h2>

<p>GroupBy <a id="_idIndexMarker661"/>允许您根据列将行分组，并对它们执行聚合函数<a id="_idIndexMarker662"/>。</p>

<p>在下一个示例中，我们将使用字典创建一个新的数据帧，如下所示:</p>

<pre class="source-code">import numpy as np

import pandas as pd

data = {'Country': ['USA', 'USA', 'France', 'France','Germany','Germany'],

        'Person': ['Sam','Amy','Carhile','Richard','John','Frank'],

        'Sales': [250, 300, 125, 500, 350, 200]}

df = pd.DataFrame(data)

df

<strong class="bold">    Country    Person     Sales</strong>

<strong class="bold">0    USA        Sam       250</strong>

<strong class="bold">1    USA        Amy       300</strong>

<strong class="bold">2    France     Carhile   125</strong>

<strong class="bold">3    France     Richard   500</strong>

<strong class="bold">4    Germany    John      350</strong>

<strong class="bold">5    Germany    Frank     200</strong></pre>

<p>如果您<a id="_idIndexMarker663"/>正在处理一个大型数据框架，并且想要打印<a id="_idIndexMarker664"/>每个国家的销售额总和，请使用<code>groupby</code>内置函数，如下所示:</p>

<pre class="source-code">df.groupby('Country').sum()

<strong class="bold">Country</strong>    <strong class="bold">Sales</strong>

<strong class="bold">France</strong>     <strong class="bold">625</strong>

<strong class="bold">Germany</strong>    <strong class="bold">550</strong>

<strong class="bold">USA</strong>        <strong class="bold">550</strong></pre>

<h2 id="_idParaDest-204"><a id="_idTextAnchor205"/>操作</h2>

<p>在这个<a id="_idIndexMarker665"/>部分，我们将展示一些现实生活中的数据操作。在接下来的<a id="_idIndexMarker666"/>示例中，我们将使用一个 CSV 文件<code>Salaries.csv</code>(取自<a href="https://www.kaggle.com/kaggle/sf-salaries?select=Salaries.csv">https://www.kaggle.com/kaggle/sf-salaries?select = salary . CSV</a>)。</p>

<p>将文件下载到本地计算机并上传到 Google Colab 后，您可以可视化数据框架并使用 Pandas 库浏览数据。</p>

<p>使用<code>read_csv</code>功能读取 CSV 文件，如下所示:</p>

<pre class="source-code">import pandas as pd

df = pd.read_csv('Salaries.csv')

df</pre>

<div><div><img alt="" height="433" src="img/B18333_12_1.jpg" width="1218"/>

</div>

</div>

<pre class="source-code">df.info()

<strong class="bold">&lt;class 'pandas.core.frame.DataFrame'&gt;</strong>

<strong class="bold">RangeIndex: 148654 entries, 0 to 148653</strong>

<strong class="bold">Data columns (total 13 columns):</strong>

<strong class="bold">#   Column            Non-Null Count   Dtype  </strong>

<strong class="bold">---  ------            --------------   -----  </strong>

<strong class="bold">0   Id                148654 non-null  int64  </strong>

<strong class="bold">1   EmployeeName      148654 non-null  object </strong>

<strong class="bold">2   JobTitle          148654 non-null  object </strong>

<strong class="bold">3   BasePay           148049 non-null  object </strong>

<strong class="bold">4   OvertimePay       148654 non-null  object </strong>

<strong class="bold">5   OtherPay          148654 non-null  object </strong>

<strong class="bold">6   Benefits          112495 non-null  object </strong>

<strong class="bold">7   TotalPay          148654 non-null  float64</strong>

<strong class="bold">8   TotalPayBenefits  148654 non-null  float64</strong>

<strong class="bold">9   Year              148654 non-null  int64  </strong>

<strong class="bold">10  Notes             0 non-null       float64</strong>

<strong class="bold">11  Agency            148654 non-null  object </strong>

<strong class="bold">12  Status            38119 non-null   object </strong>

<strong class="bold">dtypes: float64(3), int64(2), object(8)</strong>

<strong class="bold">memory usage: 14.7+ MB</strong>

df["TotalPay"].mean()

<strong class="bold">74768.32197169267</strong>

df[df["EmployeeName"] == "Joseph Driscoll"]["JobTitle"]

<strong class="bold">36198    Captain, Fire Suppression</strong>

<strong class="bold">Name: JobTitle, dtype: object</strong></pre>

<p>在前面的<a id="_idIndexMarker667"/>小节中，我们已经展示了<a id="_idIndexMarker668"/> Pandas 库的基本特性。关于熊猫特征的更多信息，请参见 https://pandas.pydata.org<a href="https://pandas.pydata.org"/>。</p>

<h1 id="_idParaDest-205"><a id="_idTextAnchor206"/> Matplotlib</h1>

<p>Matplotlib 是 Python 中数据可视化的基本库之一。这是一个优秀的二维和三维图形库，用于生成科学图形。</p>

<p>Matplotlib 的一些主要优点如下:</p>

<ul>

<li>一般容易从简单的情节开始</li>

<li>支持自定义标签和文本</li>

<li>对图形中每个元素的出色控制</li>

<li>多种格式的高质量输出</li>

<li>大体上非常可定制</li>

</ul>

<p>我们将从 NumPy 库生成的简单数据开始:</p>

<pre class="source-code">import matplotlib.pyplot as plt

import numpy as np

a = np.linspace(1,10,15)

a

<strong class="bold">array([ 1.        ,  1.64285714,  2.28571429,  2.92857143,  3.57142857,</strong>

<strong class="bold">        4.21428571,  4.85714286,  5.5       ,  6.14285714,  6.78571429,</strong>

<strong class="bold">        7.42857143,  8.07142857,  8.71428571,  9.35714286, 10.</strong></pre>

<p>我们已经使用 NumPy 库中的<code>linspace</code>函数生成了<a id="_idIndexMarker672"/>数据。我们还可以处理所有的数据(在我们的例子中，它是一个数组)，比如取数组中的每个数字，然后平方它:</p>

<pre class="source-code">b = a ** 2

b

<strong class="bold">array([  1.        ,   2.69897959,   5.2244898 ,   8.57653061,</strong>

<strong class="bold">        12.75510204,  17.76020408,  23.59183673,  30.25      ,</strong>

<strong class="bold">        37.73469388,  46.04591837,  55.18367347,  65.14795918,</strong>

<strong class="bold">        75.93877551,  87.55612245, 100.        ])</strong></pre>

<p>我们可以用 Matplotlib 中的一个简单函数将数据绘制成图表:</p>

<pre class="source-code">plt.plot(a,b)</pre>

<div><div><img alt="" height="278" src="img/B18333_12_2.jpg" width="389"/>

</div>

</div>

<p>您可以<a id="_idIndexMarker673"/>用<code>a</code>和<code>b</code>值重新排列<code>x</code>和<code>y</code>轴，如下图所示:</p>

<pre class="source-code">plt.subplot(1,2,1) 

plt.plot(a,b)

plt.title("Dito training 1")

plt.subplot(1,2,2)

plt.plot(b,a,"r")

plt.title("Dito training 2")</pre>

<div><div><img alt="" height="264" src="img/B18333_12_3.jpg" width="377"/>

</div>

</div>

<p>到目前为止，我们已经演示了如何使用<code>plot</code>和<code>subplot</code>方法绘图。现在，我们将深入面向对象的方法，在这里我们将对<a id="_idIndexMarker674"/>进行分解，这是对<code>matplotlib</code>面向对象 API 方法的更正式的介绍。在下面的例子中，我们运行了一个内置的<code>figure</code>函数，它构建了一个假想的空白画布，稍后，我们将向这个画布添加一个集合，这样它将更加灵活地工作:</p>

<pre class="source-code">import matplotlib.pyplot as plt

fig = plt.figure()

<strong class="bold">&lt;Figure size 432x288 with 0 Axes&gt;</strong>

import matplotlib.pyplot as plt

fig = plt.figure()

axes = fig.add_axes([0.1,0.1,0.8,0.8])</pre>

<div><div><img alt="" height="265" src="img/B18333_12_4.jpg" width="390"/>

</div>

</div>

<p>第一步是使用<code>add_axes</code>函数向画布添加轴。括号中的数字代表轴的左侧、按钮、宽度和高度。</p>

<p>每个数字<a id="_idIndexMarker675"/>应该在零和一之间，代表一个百分比，数字表示:</p>

<ul>

<li>第一个数字(0.1)代表画布左侧的 10%。</li>

<li>第二个数字(0.1)代表倒数第 10%。</li>

<li>第三个数字(0.8)表示轴占画布的百分比(宽度)。</li>

<li>第四个数字(0.8)表示轴占画布的百分比(高度)。</li>

</ul>

<p>在前面的例子中，我们使用 NumPy 生成了<code>a</code>和<code>b</code>值，并使用面向对象的方法在我们的自定义画布/轴中绘制它们，这给了我们更多的控制。使用一些其他函数，我们可以为每个轴和标题设置名称，如下所示:</p>

<pre class="source-code">import matplotlib.pyplot as plt

import numpy as np

a = np.linspace(1,10,15)

b = a ** 2

fig = plt.figure()

axes = fig.add_axes([0.1,0.1,0.8,0.8])

axes.plot(a,b)</pre>

<div><div><img alt="" height="254" src="img/B18333_12_5.jpg" width="380"/>

</div>

</div>

<p>现在，让我们<a id="_idIndexMarker676"/>将两组数字放在同一块画布上:</p>

<pre class="source-code">import matplotlib.pyplot as plt

import numpy as np

a = np.linspace(1,10,15)

b = a ** 2

fig = plt.figure()

axes1 = fig.add_axes([0.1,0.1,0.8,0.8])

axes2 = fig.add_axes([0.2,0.5,0.4,0.3])

axes1.plot(a,b)

axes2.plot(b,a)

axes1.set_xlabel("X1 Label")

axes1.set_ylabel("Y1 Label")

axes1.set_title("Title 1")

axes2.set_xlabel("X2 Label")

axes2.set_ylabel("Y2 Label")

axes2.set_title("Title 2")</pre>

<div><div><img alt="" height="291" src="img/B18333_12_6.jpg" width="399"/>

</div>

</div>

<p>在<a id="_idIndexMarker677"/>下一个例子中，我们在同一个图中绘制了两个集合，并使用<code>label</code>和<code>legend</code>方法添加了一些标签:</p>

<pre class="source-code">import matplotlib.pyplot as plt

import numpy as np

a = np.linspace(1,10,15)

b = a ** 2

fig = plt.figure()

ax = fig.add_axes([0,0,1,1])

ax.plot(a, a**2, label = 'a squared')

ax.plot(a, a**3, label = 'a cubed')

ax.legend()</pre>

<div><div><img alt="" height="319" src="img/B18333_12_7.jpg" width="478"/>

</div>

</div>

<p>我们已经展示了一些使用 Matplotlib 库的例子；更多<a id="_idIndexMarker679"/>详细信息，请参考<a href="https://matplotlib.org">https://matplotlib.org</a>。</p>

<h1 id="_idParaDest-206"><a id="_idTextAnchor207"/>海风</h1>

<p>Seaborn 是建立在 Matplotlib 库之上的<a id="_idIndexMarker680"/>统计库，我们所学的所有 Matplotlib 知识都可以应用到 Seaborn 上。</p>

<p>我们将从一个简单的导入库开始。Seaborn 的一个有用特性是它内置的数据集。在我们的例子中，我们将使用<code>tips</code>数据集:</p>

<pre class="source-code">import seaborn as sns

tips = sns.load_dataset('tips')

tips.head()</pre>

<p>您还可以使用<code>.info()</code>函数通过<a id="_idIndexMarker681"/>检查一些其他的细节(比如列数和行数，以及数据类型)，如下所示:</p>

<pre class="source-code">    <strong class="bold">total_bill   tip    sex    smoker  day    time    size</strong>

<strong class="bold">0   16.99       1.01    Female   No    Sun   Dinner    2</strong>

<strong class="bold">1   10.34       1.66    Male     No    Sun   Dinner    3</strong>

<strong class="bold">2   21.01       3.50    Male     No    Sun   Dinner    3</strong>

<strong class="bold">3   23.68       3.31    Male     No    Sun   Dinner    2</strong>

<strong class="bold">4   24.59       3.61    Female   No    Sun   Dinner    4</strong>

tips.info()

<strong class="bold">&lt;class 'pandas.core.frame.DataFrame'&gt;</strong>

<strong class="bold">RangeIndex: 244 entries, 0 to 243</strong>

<strong class="bold">Data columns (total 7 columns):</strong>

<strong class="bold">#   Column      Non-Null Count  Dtype</strong>   

---  ------      --------------  -----   

<strong class="bold">0   total_bill  244 non-null    float64 </strong>

<strong class="bold">1   tip         244 non-null    float64 </strong>

<strong class="bold">2   sex         244 non-null    category</strong>

<strong class="bold">3   smoker      244 non-null    category</strong>

<strong class="bold">4   day         244 non-null    category</strong>

<strong class="bold">5   time        244 non-null    category</strong>

<strong class="bold">6   size        244 non-null    int64   </strong>

<strong class="bold">dtypes: category(4), float64(2), int64(1)</strong>

<strong class="bold">memory usage: 7.4 KB</strong></pre>

<p>这里的例子显示了一个非常基本的直方图，其中我们将数据集名称设置为<code>tips</code>和<code>total_bill</code>数据(数据集的一列):</p>

<pre class="source-code">sns.displot(tips['total_bill']) </pre>

<div><div><img alt="" height="352" src="img/B18333_12_8.jpg" width="352"/>

</div>

</div>

<pre class="source-code">sns.displot(tips['total_bill'], kde=True, bins = 40)</pre>

<div><div><img alt="" height="352" src="img/B18333_12_9.jpg" width="352"/>

</div>

</div>

<p>之前描述的<code>displot</code>函数<a id="_idIndexMarker682"/>有不同的参数，你可以设置这些参数来修改你的图形/直方图。注意，我们已经输入了两个参数，<code>kde</code>和<code>bins</code>。</p>

<p>接下来，我们将使用<code>jointplot</code>函数探索不同类型的图形。您需要提供<code>x</code>值、<code>y</code>值和数据名称作为参数，如下所示:</p>

<pre class="source-code">sns.jointplot('total_bill', 'tip', data=tips)</pre>

<div><div><img alt="" height="424" src="img/B18333_12_10.jpg" width="421"/>

</div>

</div>

<p>注意，<a id="_idIndexMarker683"/>我们提供的参数(<code>total_bill</code>和<code>tips</code>)来自我们导入的数据，它们是列名。这是一个双分布图，在两者之间，我们有一个散点图。随着账单值在图上增加，小费值也增加。<code>jointplot</code>也有其他参数可以帮助你修改图形(默认情况下，它是散点图，但是你也可以传递十六进制参数)，如下所示:</p>

<pre class="source-code">sns.jointplot('total_bill', 'tip', data=tips, kind = 'hex')</pre>

<div><div><img alt="" height="424" src="img/B18333_12_11.jpg" width="421"/>

</div>

</div>

<p>我们将介绍的下一个 Seaborn <a id="_idIndexMarker684"/>特性/功能是盒图和小提琴图。这些类型的图用于显示分类数据的分布。它们以一种便于变量之间比较的方式显示定量数据的分布:</p>

<pre class="source-code">sns.boxplot(x='day', y='total_bill', data=tips)</pre>

<div><div><img alt="" height="262" src="img/B18333_12_12.jpg" width="383"/>

</div>

</div>

<p>与箱线图不同，violin 图允许您实际绘制与实际数据点对应的所有组件，它本质上显示了基础分布的核密度估计:</p>

<pre class="source-code">sns.violinplot(x='day', y='total_bill', data=tips)</pre>

<div><div><img alt="" height="262" src="img/B18333_12_13.jpg" width="383"/>

</div>

</div>

<p>通过向<code>violinplot</code>函数添加更多参数，您可以向图表添加不同的特性和细节，如下所示。</p>

<pre class="source-code">sns.violinplot(x='day', y='total_bill', data=tips,

               hue = 'sex', split=True)</pre>

<div><div><img alt="" height="262" src="img/B18333_12_14.jpg" width="383"/>

</div>

</div>

<p>到目前为止，我们已经通过几个例子展示了 Seaborn 库的特性。Python 中有许多使用 Seaborn 库的不同可视化表示。查看 Seaborn 网站(<a href="https://seaborn.pydata.org/index.xhtml">https://seaborn.pydata.org/index.xhtml</a>)了解更多详情</p>

<h1 id="_idParaDest-207"><a id="_idTextAnchor208"/>总结</h1>

<p>在本附录中，我们练习使用 Python 数据库，包括 NumPy、Pandas、Matpotlib 和 Seaborn。彻底理解这些例子将有助于你理解数据库和掌握 Python 编程技巧。</p>

</div>

<div><div/>

</div>

</div>



</body></html>